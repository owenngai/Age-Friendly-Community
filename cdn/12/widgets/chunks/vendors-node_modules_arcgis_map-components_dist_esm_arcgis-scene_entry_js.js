"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-node_modules_arcgis_map-components_dist_esm_arcgis-scene_entry_js"],{

/***/ "./node_modules/@arcgis/map-components/dist/esm/arcgis-scene.entry.js":
/*!****************************************************************************!*\
  !*** ./node_modules/@arcgis/map-components/dist/esm/arcgis-scene.entry.js ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_scene: () => (/* binding */ ArcgisScene)
/* harmony export */ });
/* harmony import */ var _index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-6e172aac.js */ "./node_modules/@arcgis/map-components/dist/esm/index-6e172aac.js");
/* harmony import */ var _index_0bc55ca5_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./index-0bc55ca5.js */ "./node_modules/@arcgis/map-components/dist/esm/index-0bc55ca5.js");
/* harmony import */ var _component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./component-utils-23194f7c.js */ "./node_modules/@arcgis/map-components/dist/esm/component-utils-23194f7c.js");
/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.30/esri/copyright.txt for details.
 * v4.30.0-next.37
 */




const sceneCss = ".arcgis-scene{padding:0;margin:0;height:100%;width:100%}";

const ArcgisScene = class {
    constructor(hostRef) {
        (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisViewReadyChange = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewReadyChange", 7);
        this.arcgisViewChange = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewChange", 7);
        this.arcgisViewClick = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewClick", 7);
        this.arcgisViewDoubleClick = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewDoubleClick", 7);
        this.arcgisViewDrag = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewDrag", 7);
        this.arcgisViewHold = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewHold", 7);
        this.arcgisViewImmediateClick = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewImmediateClick", 7);
        this.arcgisViewImmediateDoubleClick = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewImmediateDoubleClick", 7);
        this.arcgisViewKeyDown = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewKeyDown", 7);
        this.arcgisViewKeyUp = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewKeyUp", 7);
        this.arcgisViewLayerviewCreate = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewLayerviewCreate", 7);
        this.arcgisViewLayerviewCreateError = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewLayerviewCreateError", 7);
        this.arcgisViewLayerviewDestroy = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewLayerviewDestroy", 7);
        this.arcgisViewMouseWheel = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewMouseWheel", 7);
        this.arcgisViewPointerDown = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewPointerDown", 7);
        this.arcgisViewPointerEnter = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewPointerEnter", 7);
        this.arcgisViewPointerLeave = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewPointerLeave", 7);
        this.arcgisViewPointerMove = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewPointerMove", 7);
        this.arcgisViewPointerUp = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisViewPointerUp", 7);
        this._watchHandles = [];
        this.allLayerViews = undefined;
        this.alphaCompositingEnabled = false;
        this.analyses = undefined;
        this.basemapView = undefined;
        this.basemap = undefined;
        this.camera = undefined;
        this.center = undefined;
        this.clippingArea = undefined;
        this.constraints = undefined;
        this.destroyDisabled = false;
        this.environment = undefined;
        this.extent = undefined;
        this.fatalError = undefined;
        this.floors = undefined;
        this.gamepad = undefined;
        this.graphics = undefined;
        this.ground = undefined;
        this.groundView = undefined;
        this.highlightOptions = undefined;
        this.interacting = false;
        this.itemId = undefined;
        this.layerViews = undefined;
        this.magnifier = undefined;
        this.map = undefined;
        this.navigating = false;
        this.navigation = undefined;
        this.padding = undefined;
        this.performanceInfo = undefined;
        this.popup = undefined;
        this.popupEnabled = true;
        this.qualityProfile = undefined;
        this.ready = false;
        this.resolution = undefined;
        this.scale = undefined;
        this.spatialReference = undefined;
        this.stationary = undefined;
        this.suspended = false;
        this.theme = undefined;
        this.timeExtent = undefined;
        this.toMap = undefined;
        this.toScreen = undefined;
        this.updating = false;
        this.viewingMode = "global";
        this.viewpoint = undefined;
        this.zoom = undefined;
        this.view = undefined;
    }
    alphaCompositingEnabledWatcher(value) {
        if (value !== undefined && this.view) {
            this.view.alphaCompositingEnabled = value;
        }
    }
    basemapWatcher(value) {
        if (typeof value === "string" && this.view?.map && !(0,_component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__.i)(value)) {
            this.view.map.basemap = value;
        }
        else if (this.view?.map) {
            this.view.map.basemap = value;
        }
    }
    cameraWatcher(value) {
        if (this.view && value && (0,_component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__.e)(this.view.camera, value)) {
            this.view.camera = value;
        }
    }
    centerWatcher(value, old) {
        if (value !== old && this.view) {
            if (typeof value === "string") {
                // check if center is string
                const center = value.split(",").map((x) => Number(x));
                if (center[0] !== this.view.center.longitude && center[1] !== this.view.center.latitude) {
                    this.view.center = center;
                }
            }
            else if (Array.isArray(value)) {
                // array
                if (value[0] !== this.view.center.longitude && value[1] !== this.view.center.latitude) {
                    this.view.center = value;
                }
            }
            else if (!this.view.center.equals(value)) {
                // finally a point
                this.view.center = value;
            }
        }
    }
    clippingAreaWatcher(value) {
        if (this.view && value && !this.view.clippingArea?.equals(value)) {
            this.view.clippingArea = value;
        }
    }
    constraintsWatcher(value) {
        if (this.view) {
            this.view.constraints = value;
        }
    }
    environmentWatcher(value) {
        if (this.view &&
            value &&
            (0,_component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__.f)(this.view.environment, value)) {
            this.view.environment = value;
        }
    }
    extentWatcher(value) {
        if (this.view && value && !this.view.extent.equals(value)) {
            this.view.extent = value;
        }
    }
    floorsWatcher(value) {
        if (this.view) {
            this.view.floors = value;
        }
    }
    graphicsWatcher(value) {
        if (this.view) {
            this.view.graphics = value;
        }
    }
    groundWatcher(value) {
        if (this.view?.map && !(0,_component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__.i)(value)) {
            this.view.map.ground = value;
        }
    }
    highlightOptionsWatcher(value) {
        if (this.view) {
            this.view.highlightOptions = value;
        }
    }
    itemIdWatcher(value, old) {
        // NOTE: there is an issue when users set the value to undefined.
        // https://github.com/ionic-team/stencil/issues/2814
        // If user sets `itemid` to `undefined`, Stencil 2 will log the following warning:
        // `The state/prop "${propName}" changed during rendering.`
        // `This can potentially lead to infinite-loops and other bugs.`
        //
        // It appears consumer setting the value to null does not cause this warning.
        // In Stencil 4, if a user sets property to undefined, will trigger change, but
        // will not remove attribute from DOM.
        if (value !== old) {
            if (this.view?.map) {
                void this._updateMap();
            }
            else {
                void this._loadMap();
            }
        }
    }
    mapWatcher(value) {
        if (this.view) {
            this.view.map = value;
        }
    }
    navigationWatcher(value) {
        if (this.view) {
            this.view.navigation = value;
        }
    }
    paddingWatcher(value) {
        if (this.view) {
            this.view.padding = value;
        }
    }
    popupWatcher(value) {
        if (this.view) {
            this.view.popup = value;
        }
    }
    popupEnabledWatcher(value, old) {
        if (value !== old && this.view) {
            this.view.popupEnabled = value;
        }
    }
    qualityProfileWatcher(value) {
        if (this.view && this.view.qualityProfile !== value) {
            this.view.qualityProfile = value;
        }
    }
    scaleWatcher(value, old) {
        if (this.view && this.view.stationary && !this.view.interacting && value != null && value !== old) {
            this.view.scale = value;
        }
    }
    spatialReferenceWatcher(value) {
        if (this.view && value && !this.view.spatialReference.equals(value)) {
            this.view.spatialReference = value;
        }
    }
    themeWatcher(value) {
        if (this.view) {
            this.view.theme = value;
        }
    }
    timeExtentWatcher(value) {
        if (this.view) {
            this.view.timeExtent = value;
        }
    }
    viewingModeWatcher(value) {
        if (this.view) {
            this.view.viewingMode = value;
        }
    }
    viewpointWatcher(value) {
        if (this.view && (0,_component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__.b)(this.view.viewpoint, value)) {
            this.view.viewpoint = value;
        }
    }
    zoomWatcher(value, old) {
        if (this.view && this.view.stationary && !this.view.interacting && value !== old && (0,_component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__.g)(value)) {
            this.view.zoom = value;
        }
    }
    //--------------------------------------------------------------------------
    //
    //  Methods
    //
    //--------------------------------------------------------------------------
    async closePopup() {
        this.view?.closePopup();
    }
    async destroy() {
        if (this.destroyDisabled) {
            this._clearWatchHandles();
            this.view.destroy();
        }
    }
    async goTo(target, options) {
        return (await this.view?.goTo(target, options));
    }
    async hitTest(screenPoint, options) {
        return await this.view?.hitTest(screenPoint, options);
    }
    async openPopup(options) {
        return (await this.view?.openPopup(options));
    }
    async takeScreenshot(options) {
        return await this.view?.takeScreenshot(options);
    }
    async tryFatalErrorRecovery() {
        this.view?.tryFatalErrorRecovery();
    }
    async whenAnalysisView(analysis) {
        return await this.view?.whenAnalysisView(analysis);
    }
    async whenLayerView(layer) {
        return await this.view?.whenLayerView(layer);
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentWillLoad() {
        if (!this.view) {
            await this._loadMap();
        }
    }
    componentDidRender() {
        if (this.view && !this.view.container) {
            this.view.container = this.el;
        }
    }
    componentDidLoad() {
        this._proxyEvents();
    }
    disconnectedCallback() {
        void this.destroy();
    }
    render() {
        return (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { class: "arcgis-scene", ref: (el) => (this.el = el) });
    }
    //--------------------------------------------------------------------------
    //
    //  Private Methods
    //
    //--------------------------------------------------------------------------
    _clearWatchHandles() {
        this._watchHandles.forEach((handle) => handle.remove());
        this._watchHandles = [];
    }
    async _addWatchers() {
        const { watch, when } = await (0,_index_0bc55ca5_js__WEBPACK_IMPORTED_MODULE_1__.i)();
        (0,_component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__.a)(this, [
            // watch for stationary and emit arcgisViewChange event
            watch(() => this.view.stationary, () => {
                this.stationary = this.view.stationary;
                this.interacting = this.view.interacting;
                this.navigating = this.view.navigating;
                this.arcgisViewChange.emit();
            }, {
                initial: true,
            }),
            // when view stationary is true, update these props:
            // zoom, scale, center, rotation, extent, camera, viewpoint
            when(() => this.view.stationary, () => {
                this.camera = this.view.camera;
                this.center = this.view.center;
                this.extent = this.view.extent;
                this.scale = this.view.scale;
                this.viewpoint = this.view.viewpoint;
                this.zoom = this.view.zoom;
                this.spatialReference = this.view.spatialReference;
            }),
            // watchers for other props to update component
            watch(() => this.view.allLayerViews, () => {
                this.allLayerViews = this.view.allLayerViews;
            }, {
                initial: true,
            }),
            watch(() => this.view.analyses, () => {
                this.analyses = this.view.analyses;
            }, {
                initial: true,
            }),
            watch(() => this.view.map?.basemap, () => {
                this.basemap = this.view.map?.basemap;
            }, {
                initial: true,
            }),
            watch(() => this.view.basemapView, () => {
                this.basemapView = this.view.basemapView;
            }, {
                initial: true,
            }),
            watch(() => this.view.environment, () => {
                this.environment = this.view.environment;
            }, {
                initial: true,
            }),
            watch(() => this.view.fatalError, () => {
                this.fatalError = this.view.fatalError;
            }, {
                initial: true,
            }),
            watch(() => this.view.input.gamepad, () => {
                this.gamepad = this.view.input.gamepad;
            }, {
                initial: true,
            }),
            watch(() => this.view.graphics, () => {
                this.graphics = this.view.graphics;
            }, {
                initial: true,
            }),
            watch(() => this.view.map?.ground, () => {
                this.ground = this.view.map?.ground;
            }, {
                initial: true,
            }),
            watch(() => this.view.groundView, () => {
                this.groundView = this.view.groundView;
            }, {
                initial: true,
            }),
            // Start: arcgisStationaryChange events
            watch(() => this.view.interacting, () => {
                this.interacting = this.view.interacting;
            }),
            watch(() => this.view.navigating, () => {
                this.navigating = this.view.navigating;
            }),
            watch(() => this.view.stationary, () => {
                this.stationary = this.view.stationary;
            }),
            watch(() => this.view.layerViews, () => {
                this.layerViews = this.view.layerViews;
            }, {
                initial: true,
            }),
            watch(() => this.view.navigation, () => {
                this.navigation = this.view.navigation;
            }, {
                initial: true,
            }),
            watch(() => this.view.map, () => {
                this.map = this.view.map;
            }, {
                initial: true,
            }),
            watch(() => this.view.performanceInfo, () => {
                this.performanceInfo = this.view.performanceInfo;
            }),
            watch(() => this.view.popup, () => {
                this.popup = this.view.popup;
            }, {
                initial: true,
            }),
            watch(() => this.view.qualityProfile, () => {
                this.qualityProfile = this.view.qualityProfile;
            }, {
                initial: true,
            }),
            watch(() => this.view.resolution, () => {
                this.resolution = this.view.resolution;
            }, {
                initial: true,
            }),
            watch(() => this.view.suspended, () => {
                this.suspended = this.view.suspended;
            }, {
                initial: true,
            }),
            watch(() => this.view.updating, () => {
                this.updating = this.view.updating;
            }, {
                initial: true,
            }),
            // watch for ready and emit arcgisViewReadyChange event
            watch(() => this.view.ready, () => {
                this.ready = this.view.ready;
                this.arcgisViewReadyChange.emit();
            }, {
                initial: true,
            }),
        ]);
    }
    async _createMap() {
        const mapParams = {};
        if (this.itemId) {
            mapParams.portalItem = await this._createPortalItem();
        }
        if (this.basemap) {
            mapParams.basemap = this.basemap;
        }
        else if ((0,_component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__.i)(this.itemId)) {
            mapParams.basemap = "topo-vector";
        }
        if (this.ground) {
            mapParams.ground = this.ground;
        }
        else if ((0,_component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__.i)(this.itemId)) {
            mapParams.ground = "world-elevation";
        }
        const map = await (0,_index_0bc55ca5_js__WEBPACK_IMPORTED_MODULE_1__.R)(mapParams);
        return map;
    }
    async _createPortalItem() {
        const itemProps = {};
        if (this.itemId) {
            itemProps.id = this.itemId;
        }
        return itemProps;
    }
    _createViewParams() {
        const params = {};
        if (this.alphaCompositingEnabled !== undefined) {
            params.alphaCompositingEnabled = this.alphaCompositingEnabled;
        }
        if (this.center) {
            if (typeof this.center === "string") {
                params.center = this.center.split(",").map((x) => Number(x));
            }
            else {
                params.center = this.center;
            }
        }
        if (this.camera) {
            params.camera = this.camera;
        }
        if (this.clippingArea) {
            params.clippingArea = this.clippingArea;
        }
        if (this.constraints) {
            params.constraints = this.constraints;
        }
        if (this.environment) {
            params.environment = this.environment;
        }
        if (this.extent) {
            params.extent = this.extent;
        }
        if (this.floors) {
            params.floors = this.floors;
        }
        if (this.graphics) {
            params.graphics = this.graphics;
        }
        if (this.highlightOptions) {
            params.highlightOptions = this.highlightOptions;
        }
        if (this.map) {
            params.map = this.map;
        }
        if (this.navigation) {
            params.navigation = this.navigation;
        }
        if (this.padding) {
            params.padding = this.padding;
        }
        if (this.popup) {
            params.popup = this.popup;
        }
        if (this.popupEnabled !== undefined) {
            params.popupEnabled = this.popupEnabled;
        }
        if (this.qualityProfile) {
            params.qualityProfile = this.qualityProfile;
        }
        if (this.scale !== undefined) {
            params.scale = this.scale;
        }
        if (this.spatialReference) {
            params.spatialReference = this.spatialReference;
        }
        if (this.theme) {
            params.theme = this.theme;
        }
        if (this.timeExtent) {
            params.timeExtent = this.timeExtent;
        }
        if (this.viewingMode) {
            params.viewingMode = this.viewingMode;
        }
        if (this.viewpoint) {
            params.viewpoint = this.viewpoint;
        }
        if (this.zoom !== undefined) {
            params.zoom = this.zoom;
        }
        return params;
    }
    async _loadMap() {
        const map = await this._createMap();
        const params = this._createViewParams();
        const view = await (0,_index_0bc55ca5_js__WEBPACK_IMPORTED_MODULE_1__.S)({
            map,
            ...params,
        });
        this.view = view;
        return void view.when(async () => {
            // proxy view functions
            this.toMap = view.toMap.bind(view);
            this.toScreen = view.toScreen.bind(view);
            await this._addWatchers();
        });
    }
    _proxyEvents() {
        (0,_component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__.a)(this, [
            this.view.on("click", (event) => {
                this.arcgisViewClick.emit(event);
            }),
            this.view.on("double-click", (event) => {
                this.arcgisViewDoubleClick.emit(event);
            }),
            this.view.on("drag", (event) => {
                this.arcgisViewDrag.emit(event);
            }),
            this.view.on("hold", (event) => {
                this.arcgisViewHold.emit(event);
            }),
            this.view.on("immediate-click", (event) => {
                this.arcgisViewImmediateClick.emit(event);
            }),
            this.view.on("immediate-double-click", (event) => {
                this.arcgisViewImmediateDoubleClick.emit(event);
            }),
            this.view.on("key-down", (event) => {
                this.arcgisViewKeyDown.emit(event);
            }),
            this.view.on("key-up", (event) => {
                this.arcgisViewKeyUp.emit(event);
            }),
            this.view.on("layerview-create", (event) => {
                this.arcgisViewLayerviewCreate.emit(event);
            }),
            this.view.on("layerview-create-error", (event) => {
                this.arcgisViewLayerviewCreateError.emit(event);
            }),
            this.view.on("layerview-destroy", (event) => {
                this.arcgisViewLayerviewDestroy.emit(event);
            }),
            this.view.on("mouse-wheel", (event) => {
                this.arcgisViewMouseWheel.emit(event);
            }),
            this.view.on("pointer-down", (event) => {
                this.arcgisViewPointerDown.emit(event);
            }),
            this.view.on("pointer-enter", (event) => {
                this.arcgisViewPointerEnter.emit(event);
            }),
            this.view.on("pointer-leave", (event) => {
                this.arcgisViewPointerLeave.emit(event);
            }),
            this.view.on("pointer-move", (event) => {
                this.arcgisViewPointerMove.emit(event);
            }),
            this.view.on("pointer-up", (event) => {
                this.arcgisViewPointerUp.emit(event);
            }),
        ]);
    }
    async _updateMap() {
        if (this.view?.map) {
            this.view.map.destroy();
            const map = await this._createMap();
            this.view.map = map;
        }
    }
    get _hostElement() { return (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.g)(this); }
    static get watchers() { return {
        "alphaCompositingEnabled": ["alphaCompositingEnabledWatcher"],
        "basemap": ["basemapWatcher"],
        "camera": ["cameraWatcher"],
        "center": ["centerWatcher"],
        "clippingArea": ["clippingAreaWatcher"],
        "constraints": ["constraintsWatcher"],
        "environment": ["environmentWatcher"],
        "extent": ["extentWatcher"],
        "floors": ["floorsWatcher"],
        "graphics": ["graphicsWatcher"],
        "ground": ["groundWatcher"],
        "highlightOptions": ["highlightOptionsWatcher"],
        "itemId": ["itemIdWatcher"],
        "map": ["mapWatcher"],
        "navigation": ["navigationWatcher"],
        "padding": ["paddingWatcher"],
        "popup": ["popupWatcher"],
        "popupEnabled": ["popupEnabledWatcher"],
        "qualityProfile": ["qualityProfileWatcher"],
        "scale": ["scaleWatcher"],
        "spatialReference": ["spatialReferenceWatcher"],
        "theme": ["themeWatcher"],
        "timeExtent": ["timeExtentWatcher"],
        "viewingMode": ["viewingModeWatcher"],
        "viewpoint": ["viewpointWatcher"],
        "zoom": ["zoomWatcher"]
    }; }
};
ArcgisScene.style = sceneCss;




/***/ }),

/***/ "./node_modules/@arcgis/map-components/dist/esm/component-utils-23194f7c.js":
/*!**********************************************************************************!*\
  !*** ./node_modules/@arcgis/map-components/dist/esm/component-utils-23194f7c.js ***!
  \**********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ addHandles),
/* harmony export */   b: () => (/* binding */ isNotSameViewpoint),
/* harmony export */   c: () => (/* binding */ checkForView),
/* harmony export */   d: () => (/* binding */ checkForExpand),
/* harmony export */   e: () => (/* binding */ isNotSameCamera),
/* harmony export */   f: () => (/* binding */ isNotSameEnvironment),
/* harmony export */   g: () => (/* binding */ isValidInteger),
/* harmony export */   i: () => (/* binding */ isNullOrEmptyString),
/* harmony export */   r: () => (/* binding */ referenceElementHelper)
/* harmony export */ });
/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.30/esri/copyright.txt for details.
 * v4.30.0-next.37
 */
function checkForExpand(element) {
    const expandRef = element.el.closest("arcgis-expand") ?? element.expandElem;
    if (expandRef?.widget) {
        element.view = expandRef.view;
        expandRef.widget.content = element.childElem ?? element.el;
        // TODO: Update to be expandIcon = widget.icon, not ready yet in 4.27next
        if (!expandRef.expandIcon) {
            expandRef.widget.expandIcon = element.widget ? element.widget.icon : element?.icon;
        }
        return true;
    }
    if (expandRef) {
        const widgetHandler = () => {
            expandRef.removeEventListener("arcgisExpandReady", widgetHandler, false);
            element.view = expandRef.view;
            expandRef.widget.content = element.childElem ?? element.el;
            if (!expandRef.expandIcon) {
                expandRef.widget.expandIcon = element.widget ? element.widget.icon : element?.icon;
            }
        };
        expandRef.addEventListener("arcgisExpandReady", widgetHandler, false);
        return true;
    }
    return false;
}

//--------------------------------------------------------------------------
//
//  Public Methods
//
//--------------------------------------------------------------------------
function addHandles(element, handle) {
    if (Array.isArray(handle)) {
        element._watchHandles = [...element._watchHandles, ...handle];
    }
    else {
        element._watchHandles.push(handle);
    }
}
function checkForView(element) {
    let isUsingReferenceElement = false;
    if (!checkForExpand(element)) {
        let viewRef = element.el.closest("arcgis-map") ?? element.el.closest("arcgis-scene");
        if (!viewRef && typeof element.referenceElement === "string") {
            viewRef = document.querySelector(element.referenceElement);
            isUsingReferenceElement = true;
        }
        if (viewRef?.view) {
            element.view = viewRef.view;
            const el = element.childElem ?? element.el;
            if (!isUsingReferenceElement) {
                element.view.ui.add(el, element.position);
            }
        }
        else if (viewRef) {
            waitForViewHandler(viewRef, element, isUsingReferenceElement);
        }
    }
    else {
        const viewRef = element.el.closest("arcgis-map") ?? element.el.closest("arcgis-scene");
        if (viewRef?.view) {
            element.view = viewRef.view;
        }
        else if (viewRef) {
            const handler = () => {
                viewRef.removeEventListener("arcgisViewReadyChange", handler, false);
                element.view = viewRef.view;
            };
            viewRef.addEventListener("arcgisViewReadyChange", handler, false);
        }
    }
}
function isNullOrEmptyString(value) {
    return value === undefined || value === null || value === "";
}
function isValidInteger(value) {
    return value != null && value % 1 === 0;
}
function isNotSameCamera(camera, camera2) {
    return (camera2 === undefined ||
        camera.position !== camera2.position ||
        camera.heading !== camera2.heading ||
        camera.tilt !== camera2.tilt);
}
function isNotSameEnvironment(environment, environment2) {
    return (environment2 === undefined ||
        environment2.atmosphereEnabled !== environment.atmosphereEnabled ||
        environment2.lighting.date !== environment.lighting.date ||
        environment2.lighting.directShadowsEnabled !==
            environment.lighting.directShadowsEnabled ||
        environment2.lighting.cameraTrackingEnabled !==
            environment.lighting.cameraTrackingEnabled ||
        environment2.lighting.date !== environment.lighting.date ||
        environment2.lighting.displayUTCOffset !==
            environment.lighting.displayUTCOffset);
}
function isNotSameViewpoint(viewpoint, viewpoint2) {
    return (viewpoint2 === undefined ||
        viewpoint.targetGeometry !== viewpoint2.targetGeometry ||
        viewpoint.rotation !== viewpoint2.rotation ||
        viewpoint.scale !== viewpoint2.scale);
}
async function updateForView(viewStr) {
    const viewRef = document.querySelector(viewStr);
    return await new Promise((resolve) => {
        if (viewRef?.view !== undefined) {
            resolve(viewRef.view);
        }
        else if (viewRef) {
            const handler = () => {
                viewRef.removeEventListener("arcgisViewReadyChange", handler, false);
                resolve(viewRef.view);
            };
            viewRef.addEventListener("arcgisViewReadyChange", handler, false);
        }
    });
}
async function referenceElementHelper(element, refElement) {
    if (refElement === undefined)
        return;
    else if (typeof refElement === "string") {
        element.view = await updateForView(refElement);
    }
    else if (element.widget) {
        element.view = refElement.view;
    }
}
//--------------------------------------------------------------------------
//
//  Private Methods
//
//--------------------------------------------------------------------------
function waitForViewHandler(viewRef, element, isUsingRefernceElement) {
    const handler = () => {
        viewRef.removeEventListener("arcgisViewReadyChange", handler, false);
        element.view = viewRef.view;
        if (!isUsingRefernceElement) {
            element.view.ui.add(element.childElem ?? element.el, element.position);
        }
    };
    viewRef.addEventListener("arcgisViewReadyChange", handler, false);
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvdmVuZG9ycy1ub2RlX21vZHVsZXNfYXJjZ2lzX21hcC1jb21wb25lbnRzX2Rpc3RfZXNtX2FyY2dpcy1zY2VuZV9lbnRyeV9qcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNrRztBQUNXO0FBQzRFOztBQUV6TCxnQ0FBZ0MsVUFBVSxTQUFTLFlBQVksV0FBVzs7QUFFMUU7QUFDQTtBQUNBLFFBQVEscURBQWdCO0FBQ3hCLHFDQUFxQyxxREFBVztBQUNoRCxnQ0FBZ0MscURBQVc7QUFDM0MsK0JBQStCLHFEQUFXO0FBQzFDLHFDQUFxQyxxREFBVztBQUNoRCw4QkFBOEIscURBQVc7QUFDekMsOEJBQThCLHFEQUFXO0FBQ3pDLHdDQUF3QyxxREFBVztBQUNuRCw4Q0FBOEMscURBQVc7QUFDekQsaUNBQWlDLHFEQUFXO0FBQzVDLCtCQUErQixxREFBVztBQUMxQyx5Q0FBeUMscURBQVc7QUFDcEQsOENBQThDLHFEQUFXO0FBQ3pELDBDQUEwQyxxREFBVztBQUNyRCxvQ0FBb0MscURBQVc7QUFDL0MscUNBQXFDLHFEQUFXO0FBQ2hELHNDQUFzQyxxREFBVztBQUNqRCxzQ0FBc0MscURBQVc7QUFDakQscUNBQXFDLHFEQUFXO0FBQ2hELG1DQUFtQyxxREFBVztBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0REFBNEQsK0RBQW1CO0FBQy9FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLCtEQUFlO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSwrREFBb0I7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsK0RBQW1CO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhCQUE4QixTQUFTO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLCtEQUFrQjtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBLDRGQUE0RiwrREFBYztBQUMxRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLHFEQUFDLFVBQVUsb0RBQW9EO0FBQzlFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsY0FBYyxRQUFRLHFEQUF1QjtBQUM3RCxRQUFRLCtEQUFVO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQiwrREFBbUI7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQiwrREFBbUI7QUFDcEM7QUFDQTtBQUNBLDBCQUEwQixxREFBVztBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIscURBQWlCO0FBQzVDO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxRQUFRLCtEQUFVO0FBQ2xCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsT0FBTyxxREFBVTtBQUMxQyw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFdUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDeHBCdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFeU4iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vbm9kZV9tb2R1bGVzL0BhcmNnaXMvbWFwLWNvbXBvbmVudHMvZGlzdC9lc20vYXJjZ2lzLXNjZW5lLmVudHJ5LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9ub2RlX21vZHVsZXMvQGFyY2dpcy9tYXAtY29tcG9uZW50cy9kaXN0L2VzbS9jb21wb25lbnQtdXRpbHMtMjMxOTRmN2MuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVzcmksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogU2VlIGh0dHBzOi8vanMuYXJjZ2lzLmNvbS80LjMwL2VzcmkvY29weXJpZ2h0LnR4dCBmb3IgZGV0YWlscy5cbiAqIHY0LjMwLjAtbmV4dC4zN1xuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIGcgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtNmUxNzJhYWMuanMnO1xuaW1wb3J0IHsgaSBhcyBpbXBvcnRDb3JlUmVhY3RpdmVVdGlscywgUiBhcyBuZXdXZWJTY2VuZSwgUyBhcyBuZXdWaWV3c1NjZW5lVmlldyB9IGZyb20gJy4vaW5kZXgtMGJjNTVjYTUuanMnO1xuaW1wb3J0IHsgaSBhcyBpc051bGxPckVtcHR5U3RyaW5nLCBlIGFzIGlzTm90U2FtZUNhbWVyYSwgZiBhcyBpc05vdFNhbWVFbnZpcm9ubWVudCwgYiBhcyBpc05vdFNhbWVWaWV3cG9pbnQsIGcgYXMgaXNWYWxpZEludGVnZXIsIGEgYXMgYWRkSGFuZGxlcyB9IGZyb20gJy4vY29tcG9uZW50LXV0aWxzLTIzMTk0ZjdjLmpzJztcblxuY29uc3Qgc2NlbmVDc3MgPSBcIi5hcmNnaXMtc2NlbmV7cGFkZGluZzowO21hcmdpbjowO2hlaWdodDoxMDAlO3dpZHRoOjEwMCV9XCI7XG5cbmNvbnN0IEFyY2dpc1NjZW5lID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5hcmNnaXNWaWV3UmVhZHlDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1ZpZXdSZWFkeUNoYW5nZVwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNWaWV3Q2hhbmdlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNWaWV3Q2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1ZpZXdDbGljayA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzVmlld0NsaWNrXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1ZpZXdEb3VibGVDbGljayA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzVmlld0RvdWJsZUNsaWNrXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1ZpZXdEcmFnID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNWaWV3RHJhZ1wiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNWaWV3SG9sZCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzVmlld0hvbGRcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzVmlld0ltbWVkaWF0ZUNsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNWaWV3SW1tZWRpYXRlQ2xpY2tcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzVmlld0ltbWVkaWF0ZURvdWJsZUNsaWNrID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNWaWV3SW1tZWRpYXRlRG91YmxlQ2xpY2tcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzVmlld0tleURvd24gPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1ZpZXdLZXlEb3duXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1ZpZXdLZXlVcCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzVmlld0tleVVwXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1ZpZXdMYXllcnZpZXdDcmVhdGUgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1ZpZXdMYXllcnZpZXdDcmVhdGVcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzVmlld0xheWVydmlld0NyZWF0ZUVycm9yID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNWaWV3TGF5ZXJ2aWV3Q3JlYXRlRXJyb3JcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzVmlld0xheWVydmlld0Rlc3Ryb3kgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1ZpZXdMYXllcnZpZXdEZXN0cm95XCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1ZpZXdNb3VzZVdoZWVsID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNWaWV3TW91c2VXaGVlbFwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNWaWV3UG9pbnRlckRvd24gPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1ZpZXdQb2ludGVyRG93blwiLCA3KTtcbiAgICAgICAgdGhpcy5hcmNnaXNWaWV3UG9pbnRlckVudGVyID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNWaWV3UG9pbnRlckVudGVyXCIsIDcpO1xuICAgICAgICB0aGlzLmFyY2dpc1ZpZXdQb2ludGVyTGVhdmUgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1ZpZXdQb2ludGVyTGVhdmVcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzVmlld1BvaW50ZXJNb3ZlID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNWaWV3UG9pbnRlck1vdmVcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzVmlld1BvaW50ZXJVcCA9IGNyZWF0ZUV2ZW50KHRoaXMsIFwiYXJjZ2lzVmlld1BvaW50ZXJVcFwiLCA3KTtcbiAgICAgICAgdGhpcy5fd2F0Y2hIYW5kbGVzID0gW107XG4gICAgICAgIHRoaXMuYWxsTGF5ZXJWaWV3cyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5hbHBoYUNvbXBvc2l0aW5nRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmFuYWx5c2VzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmJhc2VtYXBWaWV3ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmJhc2VtYXAgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY2FtZXJhID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmNlbnRlciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5jbGlwcGluZ0FyZWEgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY29uc3RyYWludHMgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZGVzdHJveURpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZW52aXJvbm1lbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZXh0ZW50ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmZhdGFsRXJyb3IgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZmxvb3JzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmdhbWVwYWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZ3JhcGhpY3MgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuZ3JvdW5kID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmdyb3VuZFZpZXcgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaGlnaGxpZ2h0T3B0aW9ucyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pbnRlcmFjdGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLml0ZW1JZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sYXllclZpZXdzID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm1hZ25pZmllciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5tYXAgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubmF2aWdhdGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5hdmlnYXRpb24gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucGFkZGluZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5wZXJmb3JtYW5jZUluZm8gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9wdXAgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucG9wdXBFbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5xdWFsaXR5UHJvZmlsZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5yZWFkeSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJlc29sdXRpb24gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc2NhbGUgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3BhdGlhbFJlZmVyZW5jZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zdGF0aW9uYXJ5ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnN1c3BlbmRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnRoZW1lID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnRpbWVFeHRlbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudG9NYXAgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudG9TY3JlZW4gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudXBkYXRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy52aWV3aW5nTW9kZSA9IFwiZ2xvYmFsXCI7XG4gICAgICAgIHRoaXMudmlld3BvaW50ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnpvb20gPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMudmlldyA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgYWxwaGFDb21wb3NpdGluZ0VuYWJsZWRXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMudmlldykge1xuICAgICAgICAgICAgdGhpcy52aWV3LmFscGhhQ29tcG9zaXRpbmdFbmFibGVkID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYmFzZW1hcFdhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiAmJiB0aGlzLnZpZXc/Lm1hcCAmJiAhaXNOdWxsT3JFbXB0eVN0cmluZyh2YWx1ZSkpIHtcbiAgICAgICAgICAgIHRoaXMudmlldy5tYXAuYmFzZW1hcCA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMudmlldz8ubWFwKSB7XG4gICAgICAgICAgICB0aGlzLnZpZXcubWFwLmJhc2VtYXAgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjYW1lcmFXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLnZpZXcgJiYgdmFsdWUgJiYgaXNOb3RTYW1lQ2FtZXJhKHRoaXMudmlldy5jYW1lcmEsIHZhbHVlKSkge1xuICAgICAgICAgICAgdGhpcy52aWV3LmNhbWVyYSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNlbnRlcldhdGNoZXIodmFsdWUsIG9sZCkge1xuICAgICAgICBpZiAodmFsdWUgIT09IG9sZCAmJiB0aGlzLnZpZXcpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiBjZW50ZXIgaXMgc3RyaW5nXG4gICAgICAgICAgICAgICAgY29uc3QgY2VudGVyID0gdmFsdWUuc3BsaXQoXCIsXCIpLm1hcCgoeCkgPT4gTnVtYmVyKHgpKTtcbiAgICAgICAgICAgICAgICBpZiAoY2VudGVyWzBdICE9PSB0aGlzLnZpZXcuY2VudGVyLmxvbmdpdHVkZSAmJiBjZW50ZXJbMV0gIT09IHRoaXMudmlldy5jZW50ZXIubGF0aXR1ZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3LmNlbnRlciA9IGNlbnRlcjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIC8vIGFycmF5XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlWzBdICE9PSB0aGlzLnZpZXcuY2VudGVyLmxvbmdpdHVkZSAmJiB2YWx1ZVsxXSAhPT0gdGhpcy52aWV3LmNlbnRlci5sYXRpdHVkZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZpZXcuY2VudGVyID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIXRoaXMudmlldy5jZW50ZXIuZXF1YWxzKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIC8vIGZpbmFsbHkgYSBwb2ludFxuICAgICAgICAgICAgICAgIHRoaXMudmlldy5jZW50ZXIgPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBjbGlwcGluZ0FyZWFXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLnZpZXcgJiYgdmFsdWUgJiYgIXRoaXMudmlldy5jbGlwcGluZ0FyZWE/LmVxdWFscyh2YWx1ZSkpIHtcbiAgICAgICAgICAgIHRoaXMudmlldy5jbGlwcGluZ0FyZWEgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdHJhaW50c1dhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMudmlldykge1xuICAgICAgICAgICAgdGhpcy52aWV3LmNvbnN0cmFpbnRzID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZW52aXJvbm1lbnRXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLnZpZXcgJiZcbiAgICAgICAgICAgIHZhbHVlICYmXG4gICAgICAgICAgICBpc05vdFNhbWVFbnZpcm9ubWVudCh0aGlzLnZpZXcuZW52aXJvbm1lbnQsIHZhbHVlKSkge1xuICAgICAgICAgICAgdGhpcy52aWV3LmVudmlyb25tZW50ID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZXh0ZW50V2F0Y2hlcih2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy52aWV3ICYmIHZhbHVlICYmICF0aGlzLnZpZXcuZXh0ZW50LmVxdWFscyh2YWx1ZSkpIHtcbiAgICAgICAgICAgIHRoaXMudmlldy5leHRlbnQgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmbG9vcnNXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLnZpZXcpIHtcbiAgICAgICAgICAgIHRoaXMudmlldy5mbG9vcnMgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBncmFwaGljc1dhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMudmlldykge1xuICAgICAgICAgICAgdGhpcy52aWV3LmdyYXBoaWNzID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ3JvdW5kV2F0Y2hlcih2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy52aWV3Py5tYXAgJiYgIWlzTnVsbE9yRW1wdHlTdHJpbmcodmFsdWUpKSB7XG4gICAgICAgICAgICB0aGlzLnZpZXcubWFwLmdyb3VuZCA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhpZ2hsaWdodE9wdGlvbnNXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLnZpZXcpIHtcbiAgICAgICAgICAgIHRoaXMudmlldy5oaWdobGlnaHRPcHRpb25zID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaXRlbUlkV2F0Y2hlcih2YWx1ZSwgb2xkKSB7XG4gICAgICAgIC8vIE5PVEU6IHRoZXJlIGlzIGFuIGlzc3VlIHdoZW4gdXNlcnMgc2V0IHRoZSB2YWx1ZSB0byB1bmRlZmluZWQuXG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9pb25pYy10ZWFtL3N0ZW5jaWwvaXNzdWVzLzI4MTRcbiAgICAgICAgLy8gSWYgdXNlciBzZXRzIGBpdGVtaWRgIHRvIGB1bmRlZmluZWRgLCBTdGVuY2lsIDIgd2lsbCBsb2cgdGhlIGZvbGxvd2luZyB3YXJuaW5nOlxuICAgICAgICAvLyBgVGhlIHN0YXRlL3Byb3AgXCIke3Byb3BOYW1lfVwiIGNoYW5nZWQgZHVyaW5nIHJlbmRlcmluZy5gXG4gICAgICAgIC8vIGBUaGlzIGNhbiBwb3RlbnRpYWxseSBsZWFkIHRvIGluZmluaXRlLWxvb3BzIGFuZCBvdGhlciBidWdzLmBcbiAgICAgICAgLy9cbiAgICAgICAgLy8gSXQgYXBwZWFycyBjb25zdW1lciBzZXR0aW5nIHRoZSB2YWx1ZSB0byBudWxsIGRvZXMgbm90IGNhdXNlIHRoaXMgd2FybmluZy5cbiAgICAgICAgLy8gSW4gU3RlbmNpbCA0LCBpZiBhIHVzZXIgc2V0cyBwcm9wZXJ0eSB0byB1bmRlZmluZWQsIHdpbGwgdHJpZ2dlciBjaGFuZ2UsIGJ1dFxuICAgICAgICAvLyB3aWxsIG5vdCByZW1vdmUgYXR0cmlidXRlIGZyb20gRE9NLlxuICAgICAgICBpZiAodmFsdWUgIT09IG9sZCkge1xuICAgICAgICAgICAgaWYgKHRoaXMudmlldz8ubWFwKSB7XG4gICAgICAgICAgICAgICAgdm9pZCB0aGlzLl91cGRhdGVNYXAoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZvaWQgdGhpcy5fbG9hZE1hcCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIG1hcFdhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMudmlldykge1xuICAgICAgICAgICAgdGhpcy52aWV3Lm1hcCA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIG5hdmlnYXRpb25XYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLnZpZXcpIHtcbiAgICAgICAgICAgIHRoaXMudmlldy5uYXZpZ2F0aW9uID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcGFkZGluZ1dhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMudmlldykge1xuICAgICAgICAgICAgdGhpcy52aWV3LnBhZGRpbmcgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwb3B1cFdhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMudmlldykge1xuICAgICAgICAgICAgdGhpcy52aWV3LnBvcHVwID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcG9wdXBFbmFibGVkV2F0Y2hlcih2YWx1ZSwgb2xkKSB7XG4gICAgICAgIGlmICh2YWx1ZSAhPT0gb2xkICYmIHRoaXMudmlldykge1xuICAgICAgICAgICAgdGhpcy52aWV3LnBvcHVwRW5hYmxlZCA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHF1YWxpdHlQcm9maWxlV2F0Y2hlcih2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy52aWV3ICYmIHRoaXMudmlldy5xdWFsaXR5UHJvZmlsZSAhPT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMudmlldy5xdWFsaXR5UHJvZmlsZSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNjYWxlV2F0Y2hlcih2YWx1ZSwgb2xkKSB7XG4gICAgICAgIGlmICh0aGlzLnZpZXcgJiYgdGhpcy52aWV3LnN0YXRpb25hcnkgJiYgIXRoaXMudmlldy5pbnRlcmFjdGluZyAmJiB2YWx1ZSAhPSBudWxsICYmIHZhbHVlICE9PSBvbGQpIHtcbiAgICAgICAgICAgIHRoaXMudmlldy5zY2FsZSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNwYXRpYWxSZWZlcmVuY2VXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLnZpZXcgJiYgdmFsdWUgJiYgIXRoaXMudmlldy5zcGF0aWFsUmVmZXJlbmNlLmVxdWFscyh2YWx1ZSkpIHtcbiAgICAgICAgICAgIHRoaXMudmlldy5zcGF0aWFsUmVmZXJlbmNlID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdGhlbWVXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLnZpZXcpIHtcbiAgICAgICAgICAgIHRoaXMudmlldy50aGVtZSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHRpbWVFeHRlbnRXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLnZpZXcpIHtcbiAgICAgICAgICAgIHRoaXMudmlldy50aW1lRXh0ZW50ID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdmlld2luZ01vZGVXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLnZpZXcpIHtcbiAgICAgICAgICAgIHRoaXMudmlldy52aWV3aW5nTW9kZSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHZpZXdwb2ludFdhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMudmlldyAmJiBpc05vdFNhbWVWaWV3cG9pbnQodGhpcy52aWV3LnZpZXdwb2ludCwgdmFsdWUpKSB7XG4gICAgICAgICAgICB0aGlzLnZpZXcudmlld3BvaW50ID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgem9vbVdhdGNoZXIodmFsdWUsIG9sZCkge1xuICAgICAgICBpZiAodGhpcy52aWV3ICYmIHRoaXMudmlldy5zdGF0aW9uYXJ5ICYmICF0aGlzLnZpZXcuaW50ZXJhY3RpbmcgJiYgdmFsdWUgIT09IG9sZCAmJiBpc1ZhbGlkSW50ZWdlcih2YWx1ZSkpIHtcbiAgICAgICAgICAgIHRoaXMudmlldy56b29tID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBjbG9zZVBvcHVwKCkge1xuICAgICAgICB0aGlzLnZpZXc/LmNsb3NlUG9wdXAoKTtcbiAgICB9XG4gICAgYXN5bmMgZGVzdHJveSgpIHtcbiAgICAgICAgaWYgKHRoaXMuZGVzdHJveURpc2FibGVkKSB7XG4gICAgICAgICAgICB0aGlzLl9jbGVhcldhdGNoSGFuZGxlcygpO1xuICAgICAgICAgICAgdGhpcy52aWV3LmRlc3Ryb3koKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBnb1RvKHRhcmdldCwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gKGF3YWl0IHRoaXMudmlldz8uZ29Ubyh0YXJnZXQsIG9wdGlvbnMpKTtcbiAgICB9XG4gICAgYXN5bmMgaGl0VGVzdChzY3JlZW5Qb2ludCwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy52aWV3Py5oaXRUZXN0KHNjcmVlblBvaW50LCBvcHRpb25zKTtcbiAgICB9XG4gICAgYXN5bmMgb3BlblBvcHVwKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIChhd2FpdCB0aGlzLnZpZXc/Lm9wZW5Qb3B1cChvcHRpb25zKSk7XG4gICAgfVxuICAgIGFzeW5jIHRha2VTY3JlZW5zaG90KG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMudmlldz8udGFrZVNjcmVlbnNob3Qob3B0aW9ucyk7XG4gICAgfVxuICAgIGFzeW5jIHRyeUZhdGFsRXJyb3JSZWNvdmVyeSgpIHtcbiAgICAgICAgdGhpcy52aWV3Py50cnlGYXRhbEVycm9yUmVjb3ZlcnkoKTtcbiAgICB9XG4gICAgYXN5bmMgd2hlbkFuYWx5c2lzVmlldyhhbmFseXNpcykge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy52aWV3Py53aGVuQW5hbHlzaXNWaWV3KGFuYWx5c2lzKTtcbiAgICB9XG4gICAgYXN5bmMgd2hlbkxheWVyVmlldyhsYXllcikge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy52aWV3Py53aGVuTGF5ZXJWaWV3KGxheWVyKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBpZiAoIXRoaXMudmlldykge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5fbG9hZE1hcCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudERpZFJlbmRlcigpIHtcbiAgICAgICAgaWYgKHRoaXMudmlldyAmJiAhdGhpcy52aWV3LmNvbnRhaW5lcikge1xuICAgICAgICAgICAgdGhpcy52aWV3LmNvbnRhaW5lciA9IHRoaXMuZWw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgdGhpcy5fcHJveHlFdmVudHMoKTtcbiAgICB9XG4gICAgZGlzY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgIHZvaWQgdGhpcy5kZXN0cm95KCk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIGgoXCJkaXZcIiwgeyBjbGFzczogXCJhcmNnaXMtc2NlbmVcIiwgcmVmOiAoZWwpID0+ICh0aGlzLmVsID0gZWwpIH0pO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJpdmF0ZSBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgX2NsZWFyV2F0Y2hIYW5kbGVzKCkge1xuICAgICAgICB0aGlzLl93YXRjaEhhbmRsZXMuZm9yRWFjaCgoaGFuZGxlKSA9PiBoYW5kbGUucmVtb3ZlKCkpO1xuICAgICAgICB0aGlzLl93YXRjaEhhbmRsZXMgPSBbXTtcbiAgICB9XG4gICAgYXN5bmMgX2FkZFdhdGNoZXJzKCkge1xuICAgICAgICBjb25zdCB7IHdhdGNoLCB3aGVuIH0gPSBhd2FpdCBpbXBvcnRDb3JlUmVhY3RpdmVVdGlscygpO1xuICAgICAgICBhZGRIYW5kbGVzKHRoaXMsIFtcbiAgICAgICAgICAgIC8vIHdhdGNoIGZvciBzdGF0aW9uYXJ5IGFuZCBlbWl0IGFyY2dpc1ZpZXdDaGFuZ2UgZXZlbnRcbiAgICAgICAgICAgIHdhdGNoKCgpID0+IHRoaXMudmlldy5zdGF0aW9uYXJ5LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0aW9uYXJ5ID0gdGhpcy52aWV3LnN0YXRpb25hcnk7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnRlcmFjdGluZyA9IHRoaXMudmlldy5pbnRlcmFjdGluZztcbiAgICAgICAgICAgICAgICB0aGlzLm5hdmlnYXRpbmcgPSB0aGlzLnZpZXcubmF2aWdhdGluZztcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1ZpZXdDaGFuZ2UuZW1pdCgpO1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIGluaXRpYWw6IHRydWUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIC8vIHdoZW4gdmlldyBzdGF0aW9uYXJ5IGlzIHRydWUsIHVwZGF0ZSB0aGVzZSBwcm9wczpcbiAgICAgICAgICAgIC8vIHpvb20sIHNjYWxlLCBjZW50ZXIsIHJvdGF0aW9uLCBleHRlbnQsIGNhbWVyYSwgdmlld3BvaW50XG4gICAgICAgICAgICB3aGVuKCgpID0+IHRoaXMudmlldy5zdGF0aW9uYXJ5LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYW1lcmEgPSB0aGlzLnZpZXcuY2FtZXJhO1xuICAgICAgICAgICAgICAgIHRoaXMuY2VudGVyID0gdGhpcy52aWV3LmNlbnRlcjtcbiAgICAgICAgICAgICAgICB0aGlzLmV4dGVudCA9IHRoaXMudmlldy5leHRlbnQ7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2FsZSA9IHRoaXMudmlldy5zY2FsZTtcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXdwb2ludCA9IHRoaXMudmlldy52aWV3cG9pbnQ7XG4gICAgICAgICAgICAgICAgdGhpcy56b29tID0gdGhpcy52aWV3Lnpvb207XG4gICAgICAgICAgICAgICAgdGhpcy5zcGF0aWFsUmVmZXJlbmNlID0gdGhpcy52aWV3LnNwYXRpYWxSZWZlcmVuY2U7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIC8vIHdhdGNoZXJzIGZvciBvdGhlciBwcm9wcyB0byB1cGRhdGUgY29tcG9uZW50XG4gICAgICAgICAgICB3YXRjaCgoKSA9PiB0aGlzLnZpZXcuYWxsTGF5ZXJWaWV3cywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYWxsTGF5ZXJWaWV3cyA9IHRoaXMudmlldy5hbGxMYXllclZpZXdzO1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIGluaXRpYWw6IHRydWUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHdhdGNoKCgpID0+IHRoaXMudmlldy5hbmFseXNlcywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYW5hbHlzZXMgPSB0aGlzLnZpZXcuYW5hbHlzZXM7XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgaW5pdGlhbDogdHJ1ZSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgd2F0Y2goKCkgPT4gdGhpcy52aWV3Lm1hcD8uYmFzZW1hcCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYmFzZW1hcCA9IHRoaXMudmlldy5tYXA/LmJhc2VtYXA7XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgaW5pdGlhbDogdHJ1ZSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgd2F0Y2goKCkgPT4gdGhpcy52aWV3LmJhc2VtYXBWaWV3LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5iYXNlbWFwVmlldyA9IHRoaXMudmlldy5iYXNlbWFwVmlldztcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBpbml0aWFsOiB0cnVlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB3YXRjaCgoKSA9PiB0aGlzLnZpZXcuZW52aXJvbm1lbnQsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmVudmlyb25tZW50ID0gdGhpcy52aWV3LmVudmlyb25tZW50O1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIGluaXRpYWw6IHRydWUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHdhdGNoKCgpID0+IHRoaXMudmlldy5mYXRhbEVycm9yLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5mYXRhbEVycm9yID0gdGhpcy52aWV3LmZhdGFsRXJyb3I7XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgaW5pdGlhbDogdHJ1ZSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgd2F0Y2goKCkgPT4gdGhpcy52aWV3LmlucHV0LmdhbWVwYWQsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmdhbWVwYWQgPSB0aGlzLnZpZXcuaW5wdXQuZ2FtZXBhZDtcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBpbml0aWFsOiB0cnVlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB3YXRjaCgoKSA9PiB0aGlzLnZpZXcuZ3JhcGhpY3MsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyYXBoaWNzID0gdGhpcy52aWV3LmdyYXBoaWNzO1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIGluaXRpYWw6IHRydWUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHdhdGNoKCgpID0+IHRoaXMudmlldy5tYXA/Lmdyb3VuZCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZ3JvdW5kID0gdGhpcy52aWV3Lm1hcD8uZ3JvdW5kO1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIGluaXRpYWw6IHRydWUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHdhdGNoKCgpID0+IHRoaXMudmlldy5ncm91bmRWaWV3LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5ncm91bmRWaWV3ID0gdGhpcy52aWV3Lmdyb3VuZFZpZXc7XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgaW5pdGlhbDogdHJ1ZSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgLy8gU3RhcnQ6IGFyY2dpc1N0YXRpb25hcnlDaGFuZ2UgZXZlbnRzXG4gICAgICAgICAgICB3YXRjaCgoKSA9PiB0aGlzLnZpZXcuaW50ZXJhY3RpbmcsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmludGVyYWN0aW5nID0gdGhpcy52aWV3LmludGVyYWN0aW5nO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB3YXRjaCgoKSA9PiB0aGlzLnZpZXcubmF2aWdhdGluZywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubmF2aWdhdGluZyA9IHRoaXMudmlldy5uYXZpZ2F0aW5nO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB3YXRjaCgoKSA9PiB0aGlzLnZpZXcuc3RhdGlvbmFyeSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGlvbmFyeSA9IHRoaXMudmlldy5zdGF0aW9uYXJ5O1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB3YXRjaCgoKSA9PiB0aGlzLnZpZXcubGF5ZXJWaWV3cywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubGF5ZXJWaWV3cyA9IHRoaXMudmlldy5sYXllclZpZXdzO1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIGluaXRpYWw6IHRydWUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHdhdGNoKCgpID0+IHRoaXMudmlldy5uYXZpZ2F0aW9uLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5uYXZpZ2F0aW9uID0gdGhpcy52aWV3Lm5hdmlnYXRpb247XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgaW5pdGlhbDogdHJ1ZSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgd2F0Y2goKCkgPT4gdGhpcy52aWV3Lm1hcCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMubWFwID0gdGhpcy52aWV3Lm1hcDtcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBpbml0aWFsOiB0cnVlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB3YXRjaCgoKSA9PiB0aGlzLnZpZXcucGVyZm9ybWFuY2VJbmZvLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wZXJmb3JtYW5jZUluZm8gPSB0aGlzLnZpZXcucGVyZm9ybWFuY2VJbmZvO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB3YXRjaCgoKSA9PiB0aGlzLnZpZXcucG9wdXAsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnBvcHVwID0gdGhpcy52aWV3LnBvcHVwO1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIGluaXRpYWw6IHRydWUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHdhdGNoKCgpID0+IHRoaXMudmlldy5xdWFsaXR5UHJvZmlsZSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucXVhbGl0eVByb2ZpbGUgPSB0aGlzLnZpZXcucXVhbGl0eVByb2ZpbGU7XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgaW5pdGlhbDogdHJ1ZSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgd2F0Y2goKCkgPT4gdGhpcy52aWV3LnJlc29sdXRpb24sICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc29sdXRpb24gPSB0aGlzLnZpZXcucmVzb2x1dGlvbjtcbiAgICAgICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBpbml0aWFsOiB0cnVlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB3YXRjaCgoKSA9PiB0aGlzLnZpZXcuc3VzcGVuZGVkLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdXNwZW5kZWQgPSB0aGlzLnZpZXcuc3VzcGVuZGVkO1xuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIGluaXRpYWw6IHRydWUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHdhdGNoKCgpID0+IHRoaXMudmlldy51cGRhdGluZywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRpbmcgPSB0aGlzLnZpZXcudXBkYXRpbmc7XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgaW5pdGlhbDogdHJ1ZSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgLy8gd2F0Y2ggZm9yIHJlYWR5IGFuZCBlbWl0IGFyY2dpc1ZpZXdSZWFkeUNoYW5nZSBldmVudFxuICAgICAgICAgICAgd2F0Y2goKCkgPT4gdGhpcy52aWV3LnJlYWR5LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWFkeSA9IHRoaXMudmlldy5yZWFkeTtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1ZpZXdSZWFkeUNoYW5nZS5lbWl0KCk7XG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgaW5pdGlhbDogdHJ1ZSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICBdKTtcbiAgICB9XG4gICAgYXN5bmMgX2NyZWF0ZU1hcCgpIHtcbiAgICAgICAgY29uc3QgbWFwUGFyYW1zID0ge307XG4gICAgICAgIGlmICh0aGlzLml0ZW1JZCkge1xuICAgICAgICAgICAgbWFwUGFyYW1zLnBvcnRhbEl0ZW0gPSBhd2FpdCB0aGlzLl9jcmVhdGVQb3J0YWxJdGVtKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuYmFzZW1hcCkge1xuICAgICAgICAgICAgbWFwUGFyYW1zLmJhc2VtYXAgPSB0aGlzLmJhc2VtYXA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaXNOdWxsT3JFbXB0eVN0cmluZyh0aGlzLml0ZW1JZCkpIHtcbiAgICAgICAgICAgIG1hcFBhcmFtcy5iYXNlbWFwID0gXCJ0b3BvLXZlY3RvclwiO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmdyb3VuZCkge1xuICAgICAgICAgICAgbWFwUGFyYW1zLmdyb3VuZCA9IHRoaXMuZ3JvdW5kO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlzTnVsbE9yRW1wdHlTdHJpbmcodGhpcy5pdGVtSWQpKSB7XG4gICAgICAgICAgICBtYXBQYXJhbXMuZ3JvdW5kID0gXCJ3b3JsZC1lbGV2YXRpb25cIjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtYXAgPSBhd2FpdCBuZXdXZWJTY2VuZShtYXBQYXJhbXMpO1xuICAgICAgICByZXR1cm4gbWFwO1xuICAgIH1cbiAgICBhc3luYyBfY3JlYXRlUG9ydGFsSXRlbSgpIHtcbiAgICAgICAgY29uc3QgaXRlbVByb3BzID0ge307XG4gICAgICAgIGlmICh0aGlzLml0ZW1JZCkge1xuICAgICAgICAgICAgaXRlbVByb3BzLmlkID0gdGhpcy5pdGVtSWQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGl0ZW1Qcm9wcztcbiAgICB9XG4gICAgX2NyZWF0ZVZpZXdQYXJhbXMoKSB7XG4gICAgICAgIGNvbnN0IHBhcmFtcyA9IHt9O1xuICAgICAgICBpZiAodGhpcy5hbHBoYUNvbXBvc2l0aW5nRW5hYmxlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBwYXJhbXMuYWxwaGFDb21wb3NpdGluZ0VuYWJsZWQgPSB0aGlzLmFscGhhQ29tcG9zaXRpbmdFbmFibGVkO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNlbnRlcikge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmNlbnRlciA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIHBhcmFtcy5jZW50ZXIgPSB0aGlzLmNlbnRlci5zcGxpdChcIixcIikubWFwKCh4KSA9PiBOdW1iZXIoeCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLmNlbnRlciA9IHRoaXMuY2VudGVyO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNhbWVyYSkge1xuICAgICAgICAgICAgcGFyYW1zLmNhbWVyYSA9IHRoaXMuY2FtZXJhO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNsaXBwaW5nQXJlYSkge1xuICAgICAgICAgICAgcGFyYW1zLmNsaXBwaW5nQXJlYSA9IHRoaXMuY2xpcHBpbmdBcmVhO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNvbnN0cmFpbnRzKSB7XG4gICAgICAgICAgICBwYXJhbXMuY29uc3RyYWludHMgPSB0aGlzLmNvbnN0cmFpbnRzO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmVudmlyb25tZW50KSB7XG4gICAgICAgICAgICBwYXJhbXMuZW52aXJvbm1lbnQgPSB0aGlzLmVudmlyb25tZW50O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmV4dGVudCkge1xuICAgICAgICAgICAgcGFyYW1zLmV4dGVudCA9IHRoaXMuZXh0ZW50O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmZsb29ycykge1xuICAgICAgICAgICAgcGFyYW1zLmZsb29ycyA9IHRoaXMuZmxvb3JzO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmdyYXBoaWNzKSB7XG4gICAgICAgICAgICBwYXJhbXMuZ3JhcGhpY3MgPSB0aGlzLmdyYXBoaWNzO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmhpZ2hsaWdodE9wdGlvbnMpIHtcbiAgICAgICAgICAgIHBhcmFtcy5oaWdobGlnaHRPcHRpb25zID0gdGhpcy5oaWdobGlnaHRPcHRpb25zO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm1hcCkge1xuICAgICAgICAgICAgcGFyYW1zLm1hcCA9IHRoaXMubWFwO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm5hdmlnYXRpb24pIHtcbiAgICAgICAgICAgIHBhcmFtcy5uYXZpZ2F0aW9uID0gdGhpcy5uYXZpZ2F0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBhZGRpbmcpIHtcbiAgICAgICAgICAgIHBhcmFtcy5wYWRkaW5nID0gdGhpcy5wYWRkaW5nO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBvcHVwKSB7XG4gICAgICAgICAgICBwYXJhbXMucG9wdXAgPSB0aGlzLnBvcHVwO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBvcHVwRW5hYmxlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBwYXJhbXMucG9wdXBFbmFibGVkID0gdGhpcy5wb3B1cEVuYWJsZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucXVhbGl0eVByb2ZpbGUpIHtcbiAgICAgICAgICAgIHBhcmFtcy5xdWFsaXR5UHJvZmlsZSA9IHRoaXMucXVhbGl0eVByb2ZpbGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2NhbGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcGFyYW1zLnNjYWxlID0gdGhpcy5zY2FsZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zcGF0aWFsUmVmZXJlbmNlKSB7XG4gICAgICAgICAgICBwYXJhbXMuc3BhdGlhbFJlZmVyZW5jZSA9IHRoaXMuc3BhdGlhbFJlZmVyZW5jZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50aGVtZSkge1xuICAgICAgICAgICAgcGFyYW1zLnRoZW1lID0gdGhpcy50aGVtZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50aW1lRXh0ZW50KSB7XG4gICAgICAgICAgICBwYXJhbXMudGltZUV4dGVudCA9IHRoaXMudGltZUV4dGVudDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy52aWV3aW5nTW9kZSkge1xuICAgICAgICAgICAgcGFyYW1zLnZpZXdpbmdNb2RlID0gdGhpcy52aWV3aW5nTW9kZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy52aWV3cG9pbnQpIHtcbiAgICAgICAgICAgIHBhcmFtcy52aWV3cG9pbnQgPSB0aGlzLnZpZXdwb2ludDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy56b29tICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHBhcmFtcy56b29tID0gdGhpcy56b29tO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXJhbXM7XG4gICAgfVxuICAgIGFzeW5jIF9sb2FkTWFwKCkge1xuICAgICAgICBjb25zdCBtYXAgPSBhd2FpdCB0aGlzLl9jcmVhdGVNYXAoKTtcbiAgICAgICAgY29uc3QgcGFyYW1zID0gdGhpcy5fY3JlYXRlVmlld1BhcmFtcygpO1xuICAgICAgICBjb25zdCB2aWV3ID0gYXdhaXQgbmV3Vmlld3NTY2VuZVZpZXcoe1xuICAgICAgICAgICAgbWFwLFxuICAgICAgICAgICAgLi4ucGFyYW1zLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy52aWV3ID0gdmlldztcbiAgICAgICAgcmV0dXJuIHZvaWQgdmlldy53aGVuKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8vIHByb3h5IHZpZXcgZnVuY3Rpb25zXG4gICAgICAgICAgICB0aGlzLnRvTWFwID0gdmlldy50b01hcC5iaW5kKHZpZXcpO1xuICAgICAgICAgICAgdGhpcy50b1NjcmVlbiA9IHZpZXcudG9TY3JlZW4uYmluZCh2aWV3KTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX2FkZFdhdGNoZXJzKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBfcHJveHlFdmVudHMoKSB7XG4gICAgICAgIGFkZEhhbmRsZXModGhpcywgW1xuICAgICAgICAgICAgdGhpcy52aWV3Lm9uKFwiY2xpY2tcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNWaWV3Q2xpY2suZW1pdChldmVudCk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHRoaXMudmlldy5vbihcImRvdWJsZS1jbGlja1wiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1ZpZXdEb3VibGVDbGljay5lbWl0KGV2ZW50KTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgdGhpcy52aWV3Lm9uKFwiZHJhZ1wiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1ZpZXdEcmFnLmVtaXQoZXZlbnQpO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB0aGlzLnZpZXcub24oXCJob2xkXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzVmlld0hvbGQuZW1pdChldmVudCk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHRoaXMudmlldy5vbihcImltbWVkaWF0ZS1jbGlja1wiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1ZpZXdJbW1lZGlhdGVDbGljay5lbWl0KGV2ZW50KTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgdGhpcy52aWV3Lm9uKFwiaW1tZWRpYXRlLWRvdWJsZS1jbGlja1wiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1ZpZXdJbW1lZGlhdGVEb3VibGVDbGljay5lbWl0KGV2ZW50KTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgdGhpcy52aWV3Lm9uKFwia2V5LWRvd25cIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNWaWV3S2V5RG93bi5lbWl0KGV2ZW50KTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgdGhpcy52aWV3Lm9uKFwia2V5LXVwXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzVmlld0tleVVwLmVtaXQoZXZlbnQpO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB0aGlzLnZpZXcub24oXCJsYXllcnZpZXctY3JlYXRlXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzVmlld0xheWVydmlld0NyZWF0ZS5lbWl0KGV2ZW50KTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgdGhpcy52aWV3Lm9uKFwibGF5ZXJ2aWV3LWNyZWF0ZS1lcnJvclwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1ZpZXdMYXllcnZpZXdDcmVhdGVFcnJvci5lbWl0KGV2ZW50KTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgdGhpcy52aWV3Lm9uKFwibGF5ZXJ2aWV3LWRlc3Ryb3lcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNWaWV3TGF5ZXJ2aWV3RGVzdHJveS5lbWl0KGV2ZW50KTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgdGhpcy52aWV3Lm9uKFwibW91c2Utd2hlZWxcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcmNnaXNWaWV3TW91c2VXaGVlbC5lbWl0KGV2ZW50KTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgdGhpcy52aWV3Lm9uKFwicG9pbnRlci1kb3duXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzVmlld1BvaW50ZXJEb3duLmVtaXQoZXZlbnQpO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB0aGlzLnZpZXcub24oXCJwb2ludGVyLWVudGVyXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJjZ2lzVmlld1BvaW50ZXJFbnRlci5lbWl0KGV2ZW50KTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgdGhpcy52aWV3Lm9uKFwicG9pbnRlci1sZWF2ZVwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1ZpZXdQb2ludGVyTGVhdmUuZW1pdChldmVudCk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHRoaXMudmlldy5vbihcInBvaW50ZXItbW92ZVwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1ZpZXdQb2ludGVyTW92ZS5lbWl0KGV2ZW50KTtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgdGhpcy52aWV3Lm9uKFwicG9pbnRlci11cFwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFyY2dpc1ZpZXdQb2ludGVyVXAuZW1pdChldmVudCk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgXSk7XG4gICAgfVxuICAgIGFzeW5jIF91cGRhdGVNYXAoKSB7XG4gICAgICAgIGlmICh0aGlzLnZpZXc/Lm1hcCkge1xuICAgICAgICAgICAgdGhpcy52aWV3Lm1hcC5kZXN0cm95KCk7XG4gICAgICAgICAgICBjb25zdCBtYXAgPSBhd2FpdCB0aGlzLl9jcmVhdGVNYXAoKTtcbiAgICAgICAgICAgIHRoaXMudmlldy5tYXAgPSBtYXA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IF9ob3N0RWxlbWVudCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgICAgICBcImFscGhhQ29tcG9zaXRpbmdFbmFibGVkXCI6IFtcImFscGhhQ29tcG9zaXRpbmdFbmFibGVkV2F0Y2hlclwiXSxcbiAgICAgICAgXCJiYXNlbWFwXCI6IFtcImJhc2VtYXBXYXRjaGVyXCJdLFxuICAgICAgICBcImNhbWVyYVwiOiBbXCJjYW1lcmFXYXRjaGVyXCJdLFxuICAgICAgICBcImNlbnRlclwiOiBbXCJjZW50ZXJXYXRjaGVyXCJdLFxuICAgICAgICBcImNsaXBwaW5nQXJlYVwiOiBbXCJjbGlwcGluZ0FyZWFXYXRjaGVyXCJdLFxuICAgICAgICBcImNvbnN0cmFpbnRzXCI6IFtcImNvbnN0cmFpbnRzV2F0Y2hlclwiXSxcbiAgICAgICAgXCJlbnZpcm9ubWVudFwiOiBbXCJlbnZpcm9ubWVudFdhdGNoZXJcIl0sXG4gICAgICAgIFwiZXh0ZW50XCI6IFtcImV4dGVudFdhdGNoZXJcIl0sXG4gICAgICAgIFwiZmxvb3JzXCI6IFtcImZsb29yc1dhdGNoZXJcIl0sXG4gICAgICAgIFwiZ3JhcGhpY3NcIjogW1wiZ3JhcGhpY3NXYXRjaGVyXCJdLFxuICAgICAgICBcImdyb3VuZFwiOiBbXCJncm91bmRXYXRjaGVyXCJdLFxuICAgICAgICBcImhpZ2hsaWdodE9wdGlvbnNcIjogW1wiaGlnaGxpZ2h0T3B0aW9uc1dhdGNoZXJcIl0sXG4gICAgICAgIFwiaXRlbUlkXCI6IFtcIml0ZW1JZFdhdGNoZXJcIl0sXG4gICAgICAgIFwibWFwXCI6IFtcIm1hcFdhdGNoZXJcIl0sXG4gICAgICAgIFwibmF2aWdhdGlvblwiOiBbXCJuYXZpZ2F0aW9uV2F0Y2hlclwiXSxcbiAgICAgICAgXCJwYWRkaW5nXCI6IFtcInBhZGRpbmdXYXRjaGVyXCJdLFxuICAgICAgICBcInBvcHVwXCI6IFtcInBvcHVwV2F0Y2hlclwiXSxcbiAgICAgICAgXCJwb3B1cEVuYWJsZWRcIjogW1wicG9wdXBFbmFibGVkV2F0Y2hlclwiXSxcbiAgICAgICAgXCJxdWFsaXR5UHJvZmlsZVwiOiBbXCJxdWFsaXR5UHJvZmlsZVdhdGNoZXJcIl0sXG4gICAgICAgIFwic2NhbGVcIjogW1wic2NhbGVXYXRjaGVyXCJdLFxuICAgICAgICBcInNwYXRpYWxSZWZlcmVuY2VcIjogW1wic3BhdGlhbFJlZmVyZW5jZVdhdGNoZXJcIl0sXG4gICAgICAgIFwidGhlbWVcIjogW1widGhlbWVXYXRjaGVyXCJdLFxuICAgICAgICBcInRpbWVFeHRlbnRcIjogW1widGltZUV4dGVudFdhdGNoZXJcIl0sXG4gICAgICAgIFwidmlld2luZ01vZGVcIjogW1widmlld2luZ01vZGVXYXRjaGVyXCJdLFxuICAgICAgICBcInZpZXdwb2ludFwiOiBbXCJ2aWV3cG9pbnRXYXRjaGVyXCJdLFxuICAgICAgICBcInpvb21cIjogW1wiem9vbVdhdGNoZXJcIl1cbiAgICB9OyB9XG59O1xuQXJjZ2lzU2NlbmUuc3R5bGUgPSBzY2VuZUNzcztcblxuZXhwb3J0IHsgQXJjZ2lzU2NlbmUgYXMgYXJjZ2lzX3NjZW5lIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRXNyaSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiBTZWUgaHR0cHM6Ly9qcy5hcmNnaXMuY29tLzQuMzAvZXNyaS9jb3B5cmlnaHQudHh0IGZvciBkZXRhaWxzLlxuICogdjQuMzAuMC1uZXh0LjM3XG4gKi9cbmZ1bmN0aW9uIGNoZWNrRm9yRXhwYW5kKGVsZW1lbnQpIHtcbiAgICBjb25zdCBleHBhbmRSZWYgPSBlbGVtZW50LmVsLmNsb3Nlc3QoXCJhcmNnaXMtZXhwYW5kXCIpID8/IGVsZW1lbnQuZXhwYW5kRWxlbTtcbiAgICBpZiAoZXhwYW5kUmVmPy53aWRnZXQpIHtcbiAgICAgICAgZWxlbWVudC52aWV3ID0gZXhwYW5kUmVmLnZpZXc7XG4gICAgICAgIGV4cGFuZFJlZi53aWRnZXQuY29udGVudCA9IGVsZW1lbnQuY2hpbGRFbGVtID8/IGVsZW1lbnQuZWw7XG4gICAgICAgIC8vIFRPRE86IFVwZGF0ZSB0byBiZSBleHBhbmRJY29uID0gd2lkZ2V0Lmljb24sIG5vdCByZWFkeSB5ZXQgaW4gNC4yN25leHRcbiAgICAgICAgaWYgKCFleHBhbmRSZWYuZXhwYW5kSWNvbikge1xuICAgICAgICAgICAgZXhwYW5kUmVmLndpZGdldC5leHBhbmRJY29uID0gZWxlbWVudC53aWRnZXQgPyBlbGVtZW50LndpZGdldC5pY29uIDogZWxlbWVudD8uaWNvbjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGV4cGFuZFJlZikge1xuICAgICAgICBjb25zdCB3aWRnZXRIYW5kbGVyID0gKCkgPT4ge1xuICAgICAgICAgICAgZXhwYW5kUmVmLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJhcmNnaXNFeHBhbmRSZWFkeVwiLCB3aWRnZXRIYW5kbGVyLCBmYWxzZSk7XG4gICAgICAgICAgICBlbGVtZW50LnZpZXcgPSBleHBhbmRSZWYudmlldztcbiAgICAgICAgICAgIGV4cGFuZFJlZi53aWRnZXQuY29udGVudCA9IGVsZW1lbnQuY2hpbGRFbGVtID8/IGVsZW1lbnQuZWw7XG4gICAgICAgICAgICBpZiAoIWV4cGFuZFJlZi5leHBhbmRJY29uKSB7XG4gICAgICAgICAgICAgICAgZXhwYW5kUmVmLndpZGdldC5leHBhbmRJY29uID0gZWxlbWVudC53aWRnZXQgPyBlbGVtZW50LndpZGdldC5pY29uIDogZWxlbWVudD8uaWNvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgZXhwYW5kUmVmLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNFeHBhbmRSZWFkeVwiLCB3aWRnZXRIYW5kbGVyLCBmYWxzZSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vXG4vLyAgUHVibGljIE1ldGhvZHNcbi8vXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5mdW5jdGlvbiBhZGRIYW5kbGVzKGVsZW1lbnQsIGhhbmRsZSkge1xuICAgIGlmIChBcnJheS5pc0FycmF5KGhhbmRsZSkpIHtcbiAgICAgICAgZWxlbWVudC5fd2F0Y2hIYW5kbGVzID0gWy4uLmVsZW1lbnQuX3dhdGNoSGFuZGxlcywgLi4uaGFuZGxlXTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGVsZW1lbnQuX3dhdGNoSGFuZGxlcy5wdXNoKGhhbmRsZSk7XG4gICAgfVxufVxuZnVuY3Rpb24gY2hlY2tGb3JWaWV3KGVsZW1lbnQpIHtcbiAgICBsZXQgaXNVc2luZ1JlZmVyZW5jZUVsZW1lbnQgPSBmYWxzZTtcbiAgICBpZiAoIWNoZWNrRm9yRXhwYW5kKGVsZW1lbnQpKSB7XG4gICAgICAgIGxldCB2aWV3UmVmID0gZWxlbWVudC5lbC5jbG9zZXN0KFwiYXJjZ2lzLW1hcFwiKSA/PyBlbGVtZW50LmVsLmNsb3Nlc3QoXCJhcmNnaXMtc2NlbmVcIik7XG4gICAgICAgIGlmICghdmlld1JlZiAmJiB0eXBlb2YgZWxlbWVudC5yZWZlcmVuY2VFbGVtZW50ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICB2aWV3UmVmID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbGVtZW50LnJlZmVyZW5jZUVsZW1lbnQpO1xuICAgICAgICAgICAgaXNVc2luZ1JlZmVyZW5jZUVsZW1lbnQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2aWV3UmVmPy52aWV3KSB7XG4gICAgICAgICAgICBlbGVtZW50LnZpZXcgPSB2aWV3UmVmLnZpZXc7XG4gICAgICAgICAgICBjb25zdCBlbCA9IGVsZW1lbnQuY2hpbGRFbGVtID8/IGVsZW1lbnQuZWw7XG4gICAgICAgICAgICBpZiAoIWlzVXNpbmdSZWZlcmVuY2VFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC52aWV3LnVpLmFkZChlbCwgZWxlbWVudC5wb3NpdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodmlld1JlZikge1xuICAgICAgICAgICAgd2FpdEZvclZpZXdIYW5kbGVyKHZpZXdSZWYsIGVsZW1lbnQsIGlzVXNpbmdSZWZlcmVuY2VFbGVtZW50KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3Qgdmlld1JlZiA9IGVsZW1lbnQuZWwuY2xvc2VzdChcImFyY2dpcy1tYXBcIikgPz8gZWxlbWVudC5lbC5jbG9zZXN0KFwiYXJjZ2lzLXNjZW5lXCIpO1xuICAgICAgICBpZiAodmlld1JlZj8udmlldykge1xuICAgICAgICAgICAgZWxlbWVudC52aWV3ID0gdmlld1JlZi52aWV3O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHZpZXdSZWYpIHtcbiAgICAgICAgICAgIGNvbnN0IGhhbmRsZXIgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmlld1JlZi5yZW1vdmVFdmVudExpc3RlbmVyKFwiYXJjZ2lzVmlld1JlYWR5Q2hhbmdlXCIsIGhhbmRsZXIsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnZpZXcgPSB2aWV3UmVmLnZpZXc7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmlld1JlZi5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzVmlld1JlYWR5Q2hhbmdlXCIsIGhhbmRsZXIsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGlzTnVsbE9yRW1wdHlTdHJpbmcodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gXCJcIjtcbn1cbmZ1bmN0aW9uIGlzVmFsaWRJbnRlZ2VyKHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgdmFsdWUgJSAxID09PSAwO1xufVxuZnVuY3Rpb24gaXNOb3RTYW1lQ2FtZXJhKGNhbWVyYSwgY2FtZXJhMikge1xuICAgIHJldHVybiAoY2FtZXJhMiA9PT0gdW5kZWZpbmVkIHx8XG4gICAgICAgIGNhbWVyYS5wb3NpdGlvbiAhPT0gY2FtZXJhMi5wb3NpdGlvbiB8fFxuICAgICAgICBjYW1lcmEuaGVhZGluZyAhPT0gY2FtZXJhMi5oZWFkaW5nIHx8XG4gICAgICAgIGNhbWVyYS50aWx0ICE9PSBjYW1lcmEyLnRpbHQpO1xufVxuZnVuY3Rpb24gaXNOb3RTYW1lRW52aXJvbm1lbnQoZW52aXJvbm1lbnQsIGVudmlyb25tZW50Mikge1xuICAgIHJldHVybiAoZW52aXJvbm1lbnQyID09PSB1bmRlZmluZWQgfHxcbiAgICAgICAgZW52aXJvbm1lbnQyLmF0bW9zcGhlcmVFbmFibGVkICE9PSBlbnZpcm9ubWVudC5hdG1vc3BoZXJlRW5hYmxlZCB8fFxuICAgICAgICBlbnZpcm9ubWVudDIubGlnaHRpbmcuZGF0ZSAhPT0gZW52aXJvbm1lbnQubGlnaHRpbmcuZGF0ZSB8fFxuICAgICAgICBlbnZpcm9ubWVudDIubGlnaHRpbmcuZGlyZWN0U2hhZG93c0VuYWJsZWQgIT09XG4gICAgICAgICAgICBlbnZpcm9ubWVudC5saWdodGluZy5kaXJlY3RTaGFkb3dzRW5hYmxlZCB8fFxuICAgICAgICBlbnZpcm9ubWVudDIubGlnaHRpbmcuY2FtZXJhVHJhY2tpbmdFbmFibGVkICE9PVxuICAgICAgICAgICAgZW52aXJvbm1lbnQubGlnaHRpbmcuY2FtZXJhVHJhY2tpbmdFbmFibGVkIHx8XG4gICAgICAgIGVudmlyb25tZW50Mi5saWdodGluZy5kYXRlICE9PSBlbnZpcm9ubWVudC5saWdodGluZy5kYXRlIHx8XG4gICAgICAgIGVudmlyb25tZW50Mi5saWdodGluZy5kaXNwbGF5VVRDT2Zmc2V0ICE9PVxuICAgICAgICAgICAgZW52aXJvbm1lbnQubGlnaHRpbmcuZGlzcGxheVVUQ09mZnNldCk7XG59XG5mdW5jdGlvbiBpc05vdFNhbWVWaWV3cG9pbnQodmlld3BvaW50LCB2aWV3cG9pbnQyKSB7XG4gICAgcmV0dXJuICh2aWV3cG9pbnQyID09PSB1bmRlZmluZWQgfHxcbiAgICAgICAgdmlld3BvaW50LnRhcmdldEdlb21ldHJ5ICE9PSB2aWV3cG9pbnQyLnRhcmdldEdlb21ldHJ5IHx8XG4gICAgICAgIHZpZXdwb2ludC5yb3RhdGlvbiAhPT0gdmlld3BvaW50Mi5yb3RhdGlvbiB8fFxuICAgICAgICB2aWV3cG9pbnQuc2NhbGUgIT09IHZpZXdwb2ludDIuc2NhbGUpO1xufVxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlRm9yVmlldyh2aWV3U3RyKSB7XG4gICAgY29uc3Qgdmlld1JlZiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iodmlld1N0cik7XG4gICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgIGlmICh2aWV3UmVmPy52aWV3ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJlc29sdmUodmlld1JlZi52aWV3KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh2aWV3UmVmKSB7XG4gICAgICAgICAgICBjb25zdCBoYW5kbGVyID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZpZXdSZWYucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImFyY2dpc1ZpZXdSZWFkeUNoYW5nZVwiLCBoYW5kbGVyLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh2aWV3UmVmLnZpZXcpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZpZXdSZWYuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1ZpZXdSZWFkeUNoYW5nZVwiLCBoYW5kbGVyLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHJlZmVyZW5jZUVsZW1lbnRIZWxwZXIoZWxlbWVudCwgcmVmRWxlbWVudCkge1xuICAgIGlmIChyZWZFbGVtZW50ID09PSB1bmRlZmluZWQpXG4gICAgICAgIHJldHVybjtcbiAgICBlbHNlIGlmICh0eXBlb2YgcmVmRWxlbWVudCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICBlbGVtZW50LnZpZXcgPSBhd2FpdCB1cGRhdGVGb3JWaWV3KHJlZkVsZW1lbnQpO1xuICAgIH1cbiAgICBlbHNlIGlmIChlbGVtZW50LndpZGdldCkge1xuICAgICAgICBlbGVtZW50LnZpZXcgPSByZWZFbGVtZW50LnZpZXc7XG4gICAgfVxufVxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy9cbi8vICBQcml2YXRlIE1ldGhvZHNcbi8vXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5mdW5jdGlvbiB3YWl0Rm9yVmlld0hhbmRsZXIodmlld1JlZiwgZWxlbWVudCwgaXNVc2luZ1JlZmVybmNlRWxlbWVudCkge1xuICAgIGNvbnN0IGhhbmRsZXIgPSAoKSA9PiB7XG4gICAgICAgIHZpZXdSZWYucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImFyY2dpc1ZpZXdSZWFkeUNoYW5nZVwiLCBoYW5kbGVyLCBmYWxzZSk7XG4gICAgICAgIGVsZW1lbnQudmlldyA9IHZpZXdSZWYudmlldztcbiAgICAgICAgaWYgKCFpc1VzaW5nUmVmZXJuY2VFbGVtZW50KSB7XG4gICAgICAgICAgICBlbGVtZW50LnZpZXcudWkuYWRkKGVsZW1lbnQuY2hpbGRFbGVtID8/IGVsZW1lbnQuZWwsIGVsZW1lbnQucG9zaXRpb24pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICB2aWV3UmVmLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNWaWV3UmVhZHlDaGFuZ2VcIiwgaGFuZGxlciwgZmFsc2UpO1xufVxuXG5leHBvcnQgeyBhZGRIYW5kbGVzIGFzIGEsIGlzTm90U2FtZVZpZXdwb2ludCBhcyBiLCBjaGVja0ZvclZpZXcgYXMgYywgY2hlY2tGb3JFeHBhbmQgYXMgZCwgaXNOb3RTYW1lQ2FtZXJhIGFzIGUsIGlzTm90U2FtZUVudmlyb25tZW50IGFzIGYsIGlzVmFsaWRJbnRlZ2VyIGFzIGcsIGlzTnVsbE9yRW1wdHlTdHJpbmcgYXMgaSwgcmVmZXJlbmNlRWxlbWVudEhlbHBlciBhcyByIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=