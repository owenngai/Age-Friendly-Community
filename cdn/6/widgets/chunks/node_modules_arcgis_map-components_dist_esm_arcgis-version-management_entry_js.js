"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["node_modules_arcgis_map-components_dist_esm_arcgis-version-management_entry_js"],{

/***/ "./node_modules/@arcgis/map-components/dist/esm/arcgis-version-management.entry.js":
/*!*****************************************************************************************!*\
  !*** ./node_modules/@arcgis/map-components/dist/esm/arcgis-version-management.entry.js ***!
  \*****************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_version_management: () => (/* binding */ ArcgisVersionManagement)
/* harmony export */ });
/* harmony import */ var _index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-6e172aac.js */ "./node_modules/@arcgis/map-components/dist/esm/index-6e172aac.js");
/* harmony import */ var _index_0bc55ca5_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./index-0bc55ca5.js */ "./node_modules/@arcgis/map-components/dist/esm/index-0bc55ca5.js");
/* harmony import */ var _chunk_WQTCUXBS_9ec3781a_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./chunk-WQTCUXBS-9ec3781a.js */ "./node_modules/@arcgis/map-components/dist/esm/chunk-WQTCUXBS-9ec3781a.js");
/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.30/esri/copyright.txt for details.
 * v4.30.0-next.37
 */




const versionManagementCss = ".div-content{background-color:var(--calcite-ui-foreground-1);padding:0.75rem}.flow-main{width:330px}.notice{width:-webkit-fill-available}.panel-services{max-height:400px}.panel-versions{max-height:400px}";

const ArcgisVersionManagement = class {
    constructor(hostRef) {
        (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.manager = (0,_chunk_WQTCUXBS_9ec3781a_js__WEBPACK_IMPORTED_MODULE_2__.u)(this);
        this._watchHandles = [];
        this.label = undefined;
        this.position = "top-right";
        this.view = undefined;
        this.messages = this.manager.readonly((0,_chunk_WQTCUXBS_9ec3781a_js__WEBPACK_IMPORTED_MODULE_2__.c)({ blocking: true }));
        this.state = undefined;
    }
    positionWatcher(newValue) {
        if (newValue !== undefined && this.viewModel) {
            this.view.ui.move(this.el, newValue);
        }
    }
    async componentDidLoad() {
        const { watch } = await (0,_index_0bc55ca5_js__WEBPACK_IMPORTED_MODULE_1__.i)();
        this._watchHandles.push(watch(() => this.viewModel.state, (state) => {
            this.state = state;
        }));
    }
    async componentWillLoad() {
        await this._checkForView();
        this.viewModel = await (0,_index_0bc55ca5_js__WEBPACK_IMPORTED_MODULE_1__.a5)({
            view: this.view,
        });
        this.label = this.label ? this.label : this.messages.label;
    }
    disconnectedCallback() {
        this._watchHandles.forEach((handle) => {
            handle.remove();
        });
        this._watchHandles = [];
    }
    render() {
        const { messages, label, viewModel, viewModel: { state, loadError }, } = this;
        const arrayServiceNames = Array.from(this.viewModel.serviceNameLookup, ([url, name]) => ({ url, name }));
        return ((0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.h)(_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.H, null, (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow", { ref: (node) => {
                this.flowElement = node;
            }, class: "flow-main" }, (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-flow-item", { heading: label }, (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-panel", { class: "panel-services", loading: state === "loading" }, arrayServiceNames.map((service) => ((0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.h)("arcgis-version-management-service-item", { flowElement: this.flowElement, heading: label, serviceUrl: service.url, strings: messages, viewModel: viewModel, onVersionItemActionClickedEventWithServiceUrl: (e) => {
                if (this.flowElement) {
                    this._handleVersionItemActionClick(e, this.flowElement);
                }
            }, onVersionListActionClickedEvent: (e) => {
                if (this.flowElement) {
                    this._handleVersionListActionClick(e, this.flowElement);
                }
            } }))), state === "disabled" ? ((0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.h)("calcite-notice", { class: "notice", closable: false, kind: "warning", open: true, scale: "s", slot: "footer" }, (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { slot: "message" }, this._getLoadError(loadError)))) : undefined)))));
    }
    //--------------------------------------------------------------------------
    //
    //  Private Methods
    //
    //--------------------------------------------------------------------------
    async _checkForView() {
        const viewRef = this.el.closest("arcgis-map");
        if (viewRef?.view) {
            await viewRef.view.map.load();
            this.view = viewRef.view;
            this.view.ui.add(this.el, this.position);
        }
    }
    _createVersionPropertiesFlow(serviceUrl, versionInfo) {
        const { flowElement, viewModel } = this;
        if (!flowElement) {
            return null;
        }
        const versionPropertiesFlow = document.createElement("arcgis-version-management-version-properties");
        versionPropertiesFlow.flowElement = flowElement;
        versionPropertiesFlow.serviceUrl = serviceUrl;
        versionPropertiesFlow.strings = this.messages;
        versionPropertiesFlow.versionInfo = versionInfo;
        versionPropertiesFlow.viewModel = viewModel;
        versionPropertiesFlow.addEventListener("versionPropertiesSaveClickedEvent", async (e) => {
            const { serviceUrl, versionInfo } = e.detail;
            const fullVersionName = versionInfo.versionIdentifier.name;
            const versionName = fullVersionName.split(".").length > 1 ? fullVersionName.split(".")[1] : fullVersionName;
            const ownerName = fullVersionName.split(".").length > 1 ? fullVersionName.split(".")[0] : viewModel.userLookup.get(serviceUrl);
            if (versionInfo.versionIdentifier.guid === "") {
                await viewModel.createVersion({
                    access: versionInfo.access,
                    description: versionInfo.description,
                    featureServerUrl: serviceUrl,
                    ownerName,
                    versionName,
                });
            }
            else {
                await viewModel.alterVersion({
                    access: versionInfo.access,
                    description: versionInfo.description,
                    featureServerUrl: serviceUrl,
                    ownerName,
                    versionIdentifier: {
                        name: "",
                        guid: versionInfo.versionIdentifier.guid,
                    },
                    versionName,
                });
            }
            if (viewModel.state === "ready") {
                const versionList = flowElement.getElementsByTagName("arcgis-version-management-version-list")[0];
                versionList.versionInfos = [];
                const versionInfos = await viewModel.getVersionInfos(serviceUrl, true);
                versionList.versionInfos = versionInfos;
                await flowElement.back();
            }
        });
        return versionPropertiesFlow;
    }
    _getLoadError(loadError) {
        const { messages } = this;
        switch (loadError) {
            case "no-feature-services":
                return messages.loadErrors.noFeatureServices;
            case "no-layers-property":
                return messages.loadErrors.noLayersProperty;
            default:
                return loadError;
        }
    }
    async _handleVersionItemActionClick(e, flowElement) {
        const { actionType, serviceUrl, versionInfo } = e.detail;
        switch (actionType) {
            case "changeVersion":
                await this._switchToVersion(serviceUrl, versionInfo.versionIdentifier.name, versionInfo.versionIdentifier.guid);
                break;
            case "editVersion": {
                const versionPropertiesFlow = this._createVersionPropertiesFlow(serviceUrl, versionInfo);
                if (versionPropertiesFlow) {
                    flowElement.append(versionPropertiesFlow);
                }
                break;
            }
        }
    }
    async _handleVersionListActionClick(e, flowElement) {
        const { actionType, serviceUrl } = e.detail;
        switch (actionType) {
            case "newVersion": {
                const versionPropertiesFlow = this._createVersionPropertiesFlow(serviceUrl, undefined);
                if (versionPropertiesFlow) {
                    flowElement.append(versionPropertiesFlow);
                }
                break;
            }
            case "refreshVersions": {
                if (this.flowElement) {
                    const versionList = this.flowElement.getElementsByTagName("arcgis-version-management-version-list")[0];
                    versionList.versionInfos = [];
                    const versionInfos = await this.viewModel.getVersionInfos(serviceUrl, true);
                    versionList.versionInfos = versionInfos;
                }
                break;
            }
        }
    }
    async _switchToVersion(featureServerUrl, toVersionName, toVersionGuid) {
        await this.viewModel.changeVersion(featureServerUrl, toVersionName, toVersionGuid);
    }
    static get assetsDirs() { return ["assets"]; }
    get el() { return (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.g)(this); }
    static get watchers() { return {
        "position": ["positionWatcher"]
    }; }
};
ArcgisVersionManagement.style = versionManagementCss;




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3Mvbm9kZV9tb2R1bGVzX2FyY2dpc19tYXAtY29tcG9uZW50c19kaXN0X2VzbV9hcmNnaXMtdmVyc2lvbi1tYW5hZ2VtZW50X2VudHJ5X2pzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQzJGO0FBQ3FDO0FBQzFDOztBQUV0RiwyQ0FBMkMsZ0RBQWdELGdCQUFnQixXQUFXLFlBQVksUUFBUSw2QkFBNkIsZ0JBQWdCLGlCQUFpQixnQkFBZ0IsaUJBQWlCOztBQUV6TztBQUNBO0FBQ0EsUUFBUSxxREFBZ0I7QUFDeEIsdUJBQXVCLDhEQUFvQjtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4Qyw4REFBTSxHQUFHLGdCQUFnQjtBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLFFBQVEsUUFBUSxxREFBdUI7QUFDdkQ7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSwrQkFBK0Isc0RBQXFEO0FBQ3BGO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHlDQUF5QyxrQkFBa0IsSUFBSTtBQUMvRSxtR0FBbUcsV0FBVztBQUM5RyxnQkFBZ0IscURBQUMsQ0FBQyxpREFBSSxRQUFRLHFEQUFDLG1CQUFtQjtBQUNsRDtBQUNBLGFBQWEsc0JBQXNCLEVBQUUscURBQUMsd0JBQXdCLGdCQUFnQixFQUFFLHFEQUFDLG9CQUFvQix1REFBdUQsc0NBQXNDLHFEQUFDLDZDQUE2QztBQUNoUDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsZUFBZSw2QkFBNkIscURBQUMscUJBQXFCLDJGQUEyRixFQUFFLHFEQUFDLFVBQVUsaUJBQWlCO0FBQzNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQix5QkFBeUI7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0IsMEJBQTBCO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLFdBQVc7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0Isc0NBQXNDO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IseUJBQXlCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCO0FBQzlCLGVBQWUsT0FBTyxxREFBVTtBQUNoQyw0QkFBNEI7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7O0FBRWdFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL25vZGVfbW9kdWxlcy9AYXJjZ2lzL21hcC1jb21wb25lbnRzL2Rpc3QvZXNtL2FyY2dpcy12ZXJzaW9uLW1hbmFnZW1lbnQuZW50cnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVzcmksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogU2VlIGh0dHBzOi8vanMuYXJjZ2lzLmNvbS80LjMwL2VzcmkvY29weXJpZ2h0LnR4dCBmb3IgZGV0YWlscy5cbiAqIHY0LjMwLjAtbmV4dC4zN1xuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGgsIEggYXMgSG9zdCwgZyBhcyBnZXRFbGVtZW50IH0gZnJvbSAnLi9pbmRleC02ZTE3MmFhYy5qcyc7XG5pbXBvcnQgeyBpIGFzIGltcG9ydENvcmVSZWFjdGl2ZVV0aWxzLCBhNSBhcyBuZXdXaWRnZXRzVmVyc2lvbk1hbmFnZW1lbnRWZXJzaW9uTWFuYWdlbWVudFZpZXdNb2RlbCB9IGZyb20gJy4vaW5kZXgtMGJjNTVjYTUuanMnO1xuaW1wb3J0IHsgdSBhcyB1c2VDb250cm9sbGVyTWFuYWdlciwgYyBhcyB1c2VUOW4gfSBmcm9tICcuL2NodW5rLVdRVENVWEJTLTllYzM3ODFhLmpzJztcblxuY29uc3QgdmVyc2lvbk1hbmFnZW1lbnRDc3MgPSBcIi5kaXYtY29udGVudHtiYWNrZ3JvdW5kLWNvbG9yOnZhcigtLWNhbGNpdGUtdWktZm9yZWdyb3VuZC0xKTtwYWRkaW5nOjAuNzVyZW19LmZsb3ctbWFpbnt3aWR0aDozMzBweH0ubm90aWNle3dpZHRoOi13ZWJraXQtZmlsbC1hdmFpbGFibGV9LnBhbmVsLXNlcnZpY2Vze21heC1oZWlnaHQ6NDAwcHh9LnBhbmVsLXZlcnNpb25ze21heC1oZWlnaHQ6NDAwcHh9XCI7XG5cbmNvbnN0IEFyY2dpc1ZlcnNpb25NYW5hZ2VtZW50ID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKGhvc3RSZWYpIHtcbiAgICAgICAgcmVnaXN0ZXJJbnN0YW5jZSh0aGlzLCBob3N0UmVmKTtcbiAgICAgICAgdGhpcy5tYW5hZ2VyID0gdXNlQ29udHJvbGxlck1hbmFnZXIodGhpcyk7XG4gICAgICAgIHRoaXMuX3dhdGNoSGFuZGxlcyA9IFtdO1xuICAgICAgICB0aGlzLmxhYmVsID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnBvc2l0aW9uID0gXCJ0b3AtcmlnaHRcIjtcbiAgICAgICAgdGhpcy52aWV3ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm1lc3NhZ2VzID0gdGhpcy5tYW5hZ2VyLnJlYWRvbmx5KHVzZVQ5bih7IGJsb2NraW5nOiB0cnVlIH0pKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcG9zaXRpb25XYXRjaGVyKG5ld1ZhbHVlKSB7XG4gICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMudmlld01vZGVsKSB7XG4gICAgICAgICAgICB0aGlzLnZpZXcudWkubW92ZSh0aGlzLmVsLCBuZXdWYWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYXN5bmMgY29tcG9uZW50RGlkTG9hZCgpIHtcbiAgICAgICAgY29uc3QgeyB3YXRjaCB9ID0gYXdhaXQgaW1wb3J0Q29yZVJlYWN0aXZlVXRpbHMoKTtcbiAgICAgICAgdGhpcy5fd2F0Y2hIYW5kbGVzLnB1c2god2F0Y2goKCkgPT4gdGhpcy52aWV3TW9kZWwuc3RhdGUsIChzdGF0ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IHN0YXRlO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGFzeW5jIGNvbXBvbmVudFdpbGxMb2FkKCkge1xuICAgICAgICBhd2FpdCB0aGlzLl9jaGVja0ZvclZpZXcoKTtcbiAgICAgICAgdGhpcy52aWV3TW9kZWwgPSBhd2FpdCBuZXdXaWRnZXRzVmVyc2lvbk1hbmFnZW1lbnRWZXJzaW9uTWFuYWdlbWVudFZpZXdNb2RlbCh7XG4gICAgICAgICAgICB2aWV3OiB0aGlzLnZpZXcsXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmxhYmVsID0gdGhpcy5sYWJlbCA/IHRoaXMubGFiZWwgOiB0aGlzLm1lc3NhZ2VzLmxhYmVsO1xuICAgIH1cbiAgICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgdGhpcy5fd2F0Y2hIYW5kbGVzLmZvckVhY2goKGhhbmRsZSkgPT4ge1xuICAgICAgICAgICAgaGFuZGxlLnJlbW92ZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5fd2F0Y2hIYW5kbGVzID0gW107XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBtZXNzYWdlcywgbGFiZWwsIHZpZXdNb2RlbCwgdmlld01vZGVsOiB7IHN0YXRlLCBsb2FkRXJyb3IgfSwgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGFycmF5U2VydmljZU5hbWVzID0gQXJyYXkuZnJvbSh0aGlzLnZpZXdNb2RlbC5zZXJ2aWNlTmFtZUxvb2t1cCwgKFt1cmwsIG5hbWVdKSA9PiAoeyB1cmwsIG5hbWUgfSkpO1xuICAgICAgICByZXR1cm4gKGgoSG9zdCwgbnVsbCwgaChcImNhbGNpdGUtZmxvd1wiLCB7IHJlZjogKG5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmZsb3dFbGVtZW50ID0gbm9kZTtcbiAgICAgICAgICAgIH0sIGNsYXNzOiBcImZsb3ctbWFpblwiIH0sIGgoXCJjYWxjaXRlLWZsb3ctaXRlbVwiLCB7IGhlYWRpbmc6IGxhYmVsIH0sIGgoXCJjYWxjaXRlLXBhbmVsXCIsIHsgY2xhc3M6IFwicGFuZWwtc2VydmljZXNcIiwgbG9hZGluZzogc3RhdGUgPT09IFwibG9hZGluZ1wiIH0sIGFycmF5U2VydmljZU5hbWVzLm1hcCgoc2VydmljZSkgPT4gKGgoXCJhcmNnaXMtdmVyc2lvbi1tYW5hZ2VtZW50LXNlcnZpY2UtaXRlbVwiLCB7IGZsb3dFbGVtZW50OiB0aGlzLmZsb3dFbGVtZW50LCBoZWFkaW5nOiBsYWJlbCwgc2VydmljZVVybDogc2VydmljZS51cmwsIHN0cmluZ3M6IG1lc3NhZ2VzLCB2aWV3TW9kZWw6IHZpZXdNb2RlbCwgb25WZXJzaW9uSXRlbUFjdGlvbkNsaWNrZWRFdmVudFdpdGhTZXJ2aWNlVXJsOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZsb3dFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZVZlcnNpb25JdGVtQWN0aW9uQ2xpY2soZSwgdGhpcy5mbG93RWxlbWVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgb25WZXJzaW9uTGlzdEFjdGlvbkNsaWNrZWRFdmVudDogKGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5mbG93RWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVWZXJzaW9uTGlzdEFjdGlvbkNsaWNrKGUsIHRoaXMuZmxvd0VsZW1lbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gfSkpKSwgc3RhdGUgPT09IFwiZGlzYWJsZWRcIiA/IChoKFwiY2FsY2l0ZS1ub3RpY2VcIiwgeyBjbGFzczogXCJub3RpY2VcIiwgY2xvc2FibGU6IGZhbHNlLCBraW5kOiBcIndhcm5pbmdcIiwgb3BlbjogdHJ1ZSwgc2NhbGU6IFwic1wiLCBzbG90OiBcImZvb3RlclwiIH0sIGgoXCJkaXZcIiwgeyBzbG90OiBcIm1lc3NhZ2VcIiB9LCB0aGlzLl9nZXRMb2FkRXJyb3IobG9hZEVycm9yKSkpKSA6IHVuZGVmaW5lZCkpKSkpO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJpdmF0ZSBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgYXN5bmMgX2NoZWNrRm9yVmlldygpIHtcbiAgICAgICAgY29uc3Qgdmlld1JlZiA9IHRoaXMuZWwuY2xvc2VzdChcImFyY2dpcy1tYXBcIik7XG4gICAgICAgIGlmICh2aWV3UmVmPy52aWV3KSB7XG4gICAgICAgICAgICBhd2FpdCB2aWV3UmVmLnZpZXcubWFwLmxvYWQoKTtcbiAgICAgICAgICAgIHRoaXMudmlldyA9IHZpZXdSZWYudmlldztcbiAgICAgICAgICAgIHRoaXMudmlldy51aS5hZGQodGhpcy5lbCwgdGhpcy5wb3NpdGlvbik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgX2NyZWF0ZVZlcnNpb25Qcm9wZXJ0aWVzRmxvdyhzZXJ2aWNlVXJsLCB2ZXJzaW9uSW5mbykge1xuICAgICAgICBjb25zdCB7IGZsb3dFbGVtZW50LCB2aWV3TW9kZWwgfSA9IHRoaXM7XG4gICAgICAgIGlmICghZmxvd0VsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZlcnNpb25Qcm9wZXJ0aWVzRmxvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhcmNnaXMtdmVyc2lvbi1tYW5hZ2VtZW50LXZlcnNpb24tcHJvcGVydGllc1wiKTtcbiAgICAgICAgdmVyc2lvblByb3BlcnRpZXNGbG93LmZsb3dFbGVtZW50ID0gZmxvd0VsZW1lbnQ7XG4gICAgICAgIHZlcnNpb25Qcm9wZXJ0aWVzRmxvdy5zZXJ2aWNlVXJsID0gc2VydmljZVVybDtcbiAgICAgICAgdmVyc2lvblByb3BlcnRpZXNGbG93LnN0cmluZ3MgPSB0aGlzLm1lc3NhZ2VzO1xuICAgICAgICB2ZXJzaW9uUHJvcGVydGllc0Zsb3cudmVyc2lvbkluZm8gPSB2ZXJzaW9uSW5mbztcbiAgICAgICAgdmVyc2lvblByb3BlcnRpZXNGbG93LnZpZXdNb2RlbCA9IHZpZXdNb2RlbDtcbiAgICAgICAgdmVyc2lvblByb3BlcnRpZXNGbG93LmFkZEV2ZW50TGlzdGVuZXIoXCJ2ZXJzaW9uUHJvcGVydGllc1NhdmVDbGlja2VkRXZlbnRcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgc2VydmljZVVybCwgdmVyc2lvbkluZm8gfSA9IGUuZGV0YWlsO1xuICAgICAgICAgICAgY29uc3QgZnVsbFZlcnNpb25OYW1lID0gdmVyc2lvbkluZm8udmVyc2lvbklkZW50aWZpZXIubmFtZTtcbiAgICAgICAgICAgIGNvbnN0IHZlcnNpb25OYW1lID0gZnVsbFZlcnNpb25OYW1lLnNwbGl0KFwiLlwiKS5sZW5ndGggPiAxID8gZnVsbFZlcnNpb25OYW1lLnNwbGl0KFwiLlwiKVsxXSA6IGZ1bGxWZXJzaW9uTmFtZTtcbiAgICAgICAgICAgIGNvbnN0IG93bmVyTmFtZSA9IGZ1bGxWZXJzaW9uTmFtZS5zcGxpdChcIi5cIikubGVuZ3RoID4gMSA/IGZ1bGxWZXJzaW9uTmFtZS5zcGxpdChcIi5cIilbMF0gOiB2aWV3TW9kZWwudXNlckxvb2t1cC5nZXQoc2VydmljZVVybCk7XG4gICAgICAgICAgICBpZiAodmVyc2lvbkluZm8udmVyc2lvbklkZW50aWZpZXIuZ3VpZCA9PT0gXCJcIikge1xuICAgICAgICAgICAgICAgIGF3YWl0IHZpZXdNb2RlbC5jcmVhdGVWZXJzaW9uKHtcbiAgICAgICAgICAgICAgICAgICAgYWNjZXNzOiB2ZXJzaW9uSW5mby5hY2Nlc3MsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB2ZXJzaW9uSW5mby5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZmVhdHVyZVNlcnZlclVybDogc2VydmljZVVybCxcbiAgICAgICAgICAgICAgICAgICAgb3duZXJOYW1lLFxuICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uTmFtZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGF3YWl0IHZpZXdNb2RlbC5hbHRlclZlcnNpb24oe1xuICAgICAgICAgICAgICAgICAgICBhY2Nlc3M6IHZlcnNpb25JbmZvLmFjY2VzcyxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHZlcnNpb25JbmZvLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBmZWF0dXJlU2VydmVyVXJsOiBzZXJ2aWNlVXJsLFxuICAgICAgICAgICAgICAgICAgICBvd25lck5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHZlcnNpb25JZGVudGlmaWVyOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgZ3VpZDogdmVyc2lvbkluZm8udmVyc2lvbklkZW50aWZpZXIuZ3VpZCxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdmVyc2lvbk5hbWUsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodmlld01vZGVsLnN0YXRlID09PSBcInJlYWR5XCIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB2ZXJzaW9uTGlzdCA9IGZsb3dFbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiYXJjZ2lzLXZlcnNpb24tbWFuYWdlbWVudC12ZXJzaW9uLWxpc3RcIilbMF07XG4gICAgICAgICAgICAgICAgdmVyc2lvbkxpc3QudmVyc2lvbkluZm9zID0gW107XG4gICAgICAgICAgICAgICAgY29uc3QgdmVyc2lvbkluZm9zID0gYXdhaXQgdmlld01vZGVsLmdldFZlcnNpb25JbmZvcyhzZXJ2aWNlVXJsLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB2ZXJzaW9uTGlzdC52ZXJzaW9uSW5mb3MgPSB2ZXJzaW9uSW5mb3M7XG4gICAgICAgICAgICAgICAgYXdhaXQgZmxvd0VsZW1lbnQuYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHZlcnNpb25Qcm9wZXJ0aWVzRmxvdztcbiAgICB9XG4gICAgX2dldExvYWRFcnJvcihsb2FkRXJyb3IpIHtcbiAgICAgICAgY29uc3QgeyBtZXNzYWdlcyB9ID0gdGhpcztcbiAgICAgICAgc3dpdGNoIChsb2FkRXJyb3IpIHtcbiAgICAgICAgICAgIGNhc2UgXCJuby1mZWF0dXJlLXNlcnZpY2VzXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2VzLmxvYWRFcnJvcnMubm9GZWF0dXJlU2VydmljZXM7XG4gICAgICAgICAgICBjYXNlIFwibm8tbGF5ZXJzLXByb3BlcnR5XCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2VzLmxvYWRFcnJvcnMubm9MYXllcnNQcm9wZXJ0eTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxvYWRFcnJvcjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBfaGFuZGxlVmVyc2lvbkl0ZW1BY3Rpb25DbGljayhlLCBmbG93RWxlbWVudCkge1xuICAgICAgICBjb25zdCB7IGFjdGlvblR5cGUsIHNlcnZpY2VVcmwsIHZlcnNpb25JbmZvIH0gPSBlLmRldGFpbDtcbiAgICAgICAgc3dpdGNoIChhY3Rpb25UeXBlKSB7XG4gICAgICAgICAgICBjYXNlIFwiY2hhbmdlVmVyc2lvblwiOlxuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX3N3aXRjaFRvVmVyc2lvbihzZXJ2aWNlVXJsLCB2ZXJzaW9uSW5mby52ZXJzaW9uSWRlbnRpZmllci5uYW1lLCB2ZXJzaW9uSW5mby52ZXJzaW9uSWRlbnRpZmllci5ndWlkKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJlZGl0VmVyc2lvblwiOiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmVyc2lvblByb3BlcnRpZXNGbG93ID0gdGhpcy5fY3JlYXRlVmVyc2lvblByb3BlcnRpZXNGbG93KHNlcnZpY2VVcmwsIHZlcnNpb25JbmZvKTtcbiAgICAgICAgICAgICAgICBpZiAodmVyc2lvblByb3BlcnRpZXNGbG93KSB7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dFbGVtZW50LmFwcGVuZCh2ZXJzaW9uUHJvcGVydGllc0Zsb3cpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBfaGFuZGxlVmVyc2lvbkxpc3RBY3Rpb25DbGljayhlLCBmbG93RWxlbWVudCkge1xuICAgICAgICBjb25zdCB7IGFjdGlvblR5cGUsIHNlcnZpY2VVcmwgfSA9IGUuZGV0YWlsO1xuICAgICAgICBzd2l0Y2ggKGFjdGlvblR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJuZXdWZXJzaW9uXCI6IHtcbiAgICAgICAgICAgICAgICBjb25zdCB2ZXJzaW9uUHJvcGVydGllc0Zsb3cgPSB0aGlzLl9jcmVhdGVWZXJzaW9uUHJvcGVydGllc0Zsb3coc2VydmljZVVybCwgdW5kZWZpbmVkKTtcbiAgICAgICAgICAgICAgICBpZiAodmVyc2lvblByb3BlcnRpZXNGbG93KSB7XG4gICAgICAgICAgICAgICAgICAgIGZsb3dFbGVtZW50LmFwcGVuZCh2ZXJzaW9uUHJvcGVydGllc0Zsb3cpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgXCJyZWZyZXNoVmVyc2lvbnNcIjoge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZsb3dFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZlcnNpb25MaXN0ID0gdGhpcy5mbG93RWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImFyY2dpcy12ZXJzaW9uLW1hbmFnZW1lbnQtdmVyc2lvbi1saXN0XCIpWzBdO1xuICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uTGlzdC52ZXJzaW9uSW5mb3MgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmVyc2lvbkluZm9zID0gYXdhaXQgdGhpcy52aWV3TW9kZWwuZ2V0VmVyc2lvbkluZm9zKHNlcnZpY2VVcmwsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uTGlzdC52ZXJzaW9uSW5mb3MgPSB2ZXJzaW9uSW5mb3M7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIF9zd2l0Y2hUb1ZlcnNpb24oZmVhdHVyZVNlcnZlclVybCwgdG9WZXJzaW9uTmFtZSwgdG9WZXJzaW9uR3VpZCkge1xuICAgICAgICBhd2FpdCB0aGlzLnZpZXdNb2RlbC5jaGFuZ2VWZXJzaW9uKGZlYXR1cmVTZXJ2ZXJVcmwsIHRvVmVyc2lvbk5hbWUsIHRvVmVyc2lvbkd1aWQpO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0IGFzc2V0c0RpcnMoKSB7IHJldHVybiBbXCJhc3NldHNcIl07IH1cbiAgICBnZXQgZWwoKSB7IHJldHVybiBnZXRFbGVtZW50KHRoaXMpOyB9XG4gICAgc3RhdGljIGdldCB3YXRjaGVycygpIHsgcmV0dXJuIHtcbiAgICAgICAgXCJwb3NpdGlvblwiOiBbXCJwb3NpdGlvbldhdGNoZXJcIl1cbiAgICB9OyB9XG59O1xuQXJjZ2lzVmVyc2lvbk1hbmFnZW1lbnQuc3R5bGUgPSB2ZXJzaW9uTWFuYWdlbWVudENzcztcblxuZXhwb3J0IHsgQXJjZ2lzVmVyc2lvbk1hbmFnZW1lbnQgYXMgYXJjZ2lzX3ZlcnNpb25fbWFuYWdlbWVudCB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9