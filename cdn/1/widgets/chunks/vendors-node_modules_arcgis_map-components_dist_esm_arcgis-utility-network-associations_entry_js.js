"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-node_modules_arcgis_map-components_dist_esm_arcgis-utility-network-associations_entry_js"],{

/***/ "./node_modules/@arcgis/map-components/dist/esm/arcgis-utility-network-associations.entry.js":
/*!***************************************************************************************************!*\
  !*** ./node_modules/@arcgis/map-components/dist/esm/arcgis-utility-network-associations.entry.js ***!
  \***************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_utility_network_associations: () => (/* binding */ ArcgisUtilityNetworkAssociations)
/* harmony export */ });
/* harmony import */ var _index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-6e172aac.js */ "./node_modules/@arcgis/map-components/dist/esm/index-6e172aac.js");
/* harmony import */ var _index_0bc55ca5_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./index-0bc55ca5.js */ "./node_modules/@arcgis/map-components/dist/esm/index-0bc55ca5.js");
/* harmony import */ var _component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./component-utils-23194f7c.js */ "./node_modules/@arcgis/map-components/dist/esm/component-utils-23194f7c.js");
/* harmony import */ var _disconnected_6cf1c100_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./disconnected-6cf1c100.js */ "./node_modules/@arcgis/map-components/dist/esm/disconnected-6cf1c100.js");
/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.30/esri/copyright.txt for details.
 * v4.30.0-next.37
 */





const utilityNetworkAssociationsCss = "arcgis-utility-network-associations{}";

const ArcgisUtilityNetworkAssociations = class {
    constructor(hostRef) {
        (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisUtilityNetworkAssociationsReady = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisUtilityNetworkAssociationsReady", 7);
        this._watchHandles = [];
        this.referenceElement = undefined;
        this.autoRefreshAssociations = true;
        this.connectivityAssociationsLineSymbol = undefined;
        this.includeConnectivityAssociations = true;
        this.includeStructuralAttachmentAssociations = true;
        this.maxAllowableAssociations = 250;
        this.maxAllowableAssociationsSliderMax = undefined;
        this.maxAllowableAssociationsSliderMin = undefined;
        this.maxAllowableAssociationsSliderStep = undefined;
        this.showArrowsConnectivity = false;
        this.showArrowsStructuralAttachment = false;
        this.showAssociationsEnabled = false;
        this.structuralAttachmentAssociationsLineSymbol = undefined;
        this.utilityNetwork = undefined;
        this.visibleElementsConnectivityAssociationsSettingsArrowsToggle = true;
        this.visibleElementsConnectivityAssociationsSettingsCapSelect = true;
        this.visibleElementsConnectivityAssociationsSettingsColorPicker = true;
        this.visibleElementsConnectivityAssociationsSettingsStylePicker = true;
        this.visibleElementsConnectivityAssociationsSettingsWidthInput = true;
        this.visibleElementsMaxAllowableAssociationsSlider = true;
        this.visibleElementsStructuralAttachmentAssociationsSettingsArrowsToggle = true;
        this.visibleElementsStructuralAttachmentAssociationsSettingsCapSelect = true;
        this.visibleElementsStructuralAttachmentAssociationsSettingsStylePicker = true;
        this.visibleElementsStructuralAttachmentAssociationsSettingsWidthInput = true;
        this.position = "bottom-left";
        this.view = undefined;
        this.widget = undefined;
    }
    referenceElementWatcher(value) {
        void (0,_component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__.r)(this, value);
    }
    autoRefreshAssociationsWatcher(value) {
        if (value !== undefined && this.widget) {
            this.widget.autoRefreshAssociations = value;
        }
    }
    connectivityAssociationsLineSymbolWatcher(value) {
        if (this.widget) {
            this.widget.connectivityAssociationsLineSymbol = value;
        }
    }
    includeConnectivityAssociationsWatcher(value) {
        if (value !== undefined && this.widget) {
            this.widget.includeConnectivityAssociations = value;
        }
    }
    includeStructuralAttachmentAssociationsWatcher(value) {
        if (value !== undefined && this.widget) {
            this.widget.includeStructuralAttachmentAssociations = value;
        }
    }
    maxAllowableAssociationsWatcher(value) {
        if (value !== undefined && this.widget) {
            this.widget.maxAllowableAssociations = value;
        }
    }
    maxAllowableAssociationsSliderMaxWatcher(value) {
        if (value !== undefined && this.widget) {
            this.widget.maxAllowableAssociationsSliderMax = value;
        }
    }
    maxAllowableAssociationsSliderMinWatcher(value) {
        if (value !== undefined && this.widget) {
            this.widget.maxAllowableAssociationsSliderMin = value;
        }
    }
    maxAllowableAssociationsSliderStepWatcher(value) {
        if (value !== undefined && this.widget) {
            this.widget.maxAllowableAssociationsSliderStep = value;
        }
    }
    showArrowsConnectivityWatcher(value) {
        if (value !== undefined && this.widget) {
            this.widget.showArrowsConnectivity = value;
        }
    }
    showArrowsStructuralAttachmentWatcher(value) {
        if (value !== undefined && this.widget) {
            this.widget.showArrowsStructuralAttachment = value;
        }
    }
    showAssociationsEnabledWatcher(value) {
        if (value !== undefined && this.widget) {
            this.widget.showAssociationsEnabled = value;
        }
    }
    structuralAttachmentAssociationsLineSymbolWatcher(value) {
        if (this.widget) {
            this.widget.structuralAttachmentAssociationsLineSymbol = value;
        }
    }
    utilityNetworkWatcher(value) {
        if (this.widget) {
            this.widget.utilityNetwork = value;
        }
    }
    visibleElementsConnectivityAssociationsSettingsArrowsToggleWatcher(value) {
        if (this.widget) {
            this.widget.visibleElements = {
                ...this.widget.visibleElements,
                connectivityAssociationsSettings: {
                    ...this.widget.visibleElements.connectivityAssociationsSettings,
                    arrowsToggle: value,
                },
            };
        }
    }
    visibleElementsConnectivityAssociationsSettingsCapSelectWatcher(value) {
        if (this.widget) {
            this.widget.visibleElements = {
                ...this.widget.visibleElements,
                connectivityAssociationsSettings: {
                    ...this.widget.visibleElements.connectivityAssociationsSettings,
                    capSelect: value,
                },
            };
        }
    }
    visibleElementsConnectivityAssociationsSettingsColorPickerWatcher(value) {
        if (this.widget) {
            this.widget.visibleElements = {
                ...this.widget.visibleElements,
                connectivityAssociationsSettings: {
                    ...this.widget.visibleElements.connectivityAssociationsSettings,
                    colorPicker: value,
                },
            };
        }
    }
    visibleElementsConnectivityAssociationsSettingsStylePickerWatcher(value) {
        if (this.widget) {
            this.widget.visibleElements = {
                ...this.widget.visibleElements,
                connectivityAssociationsSettings: {
                    ...this.widget.visibleElements.connectivityAssociationsSettings,
                    stylePicker: value,
                },
            };
        }
    }
    visibleElementsConnectivityAssociationsSettingsWidthInputWatcher(value) {
        if (this.widget) {
            this.widget.visibleElements = {
                ...this.widget.visibleElements,
                connectivityAssociationsSettings: {
                    ...this.widget.visibleElements.connectivityAssociationsSettings,
                    widthInput: value,
                },
            };
        }
    }
    visibleElementsMaxAllowableAssociationsSliderWatcher(value) {
        if (this.widget) {
            this.widget.visibleElements = {
                ...this.widget.visibleElements,
                maxAllowableAssociationsSlider: value,
            };
        }
    }
    visibleElementsStructuralAttachmentAssociationsSettingsArrowsToggleWatcher(value) {
        if (this.widget) {
            this.widget.visibleElements = {
                ...this.widget.visibleElements,
                structuralAttachmentAssociationsSettings: {
                    ...this.widget.visibleElements.structuralAttachmentAssociationsSettings,
                    arrowsToggle: value,
                },
            };
        }
    }
    visibleElementsStructuralAttachmentAssociationsSettingsCapSelectWatcher(value) {
        if (this.widget) {
            this.widget.visibleElements = {
                ...this.widget.visibleElements,
                structuralAttachmentAssociationsSettings: {
                    ...this.widget.visibleElements.structuralAttachmentAssociationsSettings,
                    capSelect: value,
                },
            };
        }
    }
    visibleElementsStructuralAttachmentAssociationsSettingsStylePickerWatcher(value) {
        if (this.widget) {
            this.widget.visibleElements = {
                ...this.widget.visibleElements,
                structuralAttachmentAssociationsSettings: {
                    ...this.widget.visibleElements.structuralAttachmentAssociationsSettings,
                    stylePicker: value,
                },
            };
        }
    }
    visibleElementsStructuralAttachmentAssociationsSettingsWidthInputWatcher(value) {
        if (this.widget) {
            this.widget.visibleElements = {
                ...this.widget.visibleElements,
                structuralAttachmentAssociationsSettings: {
                    ...this.widget.visibleElements.structuralAttachmentAssociationsSettings,
                    widthInput: value,
                },
            };
        }
    }
    positionWatcher(value) {
        if (value !== undefined && this.widget) {
            this.view.ui.move(this.childElem, value);
        }
    }
    viewWatcher(value) {
        if (value !== undefined && this.widget) {
            this.widget.view = value;
            void this._loadUtilityNetwork();
        }
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentDidLoad() {
        const params = this._createParams();
        const widget = await (0,_index_0bc55ca5_js__WEBPACK_IMPORTED_MODULE_1__.a1)(params);
        this.widget = widget;
        this._addContainer();
        this.arcgisUtilityNetworkAssociationsReady.emit();
        (0,_component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__.c)(this);
    }
    disconnectedCallback() {
        (0,_disconnected_6cf1c100_js__WEBPACK_IMPORTED_MODULE_3__.o)(this);
    }
    render() {
        return (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: (el) => (this.childElem = el) });
    }
    //--------------------------------------------------------------------------
    //
    //  Private Methods
    //
    //--------------------------------------------------------------------------
    _addContainer() {
        this.widget.container = this.childElem;
    }
    _createParams() {
        const params = {};
        params.visibleElements = {
            connectivityAssociationsSettings: {
                arrowsToggle: this.visibleElementsConnectivityAssociationsSettingsArrowsToggle,
                capSelect: this.visibleElementsConnectivityAssociationsSettingsCapSelect,
                colorPicker: this.visibleElementsConnectivityAssociationsSettingsColorPicker,
                stylePicker: this.visibleElementsConnectivityAssociationsSettingsStylePicker,
                widthInput: this.visibleElementsConnectivityAssociationsSettingsWidthInput,
            },
            maxAllowableAssociationsSlider: this.visibleElementsMaxAllowableAssociationsSlider,
            structuralAttachmentAssociationsSettings: {
                arrowsToggle: this.visibleElementsStructuralAttachmentAssociationsSettingsArrowsToggle,
                capSelect: this.visibleElementsStructuralAttachmentAssociationsSettingsCapSelect,
                stylePicker: this.visibleElementsStructuralAttachmentAssociationsSettingsStylePicker,
                widthInput: this.visibleElementsStructuralAttachmentAssociationsSettingsWidthInput,
            },
        };
        if (this.autoRefreshAssociations !== undefined) {
            params.autoRefreshAssociations = this.autoRefreshAssociations;
        }
        if (this.connectivityAssociationsLineSymbol !== undefined) {
            params.connectivityAssociationsLineSymbol = this.connectivityAssociationsLineSymbol;
        }
        if (this.includeConnectivityAssociations !== undefined) {
            params.includeConnectivityAssociations = this.includeConnectivityAssociations;
        }
        if (this.includeStructuralAttachmentAssociations !== undefined) {
            params.includeStructuralAttachmentAssociations = this.includeStructuralAttachmentAssociations;
        }
        if (this.maxAllowableAssociations !== undefined) {
            params.maxAllowableAssociations = this.maxAllowableAssociations;
        }
        if (this.maxAllowableAssociationsSliderMax !== undefined) {
            params.maxAllowableAssociationsSliderMax = this.maxAllowableAssociationsSliderMax;
        }
        if (this.maxAllowableAssociationsSliderMin !== undefined) {
            params.maxAllowableAssociationsSliderMin = this.maxAllowableAssociationsSliderMin;
        }
        if (this.maxAllowableAssociationsSliderStep !== undefined) {
            params.maxAllowableAssociationsSliderStep = this.maxAllowableAssociationsSliderStep;
        }
        if (this.showArrowsConnectivity !== undefined) {
            params.showArrowsConnectivity = this.showArrowsConnectivity;
        }
        if (this.showArrowsStructuralAttachment !== undefined) {
            params.showArrowsStructuralAttachment = this.showArrowsStructuralAttachment;
        }
        if (this.showAssociationsEnabled !== undefined) {
            params.showAssociationsEnabled = this.showAssociationsEnabled;
        }
        if (this.structuralAttachmentAssociationsLineSymbol !== undefined) {
            params.structuralAttachmentAssociationsLineSymbol = this.structuralAttachmentAssociationsLineSymbol;
        }
        if (this.utilityNetwork !== undefined) {
            params.utilityNetwork = this.utilityNetwork;
        }
        return params;
    }
    async _loadUtilityNetwork() {
        if (this.view?.map && this.view.map.portalItem) {
            await this.view.map.load();
            const utilityNetwork = this.view.map.utilityNetworks.getItemAt(0);
            await utilityNetwork.load();
            this.utilityNetwork = utilityNetwork;
        }
    }
    get el() { return (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.g)(this); }
    static get watchers() { return {
        "referenceElement": ["referenceElementWatcher"],
        "autoRefreshAssociations": ["autoRefreshAssociationsWatcher"],
        "connectivityAssociationsLineSymbol": ["connectivityAssociationsLineSymbolWatcher"],
        "includeConnectivityAssociations": ["includeConnectivityAssociationsWatcher"],
        "includeStructuralAttachmentAssociations": ["includeStructuralAttachmentAssociationsWatcher"],
        "maxAllowableAssociations": ["maxAllowableAssociationsWatcher"],
        "maxAllowableAssociationsSliderMax": ["maxAllowableAssociationsSliderMaxWatcher"],
        "maxAllowableAssociationsSliderMin": ["maxAllowableAssociationsSliderMinWatcher"],
        "maxAllowableAssociationsSliderStep": ["maxAllowableAssociationsSliderStepWatcher"],
        "showArrowsConnectivity": ["showArrowsConnectivityWatcher"],
        "showArrowsStructuralAttachment": ["showArrowsStructuralAttachmentWatcher"],
        "showAssociationsEnabled": ["showAssociationsEnabledWatcher"],
        "structuralAttachmentAssociationsLineSymbol": ["structuralAttachmentAssociationsLineSymbolWatcher"],
        "utilityNetwork": ["utilityNetworkWatcher"],
        "visibleElementsConnectivityAssociationsSettingsArrowsToggle": ["visibleElementsConnectivityAssociationsSettingsArrowsToggleWatcher"],
        "visibleElementsConnectivityAssociationsSettingsCapSelect": ["visibleElementsConnectivityAssociationsSettingsCapSelectWatcher"],
        "visibleElementsConnectivityAssociationsSettingsColorPicker": ["visibleElementsConnectivityAssociationsSettingsColorPickerWatcher"],
        "visibleElementsConnectivityAssociationsSettingsStylePicker": ["visibleElementsConnectivityAssociationsSettingsStylePickerWatcher"],
        "visibleElementsConnectivityAssociationsSettingsWidthInput": ["visibleElementsConnectivityAssociationsSettingsWidthInputWatcher"],
        "visibleElementsMaxAllowableAssociationsSlider": ["visibleElementsMaxAllowableAssociationsSliderWatcher"],
        "visibleElementsStructuralAttachmentAssociationsSettingsArrowsToggle": ["visibleElementsStructuralAttachmentAssociationsSettingsArrowsToggleWatcher"],
        "visibleElementsStructuralAttachmentAssociationsSettingsCapSelect": ["visibleElementsStructuralAttachmentAssociationsSettingsCapSelectWatcher"],
        "visibleElementsStructuralAttachmentAssociationsSettingsStylePicker": ["visibleElementsStructuralAttachmentAssociationsSettingsStylePickerWatcher"],
        "visibleElementsStructuralAttachmentAssociationsSettingsWidthInput": ["visibleElementsStructuralAttachmentAssociationsSettingsWidthInputWatcher"],
        "position": ["positionWatcher"],
        "view": ["viewWatcher"]
    }; }
};
ArcgisUtilityNetworkAssociations.style = utilityNetworkAssociationsCss;




/***/ }),

/***/ "./node_modules/@arcgis/map-components/dist/esm/component-utils-23194f7c.js":
/*!**********************************************************************************!*\
  !*** ./node_modules/@arcgis/map-components/dist/esm/component-utils-23194f7c.js ***!
  \**********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ addHandles),
/* harmony export */   b: () => (/* binding */ isNotSameViewpoint),
/* harmony export */   c: () => (/* binding */ checkForView),
/* harmony export */   d: () => (/* binding */ checkForExpand),
/* harmony export */   e: () => (/* binding */ isNotSameCamera),
/* harmony export */   f: () => (/* binding */ isNotSameEnvironment),
/* harmony export */   g: () => (/* binding */ isValidInteger),
/* harmony export */   i: () => (/* binding */ isNullOrEmptyString),
/* harmony export */   r: () => (/* binding */ referenceElementHelper)
/* harmony export */ });
/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.30/esri/copyright.txt for details.
 * v4.30.0-next.37
 */
function checkForExpand(element) {
    const expandRef = element.el.closest("arcgis-expand") ?? element.expandElem;
    if (expandRef?.widget) {
        element.view = expandRef.view;
        expandRef.widget.content = element.childElem ?? element.el;
        // TODO: Update to be expandIcon = widget.icon, not ready yet in 4.27next
        if (!expandRef.expandIcon) {
            expandRef.widget.expandIcon = element.widget ? element.widget.icon : element?.icon;
        }
        return true;
    }
    if (expandRef) {
        const widgetHandler = () => {
            expandRef.removeEventListener("arcgisExpandReady", widgetHandler, false);
            element.view = expandRef.view;
            expandRef.widget.content = element.childElem ?? element.el;
            if (!expandRef.expandIcon) {
                expandRef.widget.expandIcon = element.widget ? element.widget.icon : element?.icon;
            }
        };
        expandRef.addEventListener("arcgisExpandReady", widgetHandler, false);
        return true;
    }
    return false;
}

//--------------------------------------------------------------------------
//
//  Public Methods
//
//--------------------------------------------------------------------------
function addHandles(element, handle) {
    if (Array.isArray(handle)) {
        element._watchHandles = [...element._watchHandles, ...handle];
    }
    else {
        element._watchHandles.push(handle);
    }
}
function checkForView(element) {
    let isUsingReferenceElement = false;
    if (!checkForExpand(element)) {
        let viewRef = element.el.closest("arcgis-map") ?? element.el.closest("arcgis-scene");
        if (!viewRef && typeof element.referenceElement === "string") {
            viewRef = document.querySelector(element.referenceElement);
            isUsingReferenceElement = true;
        }
        if (viewRef?.view) {
            element.view = viewRef.view;
            const el = element.childElem ?? element.el;
            if (!isUsingReferenceElement) {
                element.view.ui.add(el, element.position);
            }
        }
        else if (viewRef) {
            waitForViewHandler(viewRef, element, isUsingReferenceElement);
        }
    }
    else {
        const viewRef = element.el.closest("arcgis-map") ?? element.el.closest("arcgis-scene");
        if (viewRef?.view) {
            element.view = viewRef.view;
        }
        else if (viewRef) {
            const handler = () => {
                viewRef.removeEventListener("arcgisViewReadyChange", handler, false);
                element.view = viewRef.view;
            };
            viewRef.addEventListener("arcgisViewReadyChange", handler, false);
        }
    }
}
function isNullOrEmptyString(value) {
    return value === undefined || value === null || value === "";
}
function isValidInteger(value) {
    return value != null && value % 1 === 0;
}
function isNotSameCamera(camera, camera2) {
    return (camera2 === undefined ||
        camera.position !== camera2.position ||
        camera.heading !== camera2.heading ||
        camera.tilt !== camera2.tilt);
}
function isNotSameEnvironment(environment, environment2) {
    return (environment2 === undefined ||
        environment2.atmosphereEnabled !== environment.atmosphereEnabled ||
        environment2.lighting.date !== environment.lighting.date ||
        environment2.lighting.directShadowsEnabled !==
            environment.lighting.directShadowsEnabled ||
        environment2.lighting.cameraTrackingEnabled !==
            environment.lighting.cameraTrackingEnabled ||
        environment2.lighting.date !== environment.lighting.date ||
        environment2.lighting.displayUTCOffset !==
            environment.lighting.displayUTCOffset);
}
function isNotSameViewpoint(viewpoint, viewpoint2) {
    return (viewpoint2 === undefined ||
        viewpoint.targetGeometry !== viewpoint2.targetGeometry ||
        viewpoint.rotation !== viewpoint2.rotation ||
        viewpoint.scale !== viewpoint2.scale);
}
async function updateForView(viewStr) {
    const viewRef = document.querySelector(viewStr);
    return await new Promise((resolve) => {
        if (viewRef?.view !== undefined) {
            resolve(viewRef.view);
        }
        else if (viewRef) {
            const handler = () => {
                viewRef.removeEventListener("arcgisViewReadyChange", handler, false);
                resolve(viewRef.view);
            };
            viewRef.addEventListener("arcgisViewReadyChange", handler, false);
        }
    });
}
async function referenceElementHelper(element, refElement) {
    if (refElement === undefined)
        return;
    else if (typeof refElement === "string") {
        element.view = await updateForView(refElement);
    }
    else if (element.widget) {
        element.view = refElement.view;
    }
}
//--------------------------------------------------------------------------
//
//  Private Methods
//
//--------------------------------------------------------------------------
function waitForViewHandler(viewRef, element, isUsingRefernceElement) {
    const handler = () => {
        viewRef.removeEventListener("arcgisViewReadyChange", handler, false);
        element.view = viewRef.view;
        if (!isUsingRefernceElement) {
            element.view.ui.add(element.childElem ?? element.el, element.position);
        }
    };
    viewRef.addEventListener("arcgisViewReadyChange", handler, false);
}




/***/ }),

/***/ "./node_modules/@arcgis/map-components/dist/esm/disconnected-6cf1c100.js":
/*!*******************************************************************************!*\
  !*** ./node_modules/@arcgis/map-components/dist/esm/disconnected-6cf1c100.js ***!
  \*******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   o: () => (/* binding */ onDisconnectedHelper)
/* harmony export */ });
/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.30/esri/copyright.txt for details.
 * v4.30.0-next.37
 */
function onDisconnectedHelper(element) {
    if (element.childElem) {
        if (!element.el.isConnected) {
            if (element.view) {
                element.view.ui.remove(element.childElem);
            }
            else if (element.widget?.view) {
                element.widget.view.ui.remove(element.childElem);
            }
            if (element._watchHandles) {
                element._watchHandles.forEach((handle) => {
                    handle.remove();
                });
            }
            element._watchHandles = [];
            element.widget?.destroy();
        }
    }
    else {
        setTimeout(() => {
            if (!element.el.isConnected) {
                if (element.view) {
                    element.view.ui.remove(element.el);
                }
                else if (element.widget?.view) {
                    element.widget.view.ui.remove(element.el);
                }
                if (element._watchHandles) {
                    element._watchHandles.forEach((handle) => {
                        handle.remove();
                    });
                }
                element._watchHandles = [];
                element.widget?.destroy();
            }
        }, 1000);
    }
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvdmVuZG9ycy1ub2RlX21vZHVsZXNfYXJjZ2lzX21hcC1jb21wb25lbnRzX2Rpc3RfZXNtX2FyY2dpcy11dGlsaXR5LW5ldHdvcmstYXNzb2NpYXRpb25zX2VudHJ5X2pzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNrRztBQUNqQjtBQUNjO0FBQ3hCOztBQUV2RSw0RUFBNEU7O0FBRTVFO0FBQ0E7QUFDQSxRQUFRLHFEQUFnQjtBQUN4QixxREFBcUQscURBQVc7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSwrREFBc0I7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixzREFBb0M7QUFDakU7QUFDQTtBQUNBO0FBQ0EsUUFBUSwrREFBWTtBQUNwQjtBQUNBO0FBQ0EsUUFBUSw0REFBb0I7QUFDNUI7QUFDQTtBQUNBLGVBQWUscURBQUMsVUFBVSxvQ0FBb0M7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxPQUFPLHFEQUFVO0FBQ2hDLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVtRjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNyV25GO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRXlOOzs7Ozs7Ozs7Ozs7Ozs7QUNwSnpOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVxQyIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9ub2RlX21vZHVsZXMvQGFyY2dpcy9tYXAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtdXRpbGl0eS1uZXR3b3JrLWFzc29jaWF0aW9ucy5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vbm9kZV9tb2R1bGVzL0BhcmNnaXMvbWFwLWNvbXBvbmVudHMvZGlzdC9lc20vY29tcG9uZW50LXV0aWxzLTIzMTk0ZjdjLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9ub2RlX21vZHVsZXMvQGFyY2dpcy9tYXAtY29tcG9uZW50cy9kaXN0L2VzbS9kaXNjb25uZWN0ZWQtNmNmMWMxMDAuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVzcmksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogU2VlIGh0dHBzOi8vanMuYXJjZ2lzLmNvbS80LjMwL2VzcmkvY29weXJpZ2h0LnR4dCBmb3IgZGV0YWlscy5cbiAqIHY0LjMwLjAtbmV4dC4zN1xuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIGcgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtNmUxNzJhYWMuanMnO1xuaW1wb3J0IHsgYTEgYXMgbmV3V2lkZ2V0c1V0aWxpdHlOZXR3b3JrQXNzb2NpYXRpb25zIH0gZnJvbSAnLi9pbmRleC0wYmM1NWNhNS5qcyc7XG5pbXBvcnQgeyByIGFzIHJlZmVyZW5jZUVsZW1lbnRIZWxwZXIsIGMgYXMgY2hlY2tGb3JWaWV3IH0gZnJvbSAnLi9jb21wb25lbnQtdXRpbHMtMjMxOTRmN2MuanMnO1xuaW1wb3J0IHsgbyBhcyBvbkRpc2Nvbm5lY3RlZEhlbHBlciB9IGZyb20gJy4vZGlzY29ubmVjdGVkLTZjZjFjMTAwLmpzJztcblxuY29uc3QgdXRpbGl0eU5ldHdvcmtBc3NvY2lhdGlvbnNDc3MgPSBcImFyY2dpcy11dGlsaXR5LW5ldHdvcmstYXNzb2NpYXRpb25ze31cIjtcblxuY29uc3QgQXJjZ2lzVXRpbGl0eU5ldHdvcmtBc3NvY2lhdGlvbnMgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IoaG9zdFJlZikge1xuICAgICAgICByZWdpc3Rlckluc3RhbmNlKHRoaXMsIGhvc3RSZWYpO1xuICAgICAgICB0aGlzLmFyY2dpc1V0aWxpdHlOZXR3b3JrQXNzb2NpYXRpb25zUmVhZHkgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1V0aWxpdHlOZXR3b3JrQXNzb2NpYXRpb25zUmVhZHlcIiwgNyk7XG4gICAgICAgIHRoaXMuX3dhdGNoSGFuZGxlcyA9IFtdO1xuICAgICAgICB0aGlzLnJlZmVyZW5jZUVsZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuYXV0b1JlZnJlc2hBc3NvY2lhdGlvbnMgPSB0cnVlO1xuICAgICAgICB0aGlzLmNvbm5lY3Rpdml0eUFzc29jaWF0aW9uc0xpbmVTeW1ib2wgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuaW5jbHVkZUNvbm5lY3Rpdml0eUFzc29jaWF0aW9ucyA9IHRydWU7XG4gICAgICAgIHRoaXMuaW5jbHVkZVN0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5tYXhBbGxvd2FibGVBc3NvY2lhdGlvbnMgPSAyNTA7XG4gICAgICAgIHRoaXMubWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zU2xpZGVyTWF4ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm1heEFsbG93YWJsZUFzc29jaWF0aW9uc1NsaWRlck1pbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5tYXhBbGxvd2FibGVBc3NvY2lhdGlvbnNTbGlkZXJTdGVwID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnNob3dBcnJvd3NDb25uZWN0aXZpdHkgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zaG93QXJyb3dzU3RydWN0dXJhbEF0dGFjaG1lbnQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zaG93QXNzb2NpYXRpb25zRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnN0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zTGluZVN5bWJvbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy51dGlsaXR5TmV0d29yayA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy52aXNpYmxlRWxlbWVudHNDb25uZWN0aXZpdHlBc3NvY2lhdGlvbnNTZXR0aW5nc0Fycm93c1RvZ2dsZSA9IHRydWU7XG4gICAgICAgIHRoaXMudmlzaWJsZUVsZW1lbnRzQ29ubmVjdGl2aXR5QXNzb2NpYXRpb25zU2V0dGluZ3NDYXBTZWxlY3QgPSB0cnVlO1xuICAgICAgICB0aGlzLnZpc2libGVFbGVtZW50c0Nvbm5lY3Rpdml0eUFzc29jaWF0aW9uc1NldHRpbmdzQ29sb3JQaWNrZXIgPSB0cnVlO1xuICAgICAgICB0aGlzLnZpc2libGVFbGVtZW50c0Nvbm5lY3Rpdml0eUFzc29jaWF0aW9uc1NldHRpbmdzU3R5bGVQaWNrZXIgPSB0cnVlO1xuICAgICAgICB0aGlzLnZpc2libGVFbGVtZW50c0Nvbm5lY3Rpdml0eUFzc29jaWF0aW9uc1NldHRpbmdzV2lkdGhJbnB1dCA9IHRydWU7XG4gICAgICAgIHRoaXMudmlzaWJsZUVsZW1lbnRzTWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zU2xpZGVyID0gdHJ1ZTtcbiAgICAgICAgdGhpcy52aXNpYmxlRWxlbWVudHNTdHJ1Y3R1cmFsQXR0YWNobWVudEFzc29jaWF0aW9uc1NldHRpbmdzQXJyb3dzVG9nZ2xlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy52aXNpYmxlRWxlbWVudHNTdHJ1Y3R1cmFsQXR0YWNobWVudEFzc29jaWF0aW9uc1NldHRpbmdzQ2FwU2VsZWN0ID0gdHJ1ZTtcbiAgICAgICAgdGhpcy52aXNpYmxlRWxlbWVudHNTdHJ1Y3R1cmFsQXR0YWNobWVudEFzc29jaWF0aW9uc1NldHRpbmdzU3R5bGVQaWNrZXIgPSB0cnVlO1xuICAgICAgICB0aGlzLnZpc2libGVFbGVtZW50c1N0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zU2V0dGluZ3NXaWR0aElucHV0ID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IFwiYm90dG9tLWxlZnRcIjtcbiAgICAgICAgdGhpcy52aWV3ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLndpZGdldCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcmVmZXJlbmNlRWxlbWVudFdhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgdm9pZCByZWZlcmVuY2VFbGVtZW50SGVscGVyKHRoaXMsIHZhbHVlKTtcbiAgICB9XG4gICAgYXV0b1JlZnJlc2hBc3NvY2lhdGlvbnNXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMud2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLndpZGdldC5hdXRvUmVmcmVzaEFzc29jaWF0aW9ucyA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbm5lY3Rpdml0eUFzc29jaWF0aW9uc0xpbmVTeW1ib2xXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLndpZGdldCkge1xuICAgICAgICAgICAgdGhpcy53aWRnZXQuY29ubmVjdGl2aXR5QXNzb2NpYXRpb25zTGluZVN5bWJvbCA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGluY2x1ZGVDb25uZWN0aXZpdHlBc3NvY2lhdGlvbnNXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMud2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLndpZGdldC5pbmNsdWRlQ29ubmVjdGl2aXR5QXNzb2NpYXRpb25zID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaW5jbHVkZVN0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zV2F0Y2hlcih2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLndpZGdldCkge1xuICAgICAgICAgICAgdGhpcy53aWRnZXQuaW5jbHVkZVN0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zV2F0Y2hlcih2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLndpZGdldCkge1xuICAgICAgICAgICAgdGhpcy53aWRnZXQubWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zU2xpZGVyTWF4V2F0Y2hlcih2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLndpZGdldCkge1xuICAgICAgICAgICAgdGhpcy53aWRnZXQubWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zU2xpZGVyTWF4ID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zU2xpZGVyTWluV2F0Y2hlcih2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLndpZGdldCkge1xuICAgICAgICAgICAgdGhpcy53aWRnZXQubWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zU2xpZGVyTWluID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zU2xpZGVyU3RlcFdhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdGhpcy53aWRnZXQpIHtcbiAgICAgICAgICAgIHRoaXMud2lkZ2V0Lm1heEFsbG93YWJsZUFzc29jaWF0aW9uc1NsaWRlclN0ZXAgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzaG93QXJyb3dzQ29ubmVjdGl2aXR5V2F0Y2hlcih2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLndpZGdldCkge1xuICAgICAgICAgICAgdGhpcy53aWRnZXQuc2hvd0Fycm93c0Nvbm5lY3Rpdml0eSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNob3dBcnJvd3NTdHJ1Y3R1cmFsQXR0YWNobWVudFdhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdGhpcy53aWRnZXQpIHtcbiAgICAgICAgICAgIHRoaXMud2lkZ2V0LnNob3dBcnJvd3NTdHJ1Y3R1cmFsQXR0YWNobWVudCA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNob3dBc3NvY2lhdGlvbnNFbmFibGVkV2F0Y2hlcih2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0aGlzLndpZGdldCkge1xuICAgICAgICAgICAgdGhpcy53aWRnZXQuc2hvd0Fzc29jaWF0aW9uc0VuYWJsZWQgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzdHJ1Y3R1cmFsQXR0YWNobWVudEFzc29jaWF0aW9uc0xpbmVTeW1ib2xXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLndpZGdldCkge1xuICAgICAgICAgICAgdGhpcy53aWRnZXQuc3RydWN0dXJhbEF0dGFjaG1lbnRBc3NvY2lhdGlvbnNMaW5lU3ltYm9sID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdXRpbGl0eU5ldHdvcmtXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLndpZGdldCkge1xuICAgICAgICAgICAgdGhpcy53aWRnZXQudXRpbGl0eU5ldHdvcmsgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB2aXNpYmxlRWxlbWVudHNDb25uZWN0aXZpdHlBc3NvY2lhdGlvbnNTZXR0aW5nc0Fycm93c1RvZ2dsZVdhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMud2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLndpZGdldC52aXNpYmxlRWxlbWVudHMgPSB7XG4gICAgICAgICAgICAgICAgLi4udGhpcy53aWRnZXQudmlzaWJsZUVsZW1lbnRzLFxuICAgICAgICAgICAgICAgIGNvbm5lY3Rpdml0eUFzc29jaWF0aW9uc1NldHRpbmdzOiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnRoaXMud2lkZ2V0LnZpc2libGVFbGVtZW50cy5jb25uZWN0aXZpdHlBc3NvY2lhdGlvbnNTZXR0aW5ncyxcbiAgICAgICAgICAgICAgICAgICAgYXJyb3dzVG9nZ2xlOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB2aXNpYmxlRWxlbWVudHNDb25uZWN0aXZpdHlBc3NvY2lhdGlvbnNTZXR0aW5nc0NhcFNlbGVjdFdhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMud2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLndpZGdldC52aXNpYmxlRWxlbWVudHMgPSB7XG4gICAgICAgICAgICAgICAgLi4udGhpcy53aWRnZXQudmlzaWJsZUVsZW1lbnRzLFxuICAgICAgICAgICAgICAgIGNvbm5lY3Rpdml0eUFzc29jaWF0aW9uc1NldHRpbmdzOiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnRoaXMud2lkZ2V0LnZpc2libGVFbGVtZW50cy5jb25uZWN0aXZpdHlBc3NvY2lhdGlvbnNTZXR0aW5ncyxcbiAgICAgICAgICAgICAgICAgICAgY2FwU2VsZWN0OiB2YWx1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB2aXNpYmxlRWxlbWVudHNDb25uZWN0aXZpdHlBc3NvY2lhdGlvbnNTZXR0aW5nc0NvbG9yUGlja2VyV2F0Y2hlcih2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy53aWRnZXQpIHtcbiAgICAgICAgICAgIHRoaXMud2lkZ2V0LnZpc2libGVFbGVtZW50cyA9IHtcbiAgICAgICAgICAgICAgICAuLi50aGlzLndpZGdldC52aXNpYmxlRWxlbWVudHMsXG4gICAgICAgICAgICAgICAgY29ubmVjdGl2aXR5QXNzb2NpYXRpb25zU2V0dGluZ3M6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4udGhpcy53aWRnZXQudmlzaWJsZUVsZW1lbnRzLmNvbm5lY3Rpdml0eUFzc29jaWF0aW9uc1NldHRpbmdzLFxuICAgICAgICAgICAgICAgICAgICBjb2xvclBpY2tlcjogdmFsdWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgdmlzaWJsZUVsZW1lbnRzQ29ubmVjdGl2aXR5QXNzb2NpYXRpb25zU2V0dGluZ3NTdHlsZVBpY2tlcldhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMud2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLndpZGdldC52aXNpYmxlRWxlbWVudHMgPSB7XG4gICAgICAgICAgICAgICAgLi4udGhpcy53aWRnZXQudmlzaWJsZUVsZW1lbnRzLFxuICAgICAgICAgICAgICAgIGNvbm5lY3Rpdml0eUFzc29jaWF0aW9uc1NldHRpbmdzOiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnRoaXMud2lkZ2V0LnZpc2libGVFbGVtZW50cy5jb25uZWN0aXZpdHlBc3NvY2lhdGlvbnNTZXR0aW5ncyxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGVQaWNrZXI6IHZhbHVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxuICAgIHZpc2libGVFbGVtZW50c0Nvbm5lY3Rpdml0eUFzc29jaWF0aW9uc1NldHRpbmdzV2lkdGhJbnB1dFdhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMud2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLndpZGdldC52aXNpYmxlRWxlbWVudHMgPSB7XG4gICAgICAgICAgICAgICAgLi4udGhpcy53aWRnZXQudmlzaWJsZUVsZW1lbnRzLFxuICAgICAgICAgICAgICAgIGNvbm5lY3Rpdml0eUFzc29jaWF0aW9uc1NldHRpbmdzOiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnRoaXMud2lkZ2V0LnZpc2libGVFbGVtZW50cy5jb25uZWN0aXZpdHlBc3NvY2lhdGlvbnNTZXR0aW5ncyxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGhJbnB1dDogdmFsdWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgdmlzaWJsZUVsZW1lbnRzTWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zU2xpZGVyV2F0Y2hlcih2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy53aWRnZXQpIHtcbiAgICAgICAgICAgIHRoaXMud2lkZ2V0LnZpc2libGVFbGVtZW50cyA9IHtcbiAgICAgICAgICAgICAgICAuLi50aGlzLndpZGdldC52aXNpYmxlRWxlbWVudHMsXG4gICAgICAgICAgICAgICAgbWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zU2xpZGVyOiB2YWx1ZSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgdmlzaWJsZUVsZW1lbnRzU3RydWN0dXJhbEF0dGFjaG1lbnRBc3NvY2lhdGlvbnNTZXR0aW5nc0Fycm93c1RvZ2dsZVdhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMud2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLndpZGdldC52aXNpYmxlRWxlbWVudHMgPSB7XG4gICAgICAgICAgICAgICAgLi4udGhpcy53aWRnZXQudmlzaWJsZUVsZW1lbnRzLFxuICAgICAgICAgICAgICAgIHN0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zU2V0dGluZ3M6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4udGhpcy53aWRnZXQudmlzaWJsZUVsZW1lbnRzLnN0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zU2V0dGluZ3MsXG4gICAgICAgICAgICAgICAgICAgIGFycm93c1RvZ2dsZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgdmlzaWJsZUVsZW1lbnRzU3RydWN0dXJhbEF0dGFjaG1lbnRBc3NvY2lhdGlvbnNTZXR0aW5nc0NhcFNlbGVjdFdhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMud2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLndpZGdldC52aXNpYmxlRWxlbWVudHMgPSB7XG4gICAgICAgICAgICAgICAgLi4udGhpcy53aWRnZXQudmlzaWJsZUVsZW1lbnRzLFxuICAgICAgICAgICAgICAgIHN0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zU2V0dGluZ3M6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4udGhpcy53aWRnZXQudmlzaWJsZUVsZW1lbnRzLnN0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zU2V0dGluZ3MsXG4gICAgICAgICAgICAgICAgICAgIGNhcFNlbGVjdDogdmFsdWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgdmlzaWJsZUVsZW1lbnRzU3RydWN0dXJhbEF0dGFjaG1lbnRBc3NvY2lhdGlvbnNTZXR0aW5nc1N0eWxlUGlja2VyV2F0Y2hlcih2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy53aWRnZXQpIHtcbiAgICAgICAgICAgIHRoaXMud2lkZ2V0LnZpc2libGVFbGVtZW50cyA9IHtcbiAgICAgICAgICAgICAgICAuLi50aGlzLndpZGdldC52aXNpYmxlRWxlbWVudHMsXG4gICAgICAgICAgICAgICAgc3RydWN0dXJhbEF0dGFjaG1lbnRBc3NvY2lhdGlvbnNTZXR0aW5nczoge1xuICAgICAgICAgICAgICAgICAgICAuLi50aGlzLndpZGdldC52aXNpYmxlRWxlbWVudHMuc3RydWN0dXJhbEF0dGFjaG1lbnRBc3NvY2lhdGlvbnNTZXR0aW5ncyxcbiAgICAgICAgICAgICAgICAgICAgc3R5bGVQaWNrZXI6IHZhbHVlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxuICAgIHZpc2libGVFbGVtZW50c1N0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zU2V0dGluZ3NXaWR0aElucHV0V2F0Y2hlcih2YWx1ZSkge1xuICAgICAgICBpZiAodGhpcy53aWRnZXQpIHtcbiAgICAgICAgICAgIHRoaXMud2lkZ2V0LnZpc2libGVFbGVtZW50cyA9IHtcbiAgICAgICAgICAgICAgICAuLi50aGlzLndpZGdldC52aXNpYmxlRWxlbWVudHMsXG4gICAgICAgICAgICAgICAgc3RydWN0dXJhbEF0dGFjaG1lbnRBc3NvY2lhdGlvbnNTZXR0aW5nczoge1xuICAgICAgICAgICAgICAgICAgICAuLi50aGlzLndpZGdldC52aXNpYmxlRWxlbWVudHMuc3RydWN0dXJhbEF0dGFjaG1lbnRBc3NvY2lhdGlvbnNTZXR0aW5ncyxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGhJbnB1dDogdmFsdWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcG9zaXRpb25XYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMud2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLnZpZXcudWkubW92ZSh0aGlzLmNoaWxkRWxlbSwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHZpZXdXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMud2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLndpZGdldC52aWV3ID0gdmFsdWU7XG4gICAgICAgICAgICB2b2lkIHRoaXMuX2xvYWRVdGlsaXR5TmV0d29yaygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvL1xuICAgIC8vICBMaWZlY3ljbGVcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBjb21wb25lbnREaWRMb2FkKCkge1xuICAgICAgICBjb25zdCBwYXJhbXMgPSB0aGlzLl9jcmVhdGVQYXJhbXMoKTtcbiAgICAgICAgY29uc3Qgd2lkZ2V0ID0gYXdhaXQgbmV3V2lkZ2V0c1V0aWxpdHlOZXR3b3JrQXNzb2NpYXRpb25zKHBhcmFtcyk7XG4gICAgICAgIHRoaXMud2lkZ2V0ID0gd2lkZ2V0O1xuICAgICAgICB0aGlzLl9hZGRDb250YWluZXIoKTtcbiAgICAgICAgdGhpcy5hcmNnaXNVdGlsaXR5TmV0d29ya0Fzc29jaWF0aW9uc1JlYWR5LmVtaXQoKTtcbiAgICAgICAgY2hlY2tGb3JWaWV3KHRoaXMpO1xuICAgIH1cbiAgICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgb25EaXNjb25uZWN0ZWRIZWxwZXIodGhpcyk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIGgoXCJkaXZcIiwgeyByZWY6IChlbCkgPT4gKHRoaXMuY2hpbGRFbGVtID0gZWwpIH0pO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJpdmF0ZSBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgX2FkZENvbnRhaW5lcigpIHtcbiAgICAgICAgdGhpcy53aWRnZXQuY29udGFpbmVyID0gdGhpcy5jaGlsZEVsZW07XG4gICAgfVxuICAgIF9jcmVhdGVQYXJhbXMoKSB7XG4gICAgICAgIGNvbnN0IHBhcmFtcyA9IHt9O1xuICAgICAgICBwYXJhbXMudmlzaWJsZUVsZW1lbnRzID0ge1xuICAgICAgICAgICAgY29ubmVjdGl2aXR5QXNzb2NpYXRpb25zU2V0dGluZ3M6IHtcbiAgICAgICAgICAgICAgICBhcnJvd3NUb2dnbGU6IHRoaXMudmlzaWJsZUVsZW1lbnRzQ29ubmVjdGl2aXR5QXNzb2NpYXRpb25zU2V0dGluZ3NBcnJvd3NUb2dnbGUsXG4gICAgICAgICAgICAgICAgY2FwU2VsZWN0OiB0aGlzLnZpc2libGVFbGVtZW50c0Nvbm5lY3Rpdml0eUFzc29jaWF0aW9uc1NldHRpbmdzQ2FwU2VsZWN0LFxuICAgICAgICAgICAgICAgIGNvbG9yUGlja2VyOiB0aGlzLnZpc2libGVFbGVtZW50c0Nvbm5lY3Rpdml0eUFzc29jaWF0aW9uc1NldHRpbmdzQ29sb3JQaWNrZXIsXG4gICAgICAgICAgICAgICAgc3R5bGVQaWNrZXI6IHRoaXMudmlzaWJsZUVsZW1lbnRzQ29ubmVjdGl2aXR5QXNzb2NpYXRpb25zU2V0dGluZ3NTdHlsZVBpY2tlcixcbiAgICAgICAgICAgICAgICB3aWR0aElucHV0OiB0aGlzLnZpc2libGVFbGVtZW50c0Nvbm5lY3Rpdml0eUFzc29jaWF0aW9uc1NldHRpbmdzV2lkdGhJbnB1dCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtYXhBbGxvd2FibGVBc3NvY2lhdGlvbnNTbGlkZXI6IHRoaXMudmlzaWJsZUVsZW1lbnRzTWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zU2xpZGVyLFxuICAgICAgICAgICAgc3RydWN0dXJhbEF0dGFjaG1lbnRBc3NvY2lhdGlvbnNTZXR0aW5nczoge1xuICAgICAgICAgICAgICAgIGFycm93c1RvZ2dsZTogdGhpcy52aXNpYmxlRWxlbWVudHNTdHJ1Y3R1cmFsQXR0YWNobWVudEFzc29jaWF0aW9uc1NldHRpbmdzQXJyb3dzVG9nZ2xlLFxuICAgICAgICAgICAgICAgIGNhcFNlbGVjdDogdGhpcy52aXNpYmxlRWxlbWVudHNTdHJ1Y3R1cmFsQXR0YWNobWVudEFzc29jaWF0aW9uc1NldHRpbmdzQ2FwU2VsZWN0LFxuICAgICAgICAgICAgICAgIHN0eWxlUGlja2VyOiB0aGlzLnZpc2libGVFbGVtZW50c1N0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zU2V0dGluZ3NTdHlsZVBpY2tlcixcbiAgICAgICAgICAgICAgICB3aWR0aElucHV0OiB0aGlzLnZpc2libGVFbGVtZW50c1N0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zU2V0dGluZ3NXaWR0aElucHV0LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHRoaXMuYXV0b1JlZnJlc2hBc3NvY2lhdGlvbnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcGFyYW1zLmF1dG9SZWZyZXNoQXNzb2NpYXRpb25zID0gdGhpcy5hdXRvUmVmcmVzaEFzc29jaWF0aW9ucztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jb25uZWN0aXZpdHlBc3NvY2lhdGlvbnNMaW5lU3ltYm9sICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHBhcmFtcy5jb25uZWN0aXZpdHlBc3NvY2lhdGlvbnNMaW5lU3ltYm9sID0gdGhpcy5jb25uZWN0aXZpdHlBc3NvY2lhdGlvbnNMaW5lU3ltYm9sO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmluY2x1ZGVDb25uZWN0aXZpdHlBc3NvY2lhdGlvbnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcGFyYW1zLmluY2x1ZGVDb25uZWN0aXZpdHlBc3NvY2lhdGlvbnMgPSB0aGlzLmluY2x1ZGVDb25uZWN0aXZpdHlBc3NvY2lhdGlvbnM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaW5jbHVkZVN0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHBhcmFtcy5pbmNsdWRlU3RydWN0dXJhbEF0dGFjaG1lbnRBc3NvY2lhdGlvbnMgPSB0aGlzLmluY2x1ZGVTdHJ1Y3R1cmFsQXR0YWNobWVudEFzc29jaWF0aW9ucztcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5tYXhBbGxvd2FibGVBc3NvY2lhdGlvbnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcGFyYW1zLm1heEFsbG93YWJsZUFzc29jaWF0aW9ucyA9IHRoaXMubWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm1heEFsbG93YWJsZUFzc29jaWF0aW9uc1NsaWRlck1heCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBwYXJhbXMubWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zU2xpZGVyTWF4ID0gdGhpcy5tYXhBbGxvd2FibGVBc3NvY2lhdGlvbnNTbGlkZXJNYXg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zU2xpZGVyTWluICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHBhcmFtcy5tYXhBbGxvd2FibGVBc3NvY2lhdGlvbnNTbGlkZXJNaW4gPSB0aGlzLm1heEFsbG93YWJsZUFzc29jaWF0aW9uc1NsaWRlck1pbjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5tYXhBbGxvd2FibGVBc3NvY2lhdGlvbnNTbGlkZXJTdGVwICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHBhcmFtcy5tYXhBbGxvd2FibGVBc3NvY2lhdGlvbnNTbGlkZXJTdGVwID0gdGhpcy5tYXhBbGxvd2FibGVBc3NvY2lhdGlvbnNTbGlkZXJTdGVwO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNob3dBcnJvd3NDb25uZWN0aXZpdHkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcGFyYW1zLnNob3dBcnJvd3NDb25uZWN0aXZpdHkgPSB0aGlzLnNob3dBcnJvd3NDb25uZWN0aXZpdHk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2hvd0Fycm93c1N0cnVjdHVyYWxBdHRhY2htZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHBhcmFtcy5zaG93QXJyb3dzU3RydWN0dXJhbEF0dGFjaG1lbnQgPSB0aGlzLnNob3dBcnJvd3NTdHJ1Y3R1cmFsQXR0YWNobWVudDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zaG93QXNzb2NpYXRpb25zRW5hYmxlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBwYXJhbXMuc2hvd0Fzc29jaWF0aW9uc0VuYWJsZWQgPSB0aGlzLnNob3dBc3NvY2lhdGlvbnNFbmFibGVkO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnN0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zTGluZVN5bWJvbCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBwYXJhbXMuc3RydWN0dXJhbEF0dGFjaG1lbnRBc3NvY2lhdGlvbnNMaW5lU3ltYm9sID0gdGhpcy5zdHJ1Y3R1cmFsQXR0YWNobWVudEFzc29jaWF0aW9uc0xpbmVTeW1ib2w7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudXRpbGl0eU5ldHdvcmsgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcGFyYW1zLnV0aWxpdHlOZXR3b3JrID0gdGhpcy51dGlsaXR5TmV0d29yaztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGFyYW1zO1xuICAgIH1cbiAgICBhc3luYyBfbG9hZFV0aWxpdHlOZXR3b3JrKCkge1xuICAgICAgICBpZiAodGhpcy52aWV3Py5tYXAgJiYgdGhpcy52aWV3Lm1hcC5wb3J0YWxJdGVtKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnZpZXcubWFwLmxvYWQoKTtcbiAgICAgICAgICAgIGNvbnN0IHV0aWxpdHlOZXR3b3JrID0gdGhpcy52aWV3Lm1hcC51dGlsaXR5TmV0d29ya3MuZ2V0SXRlbUF0KDApO1xuICAgICAgICAgICAgYXdhaXQgdXRpbGl0eU5ldHdvcmsubG9hZCgpO1xuICAgICAgICAgICAgdGhpcy51dGlsaXR5TmV0d29yayA9IHV0aWxpdHlOZXR3b3JrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBlbCgpIHsgcmV0dXJuIGdldEVsZW1lbnQodGhpcyk7IH1cbiAgICBzdGF0aWMgZ2V0IHdhdGNoZXJzKCkgeyByZXR1cm4ge1xuICAgICAgICBcInJlZmVyZW5jZUVsZW1lbnRcIjogW1wicmVmZXJlbmNlRWxlbWVudFdhdGNoZXJcIl0sXG4gICAgICAgIFwiYXV0b1JlZnJlc2hBc3NvY2lhdGlvbnNcIjogW1wiYXV0b1JlZnJlc2hBc3NvY2lhdGlvbnNXYXRjaGVyXCJdLFxuICAgICAgICBcImNvbm5lY3Rpdml0eUFzc29jaWF0aW9uc0xpbmVTeW1ib2xcIjogW1wiY29ubmVjdGl2aXR5QXNzb2NpYXRpb25zTGluZVN5bWJvbFdhdGNoZXJcIl0sXG4gICAgICAgIFwiaW5jbHVkZUNvbm5lY3Rpdml0eUFzc29jaWF0aW9uc1wiOiBbXCJpbmNsdWRlQ29ubmVjdGl2aXR5QXNzb2NpYXRpb25zV2F0Y2hlclwiXSxcbiAgICAgICAgXCJpbmNsdWRlU3RydWN0dXJhbEF0dGFjaG1lbnRBc3NvY2lhdGlvbnNcIjogW1wiaW5jbHVkZVN0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zV2F0Y2hlclwiXSxcbiAgICAgICAgXCJtYXhBbGxvd2FibGVBc3NvY2lhdGlvbnNcIjogW1wibWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zV2F0Y2hlclwiXSxcbiAgICAgICAgXCJtYXhBbGxvd2FibGVBc3NvY2lhdGlvbnNTbGlkZXJNYXhcIjogW1wibWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zU2xpZGVyTWF4V2F0Y2hlclwiXSxcbiAgICAgICAgXCJtYXhBbGxvd2FibGVBc3NvY2lhdGlvbnNTbGlkZXJNaW5cIjogW1wibWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zU2xpZGVyTWluV2F0Y2hlclwiXSxcbiAgICAgICAgXCJtYXhBbGxvd2FibGVBc3NvY2lhdGlvbnNTbGlkZXJTdGVwXCI6IFtcIm1heEFsbG93YWJsZUFzc29jaWF0aW9uc1NsaWRlclN0ZXBXYXRjaGVyXCJdLFxuICAgICAgICBcInNob3dBcnJvd3NDb25uZWN0aXZpdHlcIjogW1wic2hvd0Fycm93c0Nvbm5lY3Rpdml0eVdhdGNoZXJcIl0sXG4gICAgICAgIFwic2hvd0Fycm93c1N0cnVjdHVyYWxBdHRhY2htZW50XCI6IFtcInNob3dBcnJvd3NTdHJ1Y3R1cmFsQXR0YWNobWVudFdhdGNoZXJcIl0sXG4gICAgICAgIFwic2hvd0Fzc29jaWF0aW9uc0VuYWJsZWRcIjogW1wic2hvd0Fzc29jaWF0aW9uc0VuYWJsZWRXYXRjaGVyXCJdLFxuICAgICAgICBcInN0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zTGluZVN5bWJvbFwiOiBbXCJzdHJ1Y3R1cmFsQXR0YWNobWVudEFzc29jaWF0aW9uc0xpbmVTeW1ib2xXYXRjaGVyXCJdLFxuICAgICAgICBcInV0aWxpdHlOZXR3b3JrXCI6IFtcInV0aWxpdHlOZXR3b3JrV2F0Y2hlclwiXSxcbiAgICAgICAgXCJ2aXNpYmxlRWxlbWVudHNDb25uZWN0aXZpdHlBc3NvY2lhdGlvbnNTZXR0aW5nc0Fycm93c1RvZ2dsZVwiOiBbXCJ2aXNpYmxlRWxlbWVudHNDb25uZWN0aXZpdHlBc3NvY2lhdGlvbnNTZXR0aW5nc0Fycm93c1RvZ2dsZVdhdGNoZXJcIl0sXG4gICAgICAgIFwidmlzaWJsZUVsZW1lbnRzQ29ubmVjdGl2aXR5QXNzb2NpYXRpb25zU2V0dGluZ3NDYXBTZWxlY3RcIjogW1widmlzaWJsZUVsZW1lbnRzQ29ubmVjdGl2aXR5QXNzb2NpYXRpb25zU2V0dGluZ3NDYXBTZWxlY3RXYXRjaGVyXCJdLFxuICAgICAgICBcInZpc2libGVFbGVtZW50c0Nvbm5lY3Rpdml0eUFzc29jaWF0aW9uc1NldHRpbmdzQ29sb3JQaWNrZXJcIjogW1widmlzaWJsZUVsZW1lbnRzQ29ubmVjdGl2aXR5QXNzb2NpYXRpb25zU2V0dGluZ3NDb2xvclBpY2tlcldhdGNoZXJcIl0sXG4gICAgICAgIFwidmlzaWJsZUVsZW1lbnRzQ29ubmVjdGl2aXR5QXNzb2NpYXRpb25zU2V0dGluZ3NTdHlsZVBpY2tlclwiOiBbXCJ2aXNpYmxlRWxlbWVudHNDb25uZWN0aXZpdHlBc3NvY2lhdGlvbnNTZXR0aW5nc1N0eWxlUGlja2VyV2F0Y2hlclwiXSxcbiAgICAgICAgXCJ2aXNpYmxlRWxlbWVudHNDb25uZWN0aXZpdHlBc3NvY2lhdGlvbnNTZXR0aW5nc1dpZHRoSW5wdXRcIjogW1widmlzaWJsZUVsZW1lbnRzQ29ubmVjdGl2aXR5QXNzb2NpYXRpb25zU2V0dGluZ3NXaWR0aElucHV0V2F0Y2hlclwiXSxcbiAgICAgICAgXCJ2aXNpYmxlRWxlbWVudHNNYXhBbGxvd2FibGVBc3NvY2lhdGlvbnNTbGlkZXJcIjogW1widmlzaWJsZUVsZW1lbnRzTWF4QWxsb3dhYmxlQXNzb2NpYXRpb25zU2xpZGVyV2F0Y2hlclwiXSxcbiAgICAgICAgXCJ2aXNpYmxlRWxlbWVudHNTdHJ1Y3R1cmFsQXR0YWNobWVudEFzc29jaWF0aW9uc1NldHRpbmdzQXJyb3dzVG9nZ2xlXCI6IFtcInZpc2libGVFbGVtZW50c1N0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zU2V0dGluZ3NBcnJvd3NUb2dnbGVXYXRjaGVyXCJdLFxuICAgICAgICBcInZpc2libGVFbGVtZW50c1N0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zU2V0dGluZ3NDYXBTZWxlY3RcIjogW1widmlzaWJsZUVsZW1lbnRzU3RydWN0dXJhbEF0dGFjaG1lbnRBc3NvY2lhdGlvbnNTZXR0aW5nc0NhcFNlbGVjdFdhdGNoZXJcIl0sXG4gICAgICAgIFwidmlzaWJsZUVsZW1lbnRzU3RydWN0dXJhbEF0dGFjaG1lbnRBc3NvY2lhdGlvbnNTZXR0aW5nc1N0eWxlUGlja2VyXCI6IFtcInZpc2libGVFbGVtZW50c1N0cnVjdHVyYWxBdHRhY2htZW50QXNzb2NpYXRpb25zU2V0dGluZ3NTdHlsZVBpY2tlcldhdGNoZXJcIl0sXG4gICAgICAgIFwidmlzaWJsZUVsZW1lbnRzU3RydWN0dXJhbEF0dGFjaG1lbnRBc3NvY2lhdGlvbnNTZXR0aW5nc1dpZHRoSW5wdXRcIjogW1widmlzaWJsZUVsZW1lbnRzU3RydWN0dXJhbEF0dGFjaG1lbnRBc3NvY2lhdGlvbnNTZXR0aW5nc1dpZHRoSW5wdXRXYXRjaGVyXCJdLFxuICAgICAgICBcInBvc2l0aW9uXCI6IFtcInBvc2l0aW9uV2F0Y2hlclwiXSxcbiAgICAgICAgXCJ2aWV3XCI6IFtcInZpZXdXYXRjaGVyXCJdXG4gICAgfTsgfVxufTtcbkFyY2dpc1V0aWxpdHlOZXR3b3JrQXNzb2NpYXRpb25zLnN0eWxlID0gdXRpbGl0eU5ldHdvcmtBc3NvY2lhdGlvbnNDc3M7XG5cbmV4cG9ydCB7IEFyY2dpc1V0aWxpdHlOZXR3b3JrQXNzb2NpYXRpb25zIGFzIGFyY2dpc191dGlsaXR5X25ldHdvcmtfYXNzb2NpYXRpb25zIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRXNyaSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiBTZWUgaHR0cHM6Ly9qcy5hcmNnaXMuY29tLzQuMzAvZXNyaS9jb3B5cmlnaHQudHh0IGZvciBkZXRhaWxzLlxuICogdjQuMzAuMC1uZXh0LjM3XG4gKi9cbmZ1bmN0aW9uIGNoZWNrRm9yRXhwYW5kKGVsZW1lbnQpIHtcbiAgICBjb25zdCBleHBhbmRSZWYgPSBlbGVtZW50LmVsLmNsb3Nlc3QoXCJhcmNnaXMtZXhwYW5kXCIpID8/IGVsZW1lbnQuZXhwYW5kRWxlbTtcbiAgICBpZiAoZXhwYW5kUmVmPy53aWRnZXQpIHtcbiAgICAgICAgZWxlbWVudC52aWV3ID0gZXhwYW5kUmVmLnZpZXc7XG4gICAgICAgIGV4cGFuZFJlZi53aWRnZXQuY29udGVudCA9IGVsZW1lbnQuY2hpbGRFbGVtID8/IGVsZW1lbnQuZWw7XG4gICAgICAgIC8vIFRPRE86IFVwZGF0ZSB0byBiZSBleHBhbmRJY29uID0gd2lkZ2V0Lmljb24sIG5vdCByZWFkeSB5ZXQgaW4gNC4yN25leHRcbiAgICAgICAgaWYgKCFleHBhbmRSZWYuZXhwYW5kSWNvbikge1xuICAgICAgICAgICAgZXhwYW5kUmVmLndpZGdldC5leHBhbmRJY29uID0gZWxlbWVudC53aWRnZXQgPyBlbGVtZW50LndpZGdldC5pY29uIDogZWxlbWVudD8uaWNvbjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGV4cGFuZFJlZikge1xuICAgICAgICBjb25zdCB3aWRnZXRIYW5kbGVyID0gKCkgPT4ge1xuICAgICAgICAgICAgZXhwYW5kUmVmLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJhcmNnaXNFeHBhbmRSZWFkeVwiLCB3aWRnZXRIYW5kbGVyLCBmYWxzZSk7XG4gICAgICAgICAgICBlbGVtZW50LnZpZXcgPSBleHBhbmRSZWYudmlldztcbiAgICAgICAgICAgIGV4cGFuZFJlZi53aWRnZXQuY29udGVudCA9IGVsZW1lbnQuY2hpbGRFbGVtID8/IGVsZW1lbnQuZWw7XG4gICAgICAgICAgICBpZiAoIWV4cGFuZFJlZi5leHBhbmRJY29uKSB7XG4gICAgICAgICAgICAgICAgZXhwYW5kUmVmLndpZGdldC5leHBhbmRJY29uID0gZWxlbWVudC53aWRnZXQgPyBlbGVtZW50LndpZGdldC5pY29uIDogZWxlbWVudD8uaWNvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgZXhwYW5kUmVmLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNFeHBhbmRSZWFkeVwiLCB3aWRnZXRIYW5kbGVyLCBmYWxzZSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vXG4vLyAgUHVibGljIE1ldGhvZHNcbi8vXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5mdW5jdGlvbiBhZGRIYW5kbGVzKGVsZW1lbnQsIGhhbmRsZSkge1xuICAgIGlmIChBcnJheS5pc0FycmF5KGhhbmRsZSkpIHtcbiAgICAgICAgZWxlbWVudC5fd2F0Y2hIYW5kbGVzID0gWy4uLmVsZW1lbnQuX3dhdGNoSGFuZGxlcywgLi4uaGFuZGxlXTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGVsZW1lbnQuX3dhdGNoSGFuZGxlcy5wdXNoKGhhbmRsZSk7XG4gICAgfVxufVxuZnVuY3Rpb24gY2hlY2tGb3JWaWV3KGVsZW1lbnQpIHtcbiAgICBsZXQgaXNVc2luZ1JlZmVyZW5jZUVsZW1lbnQgPSBmYWxzZTtcbiAgICBpZiAoIWNoZWNrRm9yRXhwYW5kKGVsZW1lbnQpKSB7XG4gICAgICAgIGxldCB2aWV3UmVmID0gZWxlbWVudC5lbC5jbG9zZXN0KFwiYXJjZ2lzLW1hcFwiKSA/PyBlbGVtZW50LmVsLmNsb3Nlc3QoXCJhcmNnaXMtc2NlbmVcIik7XG4gICAgICAgIGlmICghdmlld1JlZiAmJiB0eXBlb2YgZWxlbWVudC5yZWZlcmVuY2VFbGVtZW50ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICB2aWV3UmVmID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbGVtZW50LnJlZmVyZW5jZUVsZW1lbnQpO1xuICAgICAgICAgICAgaXNVc2luZ1JlZmVyZW5jZUVsZW1lbnQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2aWV3UmVmPy52aWV3KSB7XG4gICAgICAgICAgICBlbGVtZW50LnZpZXcgPSB2aWV3UmVmLnZpZXc7XG4gICAgICAgICAgICBjb25zdCBlbCA9IGVsZW1lbnQuY2hpbGRFbGVtID8/IGVsZW1lbnQuZWw7XG4gICAgICAgICAgICBpZiAoIWlzVXNpbmdSZWZlcmVuY2VFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC52aWV3LnVpLmFkZChlbCwgZWxlbWVudC5wb3NpdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodmlld1JlZikge1xuICAgICAgICAgICAgd2FpdEZvclZpZXdIYW5kbGVyKHZpZXdSZWYsIGVsZW1lbnQsIGlzVXNpbmdSZWZlcmVuY2VFbGVtZW50KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3Qgdmlld1JlZiA9IGVsZW1lbnQuZWwuY2xvc2VzdChcImFyY2dpcy1tYXBcIikgPz8gZWxlbWVudC5lbC5jbG9zZXN0KFwiYXJjZ2lzLXNjZW5lXCIpO1xuICAgICAgICBpZiAodmlld1JlZj8udmlldykge1xuICAgICAgICAgICAgZWxlbWVudC52aWV3ID0gdmlld1JlZi52aWV3O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHZpZXdSZWYpIHtcbiAgICAgICAgICAgIGNvbnN0IGhhbmRsZXIgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdmlld1JlZi5yZW1vdmVFdmVudExpc3RlbmVyKFwiYXJjZ2lzVmlld1JlYWR5Q2hhbmdlXCIsIGhhbmRsZXIsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnZpZXcgPSB2aWV3UmVmLnZpZXc7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdmlld1JlZi5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzVmlld1JlYWR5Q2hhbmdlXCIsIGhhbmRsZXIsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGlzTnVsbE9yRW1wdHlTdHJpbmcodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gXCJcIjtcbn1cbmZ1bmN0aW9uIGlzVmFsaWRJbnRlZ2VyKHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgdmFsdWUgJSAxID09PSAwO1xufVxuZnVuY3Rpb24gaXNOb3RTYW1lQ2FtZXJhKGNhbWVyYSwgY2FtZXJhMikge1xuICAgIHJldHVybiAoY2FtZXJhMiA9PT0gdW5kZWZpbmVkIHx8XG4gICAgICAgIGNhbWVyYS5wb3NpdGlvbiAhPT0gY2FtZXJhMi5wb3NpdGlvbiB8fFxuICAgICAgICBjYW1lcmEuaGVhZGluZyAhPT0gY2FtZXJhMi5oZWFkaW5nIHx8XG4gICAgICAgIGNhbWVyYS50aWx0ICE9PSBjYW1lcmEyLnRpbHQpO1xufVxuZnVuY3Rpb24gaXNOb3RTYW1lRW52aXJvbm1lbnQoZW52aXJvbm1lbnQsIGVudmlyb25tZW50Mikge1xuICAgIHJldHVybiAoZW52aXJvbm1lbnQyID09PSB1bmRlZmluZWQgfHxcbiAgICAgICAgZW52aXJvbm1lbnQyLmF0bW9zcGhlcmVFbmFibGVkICE9PSBlbnZpcm9ubWVudC5hdG1vc3BoZXJlRW5hYmxlZCB8fFxuICAgICAgICBlbnZpcm9ubWVudDIubGlnaHRpbmcuZGF0ZSAhPT0gZW52aXJvbm1lbnQubGlnaHRpbmcuZGF0ZSB8fFxuICAgICAgICBlbnZpcm9ubWVudDIubGlnaHRpbmcuZGlyZWN0U2hhZG93c0VuYWJsZWQgIT09XG4gICAgICAgICAgICBlbnZpcm9ubWVudC5saWdodGluZy5kaXJlY3RTaGFkb3dzRW5hYmxlZCB8fFxuICAgICAgICBlbnZpcm9ubWVudDIubGlnaHRpbmcuY2FtZXJhVHJhY2tpbmdFbmFibGVkICE9PVxuICAgICAgICAgICAgZW52aXJvbm1lbnQubGlnaHRpbmcuY2FtZXJhVHJhY2tpbmdFbmFibGVkIHx8XG4gICAgICAgIGVudmlyb25tZW50Mi5saWdodGluZy5kYXRlICE9PSBlbnZpcm9ubWVudC5saWdodGluZy5kYXRlIHx8XG4gICAgICAgIGVudmlyb25tZW50Mi5saWdodGluZy5kaXNwbGF5VVRDT2Zmc2V0ICE9PVxuICAgICAgICAgICAgZW52aXJvbm1lbnQubGlnaHRpbmcuZGlzcGxheVVUQ09mZnNldCk7XG59XG5mdW5jdGlvbiBpc05vdFNhbWVWaWV3cG9pbnQodmlld3BvaW50LCB2aWV3cG9pbnQyKSB7XG4gICAgcmV0dXJuICh2aWV3cG9pbnQyID09PSB1bmRlZmluZWQgfHxcbiAgICAgICAgdmlld3BvaW50LnRhcmdldEdlb21ldHJ5ICE9PSB2aWV3cG9pbnQyLnRhcmdldEdlb21ldHJ5IHx8XG4gICAgICAgIHZpZXdwb2ludC5yb3RhdGlvbiAhPT0gdmlld3BvaW50Mi5yb3RhdGlvbiB8fFxuICAgICAgICB2aWV3cG9pbnQuc2NhbGUgIT09IHZpZXdwb2ludDIuc2NhbGUpO1xufVxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlRm9yVmlldyh2aWV3U3RyKSB7XG4gICAgY29uc3Qgdmlld1JlZiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iodmlld1N0cik7XG4gICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAgIGlmICh2aWV3UmVmPy52aWV3ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJlc29sdmUodmlld1JlZi52aWV3KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh2aWV3UmVmKSB7XG4gICAgICAgICAgICBjb25zdCBoYW5kbGVyID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZpZXdSZWYucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImFyY2dpc1ZpZXdSZWFkeUNoYW5nZVwiLCBoYW5kbGVyLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh2aWV3UmVmLnZpZXcpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZpZXdSZWYuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1ZpZXdSZWFkeUNoYW5nZVwiLCBoYW5kbGVyLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHJlZmVyZW5jZUVsZW1lbnRIZWxwZXIoZWxlbWVudCwgcmVmRWxlbWVudCkge1xuICAgIGlmIChyZWZFbGVtZW50ID09PSB1bmRlZmluZWQpXG4gICAgICAgIHJldHVybjtcbiAgICBlbHNlIGlmICh0eXBlb2YgcmVmRWxlbWVudCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICBlbGVtZW50LnZpZXcgPSBhd2FpdCB1cGRhdGVGb3JWaWV3KHJlZkVsZW1lbnQpO1xuICAgIH1cbiAgICBlbHNlIGlmIChlbGVtZW50LndpZGdldCkge1xuICAgICAgICBlbGVtZW50LnZpZXcgPSByZWZFbGVtZW50LnZpZXc7XG4gICAgfVxufVxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy9cbi8vICBQcml2YXRlIE1ldGhvZHNcbi8vXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5mdW5jdGlvbiB3YWl0Rm9yVmlld0hhbmRsZXIodmlld1JlZiwgZWxlbWVudCwgaXNVc2luZ1JlZmVybmNlRWxlbWVudCkge1xuICAgIGNvbnN0IGhhbmRsZXIgPSAoKSA9PiB7XG4gICAgICAgIHZpZXdSZWYucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImFyY2dpc1ZpZXdSZWFkeUNoYW5nZVwiLCBoYW5kbGVyLCBmYWxzZSk7XG4gICAgICAgIGVsZW1lbnQudmlldyA9IHZpZXdSZWYudmlldztcbiAgICAgICAgaWYgKCFpc1VzaW5nUmVmZXJuY2VFbGVtZW50KSB7XG4gICAgICAgICAgICBlbGVtZW50LnZpZXcudWkuYWRkKGVsZW1lbnQuY2hpbGRFbGVtID8/IGVsZW1lbnQuZWwsIGVsZW1lbnQucG9zaXRpb24pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICB2aWV3UmVmLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNWaWV3UmVhZHlDaGFuZ2VcIiwgaGFuZGxlciwgZmFsc2UpO1xufVxuXG5leHBvcnQgeyBhZGRIYW5kbGVzIGFzIGEsIGlzTm90U2FtZVZpZXdwb2ludCBhcyBiLCBjaGVja0ZvclZpZXcgYXMgYywgY2hlY2tGb3JFeHBhbmQgYXMgZCwgaXNOb3RTYW1lQ2FtZXJhIGFzIGUsIGlzTm90U2FtZUVudmlyb25tZW50IGFzIGYsIGlzVmFsaWRJbnRlZ2VyIGFzIGcsIGlzTnVsbE9yRW1wdHlTdHJpbmcgYXMgaSwgcmVmZXJlbmNlRWxlbWVudEhlbHBlciBhcyByIH07XG4iLCIvKiFcbiAqIEFsbCBtYXRlcmlhbCBjb3B5cmlnaHQgRXNyaSwgQWxsIFJpZ2h0cyBSZXNlcnZlZCwgdW5sZXNzIG90aGVyd2lzZSBzcGVjaWZpZWQuXG4gKiBTZWUgaHR0cHM6Ly9qcy5hcmNnaXMuY29tLzQuMzAvZXNyaS9jb3B5cmlnaHQudHh0IGZvciBkZXRhaWxzLlxuICogdjQuMzAuMC1uZXh0LjM3XG4gKi9cbmZ1bmN0aW9uIG9uRGlzY29ubmVjdGVkSGVscGVyKGVsZW1lbnQpIHtcbiAgICBpZiAoZWxlbWVudC5jaGlsZEVsZW0pIHtcbiAgICAgICAgaWYgKCFlbGVtZW50LmVsLmlzQ29ubmVjdGVkKSB7XG4gICAgICAgICAgICBpZiAoZWxlbWVudC52aWV3KSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC52aWV3LnVpLnJlbW92ZShlbGVtZW50LmNoaWxkRWxlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChlbGVtZW50LndpZGdldD8udmlldykge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQud2lkZ2V0LnZpZXcudWkucmVtb3ZlKGVsZW1lbnQuY2hpbGRFbGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlbGVtZW50Ll93YXRjaEhhbmRsZXMpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50Ll93YXRjaEhhbmRsZXMuZm9yRWFjaCgoaGFuZGxlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsZW1lbnQuX3dhdGNoSGFuZGxlcyA9IFtdO1xuICAgICAgICAgICAgZWxlbWVudC53aWRnZXQ/LmRlc3Ryb3koKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWVsZW1lbnQuZWwuaXNDb25uZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC52aWV3KSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudmlldy51aS5yZW1vdmUoZWxlbWVudC5lbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGVsZW1lbnQud2lkZ2V0Py52aWV3KSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQud2lkZ2V0LnZpZXcudWkucmVtb3ZlKGVsZW1lbnQuZWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudC5fd2F0Y2hIYW5kbGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuX3dhdGNoSGFuZGxlcy5mb3JFYWNoKChoYW5kbGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsZW1lbnQuX3dhdGNoSGFuZGxlcyA9IFtdO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQud2lkZ2V0Py5kZXN0cm95KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIDEwMDApO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgb25EaXNjb25uZWN0ZWRIZWxwZXIgYXMgbyB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9