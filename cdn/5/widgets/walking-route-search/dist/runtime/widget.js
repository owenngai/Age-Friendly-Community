System.register(["jimu-core/react","jimu-arcgis","esri/Graphic","esri/geometry/geometryEngine.js"],(function(e,t){var o={},n={},r={},l={};return{setters:[function(e){o.default=e.default,o.useEffect=e.useEffect,o.useState=e.useState},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent},function(e){r.default=e.default},function(e){l.geodesicBuffer=e.geodesicBuffer}],execute:function(){e((()=>{var e={470:e=>{"use strict";e.exports=r},431:e=>{"use strict";e.exports=l},686:e=>{"use strict";e.exports=n},972:e=>{"use strict";e.exports=o}},t={};function i(o){var n=t[o];if(void 0!==n)return n.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,i),r.exports}i.d=(e,t)=>{for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="";var u={};return i.p=window.jimuConfig.baseUrl,(()=>{"use strict";i.r(u),i.d(u,{__set_webpack_public_path__:()=>s,default:()=>l});var e=i(972),t=i(686),o=i(470),n=i(431),r=function(e,t,o,n){return new(o||(o=Promise))((function(r,l){function i(e){try{s(n.next(e))}catch(e){l(e)}}function u(e){try{s(n.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,u)}s((n=n.apply(e,t||[])).next())}))};function l(l){var i;const[u,s]=(0,e.useState)(null),[a,c]=(0,e.useState)(null),[d,f]=(0,e.useState)(null),[p,g]=(0,e.useState)(null),m=e.default.useRef(0),v="AAPTxy8BH1VEsoebNVZXo8HurEE5qod6fdFwn9Z7joZ1eU80Mpc1ZKKX4XFEXSZaqSdDcuX8887vxtDuaaH8KlFJ9A_NozBe01ZqM_KHeQyl6Ol7LaPaHAx5_g-NxaYoLvfo8FDiX3D2UQ_VGPMBYYlxd-NJu71ajh9hhTV9iedP2hyvYZb5oq1PdFEYJwfzN_zWXj_-XawgqAf-eWPEt_8dnR1WNKoQMfp8M06F1MGLX4s.AT1_Fa9PuOBU";(0,e.useEffect)((()=>{u&&!p&&(console.log("set up graphics layer..."),g(u.view.graphics))}),[u,p]),(0,e.useEffect)((()=>{u&&(console.log("Map view is available"),u.view.on("click",y))}),[p]),(0,e.useEffect)((()=>{a&&d&&(console.log("Routing from",a,"to",d),h(a,d))}),[a,d]);const y=e=>{const{mapPoint:t}=e;if(console.log(e),0===m.current){c(null),f(null),console.log("Start point selected:",t);const e=new o.default({geometry:{type:"point",longitude:t.longitude,latitude:t.latitude},symbol:{type:"simple-marker",color:[0,255,255,1],size:"10px"}});null==p||p.add(e),c(t),m.current=1}else if(1===m.current){console.log("End point selected:",t);const e=new o.default({geometry:{type:"point",longitude:t.longitude,latitude:t.latitude},symbol:{type:"simple-marker",color:[0,255,255,1],size:"10px"}});null==p||p.add(e),f(t),m.current=0}},h=(e,t)=>r(this,void 0,void 0,(function*(){(function(e,t){return r(this,void 0,void 0,(function*(){console.log("Fetching route from Esri API...");const o=yield function(){return r(this,void 0,void 0,(function*(){console.log("call Retrieve Travel Modes...");const e="https://route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World/retrieveTravelModes",t=new URLSearchParams({f:"json",token:v});try{const o=yield fetch(`${e}?${t}`),n=yield o.json();if(n)return n;console.error("No route found:",n.messages)}catch(e){console.error("Error travel modes:",e)}}))}(),{supportedTravelModes:n}=o,l=n.find((({name:e})=>"Walking Distance"===e));console.log(o.supportedTravelModes),console.log(l),console.log(e,t);const i="https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World/solve",u=new URLSearchParams({f:"json",token:v,stops:`${e.longitude},${e.latitude};${t.longitude},${t.latitude}`,returnDirections:"true",travelMode:l});try{const e=yield fetch(`${i}?${u}`),t=yield e.json();if(t.routes)return t;console.error("No route found:",t.messages)}catch(e){console.error("Error fetching route:",e)}}))})(e,t).then((e=>{e&&(console.log("Route geometry:",e),function(e,t){if(e&&e.routes.features[0].geometry.paths.length>0){console.log("looping through route features",e.routes.features[0].geometry.paths),console.log("route",JSON.stringify(e.routes.features[0].geometry.paths[0]));const t=new o.default({geometry:{type:"polyline",paths:e.routes.features[0].geometry.paths[0]},symbol:{type:"simple-line",color:[255,255,0,1],width:3}});p.add(t),function(e){r(this,void 0,void 0,(function*(){console.log("getting route buffer...");const t=n.geodesicBuffer(e.geometry,50,"meters"),r=new o.default({geometry:t,symbol:{type:"simple-fill",color:[0,255,255,.25],outline:{color:[0,255,255,.5],width:1}}});p.add(r)}))}(t)}else console.error("No route features available to display.")}(e,u.view))}))}));return e.default.createElement("div",{className:"walking-route-widget"},e.default.createElement("h5",null,"Walking Route Finder"),e.default.createElement("p",null,"Click on the map to select a start and end point.",e.default.createElement("br",null),"start point: ",null==a?void 0:a.longitude.toFixed(5),", ",null==a?void 0:a.latitude.toFixed(5)," end point: ",null==d?void 0:d.longitude.toFixed(5),", ",null==d?void 0:d.latitude.toFixed(5)),e.default.createElement("button",{onClick:()=>{c(null),f(null),p.removeAll(),m.current=0}},"Reset Points"),e.default.createElement(t.JimuMapViewComponent,{useMapWidgetId:null===(i=l.useMapWidgetIds)||void 0===i?void 0:i[0],onActiveViewChange:e=>{s(e)}}))}function s(e){i.p=e}})(),u})())}}}));