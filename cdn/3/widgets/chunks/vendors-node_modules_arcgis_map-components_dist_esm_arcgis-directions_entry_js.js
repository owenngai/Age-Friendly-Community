"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-node_modules_arcgis_map-components_dist_esm_arcgis-directions_entry_js"],{

/***/ "./node_modules/@arcgis/map-components/dist/esm/arcgis-directions.entry.js":
/*!*********************************************************************************!*\
  !*** ./node_modules/@arcgis/map-components/dist/esm/arcgis-directions.entry.js ***!
  \*********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   arcgis_directions: () => (/* binding */ ArcgisDirections)
/* harmony export */ });
/* harmony import */ var _index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index-6e172aac.js */ "./node_modules/@arcgis/map-components/dist/esm/index-6e172aac.js");
/* harmony import */ var _index_0bc55ca5_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./index-0bc55ca5.js */ "./node_modules/@arcgis/map-components/dist/esm/index-0bc55ca5.js");
/* harmony import */ var _component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./component-utils-23194f7c.js */ "./node_modules/@arcgis/map-components/dist/esm/component-utils-23194f7c.js");
/* harmony import */ var _disconnected_6cf1c100_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./disconnected-6cf1c100.js */ "./node_modules/@arcgis/map-components/dist/esm/disconnected-6cf1c100.js");
/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.30/esri/copyright.txt for details.
 * v4.30.0-next.37
 */





const directionsCss = "";

const loggerName = "map-components:arcgis-directions";
const ArcgisDirections = class {
    constructor(hostRef) {
        (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.r)(this, hostRef);
        this.arcgisDirectionsReady = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisDirectionsReady", 7);
        this.arcgisPropertyChange = (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.c)(this, "arcgisPropertyChange", 7);
        this._watchHandles = [];
        this.referenceElement = undefined;
        this.apiKey = undefined;
        this.icon = undefined;
        this.routeLayerItemId = undefined;
        this.lastRoute = undefined;
        this.layer = undefined;
        this.maxStops = 50;
        this.searchProperties = undefined;
        this.unit = undefined;
        this.useDefaultRouteLayer = true;
        this.visibleElementsLayerDetails = true;
        this.visibleElementsSaveAsButton = true;
        this.visibleElementsSaveButton = true;
        this.position = "bottom-left";
        this.view = undefined;
        this.widget = undefined;
    }
    referenceElementWatcher(value) {
        void (0,_component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__.r)(this, value);
    }
    apiKeyWatcher(value) {
        if (value && this.widget) {
            this.widget.apiKey = value;
        }
    }
    iconWatcher(value) {
        if (value && this.widget) {
            this.widget.icon = value;
        }
    }
    routeLayerItemIdWatcher(value) {
        if ((0,_component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__.i)(value)) {
            this.view?.map.remove(this.layer);
            // maintain a default route layer
            if (this.useDefaultRouteLayer) {
                void (0,_index_0bc55ca5_js__WEBPACK_IMPORTED_MODULE_1__.r)({}).then((layer) => {
                    this.layer = layer;
                });
            }
        }
        else if (value && this.widget) {
            void (0,_index_0bc55ca5_js__WEBPACK_IMPORTED_MODULE_1__.r)({
                portalItem: {
                    id: value,
                },
            }).then((layer) => {
                this.layer = layer;
            });
        }
    }
    layerWatcher(value) {
        if (this.widget) {
            this.widget.layer = value ?? null;
        }
    }
    maxStopsWatcher(value) {
        if (value !== undefined && this.widget) {
            this.widget.maxStops = value;
        }
    }
    searchPropertiesWatcher(value) {
        if (this.widget) {
            this.widget.searchProperties = value;
        }
    }
    unitWatcher(value) {
        if (this.widget) {
            this.widget.unit = value;
        }
    }
    visibleElementsLayerDetailsWatcher(value) {
        if (this.widget) {
            this.widget.visibleElements = {
                ...this.widget.visibleElements,
                layerDetails: value,
            };
        }
    }
    visibleElementsSaveAsButtonWatcher(value) {
        if (this.widget) {
            this.widget.visibleElements = {
                ...this.widget.visibleElements,
                saveAsButton: value,
            };
        }
    }
    visibleElementsSaveButtonWatcher(value) {
        if (this.widget) {
            this.widget.visibleElements = {
                ...this.widget.visibleElements,
                saveButton: value,
            };
        }
    }
    positionWatcher(value) {
        if (value !== undefined && this.widget) {
            this.view.ui.move(this.childElem, value);
        }
    }
    viewWatcher(value) {
        if (value !== undefined && this.widget) {
            this.widget.view = value;
        }
    }
    //--------------------------------------------------------------------------
    //
    //  Methods
    //
    //--------------------------------------------------------------------------
    async getDirections() {
        if (this.widget?.viewModel?.state !== "ready") {
            throw new Error(`${loggerName} - component not ready to get directions`);
        }
        return await this.widget?.getDirections();
    }
    async save() {
        if (this.widget?.viewModel?.state !== "ready") {
            throw new Error(`${loggerName} - component not ready to save directions`);
        }
        return await this.widget?.save();
    }
    async saveAs(portalItem, options) {
        if (this.widget?.viewModel?.state !== "ready") {
            throw new Error(`${loggerName} - component not ready to save directions as a Portal Item`);
        }
        return await this.widget?.saveAs(portalItem, options);
    }
    async zoomToRoute() {
        if (this.widget?.viewModel?.state !== "ready") {
            throw new Error(`${loggerName} - component not ready to zoom to route`);
        }
        this.widget?.zoomToRoute();
    }
    //--------------------------------------------------------------------------
    //
    //  Lifecycle
    //
    //--------------------------------------------------------------------------
    async componentDidLoad() {
        const params = await this._createParams();
        const widget = await (0,_index_0bc55ca5_js__WEBPACK_IMPORTED_MODULE_1__.s)(params);
        this.widget = widget;
        await this._addWatchers();
        this._addContainer();
        this.arcgisDirectionsReady.emit();
        (0,_component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__.c)(this);
    }
    disconnectedCallback() {
        (0,_disconnected_6cf1c100_js__WEBPACK_IMPORTED_MODULE_3__.o)(this);
    }
    render() {
        return (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.h)("div", { ref: (el) => (this.childElem = el) });
    }
    //--------------------------------------------------------------------------
    //
    //  Private Methods
    //
    //--------------------------------------------------------------------------
    _addContainer() {
        this.widget.container = this.childElem;
    }
    async _addWatchers() {
        const { watch } = await (0,_index_0bc55ca5_js__WEBPACK_IMPORTED_MODULE_1__.i)();
        (0,_component_utils_23194f7c_js__WEBPACK_IMPORTED_MODULE_2__.a)(this, watch(() => this.widget.lastRoute, (value) => {
            this.lastRoute = value;
            this.arcgisPropertyChange.emit({ name: "lastRoute" });
        }, {
            initial: true,
        }));
    }
    async _createParams() {
        const params = {};
        params.visibleElements = {
            layerDetails: this.visibleElementsLayerDetails,
            saveAsButton: this.visibleElementsSaveAsButton,
            saveButton: this.visibleElementsSaveButton,
        };
        if (this.view) {
            params.view = this.view;
        }
        if (this.apiKey) {
            params.apiKey = this.apiKey;
        }
        if (this.icon) {
            params.icon = this.icon;
        }
        if (this.routeLayerItemId) {
            params.layer = await (0,_index_0bc55ca5_js__WEBPACK_IMPORTED_MODULE_1__.r)({
                portalItem: {
                    id: this.routeLayerItemId,
                },
            });
            this.layer = params.layer;
        }
        else if (this.layer) {
            params.layer = this.layer;
            this.layer = params.layer;
        }
        else if (this.useDefaultRouteLayer) {
            params.layer = await (0,_index_0bc55ca5_js__WEBPACK_IMPORTED_MODULE_1__.r)({});
            this.layer = params.layer;
        }
        if (this.maxStops !== undefined) {
            params.maxStops = this.maxStops;
        }
        if (this.searchProperties) {
            params.searchProperties = this.searchProperties;
        }
        if (this.unit) {
            params.unit = this.unit;
        }
        return params;
    }
    get el() { return (0,_index_6e172aac_js__WEBPACK_IMPORTED_MODULE_0__.g)(this); }
    static get watchers() { return {
        "referenceElement": ["referenceElementWatcher"],
        "apiKey": ["apiKeyWatcher"],
        "icon": ["iconWatcher"],
        "routeLayerItemId": ["routeLayerItemIdWatcher"],
        "layer": ["layerWatcher"],
        "maxStops": ["maxStopsWatcher"],
        "searchProperties": ["searchPropertiesWatcher"],
        "unit": ["unitWatcher"],
        "visibleElementsLayerDetails": ["visibleElementsLayerDetailsWatcher"],
        "visibleElementsSaveAsButton": ["visibleElementsSaveAsButtonWatcher"],
        "visibleElementsSaveButton": ["visibleElementsSaveButtonWatcher"],
        "position": ["positionWatcher"],
        "view": ["viewWatcher"]
    }; }
};
ArcgisDirections.style = directionsCss;




/***/ }),

/***/ "./node_modules/@arcgis/map-components/dist/esm/component-utils-23194f7c.js":
/*!**********************************************************************************!*\
  !*** ./node_modules/@arcgis/map-components/dist/esm/component-utils-23194f7c.js ***!
  \**********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   a: () => (/* binding */ addHandles),
/* harmony export */   b: () => (/* binding */ isNotSameViewpoint),
/* harmony export */   c: () => (/* binding */ checkForView),
/* harmony export */   d: () => (/* binding */ checkForExpand),
/* harmony export */   e: () => (/* binding */ isNotSameCamera),
/* harmony export */   f: () => (/* binding */ isNotSameEnvironment),
/* harmony export */   g: () => (/* binding */ isValidInteger),
/* harmony export */   i: () => (/* binding */ isNullOrEmptyString),
/* harmony export */   r: () => (/* binding */ referenceElementHelper)
/* harmony export */ });
/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.30/esri/copyright.txt for details.
 * v4.30.0-next.37
 */
function checkForExpand(element) {
    const expandRef = element.el.closest("arcgis-expand") ?? element.expandElem;
    if (expandRef?.widget) {
        element.view = expandRef.view;
        expandRef.widget.content = element.childElem ?? element.el;
        // TODO: Update to be expandIcon = widget.icon, not ready yet in 4.27next
        if (!expandRef.expandIcon) {
            expandRef.widget.expandIcon = element.widget ? element.widget.icon : element?.icon;
        }
        return true;
    }
    if (expandRef) {
        const widgetHandler = () => {
            expandRef.removeEventListener("arcgisExpandReady", widgetHandler, false);
            element.view = expandRef.view;
            expandRef.widget.content = element.childElem ?? element.el;
            if (!expandRef.expandIcon) {
                expandRef.widget.expandIcon = element.widget ? element.widget.icon : element?.icon;
            }
        };
        expandRef.addEventListener("arcgisExpandReady", widgetHandler, false);
        return true;
    }
    return false;
}

//--------------------------------------------------------------------------
//
//  Public Methods
//
//--------------------------------------------------------------------------
function addHandles(element, handle) {
    if (Array.isArray(handle)) {
        element._watchHandles = [...element._watchHandles, ...handle];
    }
    else {
        element._watchHandles.push(handle);
    }
}
function checkForView(element) {
    let isUsingReferenceElement = false;
    if (!checkForExpand(element)) {
        let viewRef = element.el.closest("arcgis-map") ?? element.el.closest("arcgis-scene");
        if (!viewRef && typeof element.referenceElement === "string") {
            viewRef = document.querySelector(element.referenceElement);
            isUsingReferenceElement = true;
        }
        if (viewRef?.view) {
            element.view = viewRef.view;
            const el = element.childElem ?? element.el;
            if (!isUsingReferenceElement) {
                element.view.ui.add(el, element.position);
            }
        }
        else if (viewRef) {
            waitForViewHandler(viewRef, element, isUsingReferenceElement);
        }
    }
    else {
        const viewRef = element.el.closest("arcgis-map") ?? element.el.closest("arcgis-scene");
        if (viewRef?.view) {
            element.view = viewRef.view;
        }
        else if (viewRef) {
            const handler = () => {
                viewRef.removeEventListener("arcgisViewReadyChange", handler, false);
                element.view = viewRef.view;
            };
            viewRef.addEventListener("arcgisViewReadyChange", handler, false);
        }
    }
}
function isNullOrEmptyString(value) {
    return value === undefined || value === null || value === "";
}
function isValidInteger(value) {
    return value != null && value % 1 === 0;
}
function isNotSameCamera(camera, camera2) {
    return (camera2 === undefined ||
        camera.position !== camera2.position ||
        camera.heading !== camera2.heading ||
        camera.tilt !== camera2.tilt);
}
function isNotSameEnvironment(environment, environment2) {
    return (environment2 === undefined ||
        environment2.atmosphereEnabled !== environment.atmosphereEnabled ||
        environment2.lighting.date !== environment.lighting.date ||
        environment2.lighting.directShadowsEnabled !==
            environment.lighting.directShadowsEnabled ||
        environment2.lighting.cameraTrackingEnabled !==
            environment.lighting.cameraTrackingEnabled ||
        environment2.lighting.date !== environment.lighting.date ||
        environment2.lighting.displayUTCOffset !==
            environment.lighting.displayUTCOffset);
}
function isNotSameViewpoint(viewpoint, viewpoint2) {
    return (viewpoint2 === undefined ||
        viewpoint.targetGeometry !== viewpoint2.targetGeometry ||
        viewpoint.rotation !== viewpoint2.rotation ||
        viewpoint.scale !== viewpoint2.scale);
}
async function updateForView(viewStr) {
    const viewRef = document.querySelector(viewStr);
    return await new Promise((resolve) => {
        if (viewRef?.view !== undefined) {
            resolve(viewRef.view);
        }
        else if (viewRef) {
            const handler = () => {
                viewRef.removeEventListener("arcgisViewReadyChange", handler, false);
                resolve(viewRef.view);
            };
            viewRef.addEventListener("arcgisViewReadyChange", handler, false);
        }
    });
}
async function referenceElementHelper(element, refElement) {
    if (refElement === undefined)
        return;
    else if (typeof refElement === "string") {
        element.view = await updateForView(refElement);
    }
    else if (element.widget) {
        element.view = refElement.view;
    }
}
//--------------------------------------------------------------------------
//
//  Private Methods
//
//--------------------------------------------------------------------------
function waitForViewHandler(viewRef, element, isUsingRefernceElement) {
    const handler = () => {
        viewRef.removeEventListener("arcgisViewReadyChange", handler, false);
        element.view = viewRef.view;
        if (!isUsingRefernceElement) {
            element.view.ui.add(element.childElem ?? element.el, element.position);
        }
    };
    viewRef.addEventListener("arcgisViewReadyChange", handler, false);
}




/***/ }),

/***/ "./node_modules/@arcgis/map-components/dist/esm/disconnected-6cf1c100.js":
/*!*******************************************************************************!*\
  !*** ./node_modules/@arcgis/map-components/dist/esm/disconnected-6cf1c100.js ***!
  \*******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   o: () => (/* binding */ onDisconnectedHelper)
/* harmony export */ });
/*!
 * All material copyright Esri, All Rights Reserved, unless otherwise specified.
 * See https://js.arcgis.com/4.30/esri/copyright.txt for details.
 * v4.30.0-next.37
 */
function onDisconnectedHelper(element) {
    if (element.childElem) {
        if (!element.el.isConnected) {
            if (element.view) {
                element.view.ui.remove(element.childElem);
            }
            else if (element.widget?.view) {
                element.widget.view.ui.remove(element.childElem);
            }
            if (element._watchHandles) {
                element._watchHandles.forEach((handle) => {
                    handle.remove();
                });
            }
            element._watchHandles = [];
            element.widget?.destroy();
        }
    }
    else {
        setTimeout(() => {
            if (!element.el.isConnected) {
                if (element.view) {
                    element.view.ui.remove(element.el);
                }
                else if (element.widget?.view) {
                    element.widget.view.ui.remove(element.el);
                }
                if (element._watchHandles) {
                    element._watchHandles.forEach((handle) => {
                        handle.remove();
                    });
                }
                element._watchHandles = [];
                element.widget?.destroy();
            }
        }, 1000);
    }
}




/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvdmVuZG9ycy1ub2RlX21vZHVsZXNfYXJjZ2lzX21hcC1jb21wb25lbnRzX2Rpc3RfZXNtX2FyY2dpcy1kaXJlY3Rpb25zX2VudHJ5X2pzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNrRztBQUNzQjtBQUNrQjtBQUNuRTs7QUFFdkU7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsUUFBUSxxREFBZ0I7QUFDeEIscUNBQXFDLHFEQUFXO0FBQ2hELG9DQUFvQyxxREFBVztBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsK0RBQXNCO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksK0RBQW1CO0FBQy9CO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixxREFBbUIsR0FBRztBQUMzQztBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIscURBQW1CO0FBQ3BDO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsYUFBYTtBQUNiO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixZQUFZO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsWUFBWTtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLFlBQVk7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixZQUFZO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLHFEQUFvQjtBQUNqRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsK0RBQVk7QUFDcEI7QUFDQTtBQUNBLFFBQVEsNERBQW9CO0FBQzVCO0FBQ0E7QUFDQSxlQUFlLHFEQUFDLFVBQVUsb0NBQW9DO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLFFBQVEsUUFBUSxxREFBdUI7QUFDdkQsUUFBUSwrREFBVTtBQUNsQjtBQUNBLDZDQUE2QyxtQkFBbUI7QUFDaEUsU0FBUztBQUNUO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxxREFBbUI7QUFDcEQ7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUMscURBQW1CLEdBQUc7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLE9BQU8scURBQVU7QUFDaEMsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVpRDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUMzUGpEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRXlOOzs7Ozs7Ozs7Ozs7Ozs7QUNwSnpOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVxQyIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9ub2RlX21vZHVsZXMvQGFyY2dpcy9tYXAtY29tcG9uZW50cy9kaXN0L2VzbS9hcmNnaXMtZGlyZWN0aW9ucy5lbnRyeS5qcyIsIndlYnBhY2s6Ly9leGItY2xpZW50Ly4vbm9kZV9tb2R1bGVzL0BhcmNnaXMvbWFwLWNvbXBvbmVudHMvZGlzdC9lc20vY29tcG9uZW50LXV0aWxzLTIzMTk0ZjdjLmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9ub2RlX21vZHVsZXMvQGFyY2dpcy9tYXAtY29tcG9uZW50cy9kaXN0L2VzbS9kaXNjb25uZWN0ZWQtNmNmMWMxMDAuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVzcmksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogU2VlIGh0dHBzOi8vanMuYXJjZ2lzLmNvbS80LjMwL2VzcmkvY29weXJpZ2h0LnR4dCBmb3IgZGV0YWlscy5cbiAqIHY0LjMwLjAtbmV4dC4zN1xuICovXG5pbXBvcnQgeyByIGFzIHJlZ2lzdGVySW5zdGFuY2UsIGMgYXMgY3JlYXRlRXZlbnQsIGgsIGcgYXMgZ2V0RWxlbWVudCB9IGZyb20gJy4vaW5kZXgtNmUxNzJhYWMuanMnO1xuaW1wb3J0IHsgciBhcyBuZXdMYXllcnNSb3V0ZUxheWVyLCBzIGFzIG5ld1dpZGdldHNEaXJlY3Rpb25zLCBpIGFzIGltcG9ydENvcmVSZWFjdGl2ZVV0aWxzIH0gZnJvbSAnLi9pbmRleC0wYmM1NWNhNS5qcyc7XG5pbXBvcnQgeyByIGFzIHJlZmVyZW5jZUVsZW1lbnRIZWxwZXIsIGkgYXMgaXNOdWxsT3JFbXB0eVN0cmluZywgYyBhcyBjaGVja0ZvclZpZXcsIGEgYXMgYWRkSGFuZGxlcyB9IGZyb20gJy4vY29tcG9uZW50LXV0aWxzLTIzMTk0ZjdjLmpzJztcbmltcG9ydCB7IG8gYXMgb25EaXNjb25uZWN0ZWRIZWxwZXIgfSBmcm9tICcuL2Rpc2Nvbm5lY3RlZC02Y2YxYzEwMC5qcyc7XG5cbmNvbnN0IGRpcmVjdGlvbnNDc3MgPSBcIlwiO1xuXG5jb25zdCBsb2dnZXJOYW1lID0gXCJtYXAtY29tcG9uZW50czphcmNnaXMtZGlyZWN0aW9uc1wiO1xuY29uc3QgQXJjZ2lzRGlyZWN0aW9ucyA9IGNsYXNzIHtcbiAgICBjb25zdHJ1Y3Rvcihob3N0UmVmKSB7XG4gICAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgaG9zdFJlZik7XG4gICAgICAgIHRoaXMuYXJjZ2lzRGlyZWN0aW9uc1JlYWR5ID0gY3JlYXRlRXZlbnQodGhpcywgXCJhcmNnaXNEaXJlY3Rpb25zUmVhZHlcIiwgNyk7XG4gICAgICAgIHRoaXMuYXJjZ2lzUHJvcGVydHlDaGFuZ2UgPSBjcmVhdGVFdmVudCh0aGlzLCBcImFyY2dpc1Byb3BlcnR5Q2hhbmdlXCIsIDcpO1xuICAgICAgICB0aGlzLl93YXRjaEhhbmRsZXMgPSBbXTtcbiAgICAgICAgdGhpcy5yZWZlcmVuY2VFbGVtZW50ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmFwaUtleSA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5pY29uID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnJvdXRlTGF5ZXJJdGVtSWQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMubGFzdFJvdXRlID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLmxheWVyID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm1heFN0b3BzID0gNTA7XG4gICAgICAgIHRoaXMuc2VhcmNoUHJvcGVydGllcyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy51bml0ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLnVzZURlZmF1bHRSb3V0ZUxheWVyID0gdHJ1ZTtcbiAgICAgICAgdGhpcy52aXNpYmxlRWxlbWVudHNMYXllckRldGFpbHMgPSB0cnVlO1xuICAgICAgICB0aGlzLnZpc2libGVFbGVtZW50c1NhdmVBc0J1dHRvbiA9IHRydWU7XG4gICAgICAgIHRoaXMudmlzaWJsZUVsZW1lbnRzU2F2ZUJ1dHRvbiA9IHRydWU7XG4gICAgICAgIHRoaXMucG9zaXRpb24gPSBcImJvdHRvbS1sZWZ0XCI7XG4gICAgICAgIHRoaXMudmlldyA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy53aWRnZXQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHJlZmVyZW5jZUVsZW1lbnRXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIHZvaWQgcmVmZXJlbmNlRWxlbWVudEhlbHBlcih0aGlzLCB2YWx1ZSk7XG4gICAgfVxuICAgIGFwaUtleVdhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHZhbHVlICYmIHRoaXMud2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLndpZGdldC5hcGlLZXkgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpY29uV2F0Y2hlcih2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgJiYgdGhpcy53aWRnZXQpIHtcbiAgICAgICAgICAgIHRoaXMud2lkZ2V0Lmljb24gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByb3V0ZUxheWVySXRlbUlkV2F0Y2hlcih2YWx1ZSkge1xuICAgICAgICBpZiAoaXNOdWxsT3JFbXB0eVN0cmluZyh2YWx1ZSkpIHtcbiAgICAgICAgICAgIHRoaXMudmlldz8ubWFwLnJlbW92ZSh0aGlzLmxheWVyKTtcbiAgICAgICAgICAgIC8vIG1haW50YWluIGEgZGVmYXVsdCByb3V0ZSBsYXllclxuICAgICAgICAgICAgaWYgKHRoaXMudXNlRGVmYXVsdFJvdXRlTGF5ZXIpIHtcbiAgICAgICAgICAgICAgICB2b2lkIG5ld0xheWVyc1JvdXRlTGF5ZXIoe30pLnRoZW4oKGxheWVyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGF5ZXIgPSBsYXllcjtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh2YWx1ZSAmJiB0aGlzLndpZGdldCkge1xuICAgICAgICAgICAgdm9pZCBuZXdMYXllcnNSb3V0ZUxheWVyKHtcbiAgICAgICAgICAgICAgICBwb3J0YWxJdGVtOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSkudGhlbigobGF5ZXIpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmxheWVyID0gbGF5ZXI7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBsYXllcldhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMud2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLndpZGdldC5sYXllciA9IHZhbHVlID8/IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbWF4U3RvcHNXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMud2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLndpZGdldC5tYXhTdG9wcyA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNlYXJjaFByb3BlcnRpZXNXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLndpZGdldCkge1xuICAgICAgICAgICAgdGhpcy53aWRnZXQuc2VhcmNoUHJvcGVydGllcyA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVuaXRXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLndpZGdldCkge1xuICAgICAgICAgICAgdGhpcy53aWRnZXQudW5pdCA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHZpc2libGVFbGVtZW50c0xheWVyRGV0YWlsc1dhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMud2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLndpZGdldC52aXNpYmxlRWxlbWVudHMgPSB7XG4gICAgICAgICAgICAgICAgLi4udGhpcy53aWRnZXQudmlzaWJsZUVsZW1lbnRzLFxuICAgICAgICAgICAgICAgIGxheWVyRGV0YWlsczogdmFsdWUsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxuICAgIHZpc2libGVFbGVtZW50c1NhdmVBc0J1dHRvbldhdGNoZXIodmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMud2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLndpZGdldC52aXNpYmxlRWxlbWVudHMgPSB7XG4gICAgICAgICAgICAgICAgLi4udGhpcy53aWRnZXQudmlzaWJsZUVsZW1lbnRzLFxuICAgICAgICAgICAgICAgIHNhdmVBc0J1dHRvbjogdmFsdWUsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxuICAgIHZpc2libGVFbGVtZW50c1NhdmVCdXR0b25XYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh0aGlzLndpZGdldCkge1xuICAgICAgICAgICAgdGhpcy53aWRnZXQudmlzaWJsZUVsZW1lbnRzID0ge1xuICAgICAgICAgICAgICAgIC4uLnRoaXMud2lkZ2V0LnZpc2libGVFbGVtZW50cyxcbiAgICAgICAgICAgICAgICBzYXZlQnV0dG9uOiB2YWx1ZSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcG9zaXRpb25XYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMud2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLnZpZXcudWkubW92ZSh0aGlzLmNoaWxkRWxlbSwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHZpZXdXYXRjaGVyKHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMud2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLndpZGdldC52aWV3ID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIE1ldGhvZHNcbiAgICAvL1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBhc3luYyBnZXREaXJlY3Rpb25zKCkge1xuICAgICAgICBpZiAodGhpcy53aWRnZXQ/LnZpZXdNb2RlbD8uc3RhdGUgIT09IFwicmVhZHlcIikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke2xvZ2dlck5hbWV9IC0gY29tcG9uZW50IG5vdCByZWFkeSB0byBnZXQgZGlyZWN0aW9uc2ApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLndpZGdldD8uZ2V0RGlyZWN0aW9ucygpO1xuICAgIH1cbiAgICBhc3luYyBzYXZlKCkge1xuICAgICAgICBpZiAodGhpcy53aWRnZXQ/LnZpZXdNb2RlbD8uc3RhdGUgIT09IFwicmVhZHlcIikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke2xvZ2dlck5hbWV9IC0gY29tcG9uZW50IG5vdCByZWFkeSB0byBzYXZlIGRpcmVjdGlvbnNgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy53aWRnZXQ/LnNhdmUoKTtcbiAgICB9XG4gICAgYXN5bmMgc2F2ZUFzKHBvcnRhbEl0ZW0sIG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKHRoaXMud2lkZ2V0Py52aWV3TW9kZWw/LnN0YXRlICE9PSBcInJlYWR5XCIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgJHtsb2dnZXJOYW1lfSAtIGNvbXBvbmVudCBub3QgcmVhZHkgdG8gc2F2ZSBkaXJlY3Rpb25zIGFzIGEgUG9ydGFsIEl0ZW1gKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy53aWRnZXQ/LnNhdmVBcyhwb3J0YWxJdGVtLCBvcHRpb25zKTtcbiAgICB9XG4gICAgYXN5bmMgem9vbVRvUm91dGUoKSB7XG4gICAgICAgIGlmICh0aGlzLndpZGdldD8udmlld01vZGVsPy5zdGF0ZSAhPT0gXCJyZWFkeVwiKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7bG9nZ2VyTmFtZX0gLSBjb21wb25lbnQgbm90IHJlYWR5IHRvIHpvb20gdG8gcm91dGVgKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLndpZGdldD8uem9vbVRvUm91dGUoKTtcbiAgICB9XG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vXG4gICAgLy8gIExpZmVjeWNsZVxuICAgIC8vXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGFzeW5jIGNvbXBvbmVudERpZExvYWQoKSB7XG4gICAgICAgIGNvbnN0IHBhcmFtcyA9IGF3YWl0IHRoaXMuX2NyZWF0ZVBhcmFtcygpO1xuICAgICAgICBjb25zdCB3aWRnZXQgPSBhd2FpdCBuZXdXaWRnZXRzRGlyZWN0aW9ucyhwYXJhbXMpO1xuICAgICAgICB0aGlzLndpZGdldCA9IHdpZGdldDtcbiAgICAgICAgYXdhaXQgdGhpcy5fYWRkV2F0Y2hlcnMoKTtcbiAgICAgICAgdGhpcy5fYWRkQ29udGFpbmVyKCk7XG4gICAgICAgIHRoaXMuYXJjZ2lzRGlyZWN0aW9uc1JlYWR5LmVtaXQoKTtcbiAgICAgICAgY2hlY2tGb3JWaWV3KHRoaXMpO1xuICAgIH1cbiAgICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICAgICAgb25EaXNjb25uZWN0ZWRIZWxwZXIodGhpcyk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIGgoXCJkaXZcIiwgeyByZWY6IChlbCkgPT4gKHRoaXMuY2hpbGRFbGVtID0gZWwpIH0pO1xuICAgIH1cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy9cbiAgICAvLyAgUHJpdmF0ZSBNZXRob2RzXG4gICAgLy9cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgX2FkZENvbnRhaW5lcigpIHtcbiAgICAgICAgdGhpcy53aWRnZXQuY29udGFpbmVyID0gdGhpcy5jaGlsZEVsZW07XG4gICAgfVxuICAgIGFzeW5jIF9hZGRXYXRjaGVycygpIHtcbiAgICAgICAgY29uc3QgeyB3YXRjaCB9ID0gYXdhaXQgaW1wb3J0Q29yZVJlYWN0aXZlVXRpbHMoKTtcbiAgICAgICAgYWRkSGFuZGxlcyh0aGlzLCB3YXRjaCgoKSA9PiB0aGlzLndpZGdldC5sYXN0Um91dGUsICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5sYXN0Um91dGUgPSB2YWx1ZTtcbiAgICAgICAgICAgIHRoaXMuYXJjZ2lzUHJvcGVydHlDaGFuZ2UuZW1pdCh7IG5hbWU6IFwibGFzdFJvdXRlXCIgfSk7XG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIGluaXRpYWw6IHRydWUsXG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgYXN5bmMgX2NyZWF0ZVBhcmFtcygpIHtcbiAgICAgICAgY29uc3QgcGFyYW1zID0ge307XG4gICAgICAgIHBhcmFtcy52aXNpYmxlRWxlbWVudHMgPSB7XG4gICAgICAgICAgICBsYXllckRldGFpbHM6IHRoaXMudmlzaWJsZUVsZW1lbnRzTGF5ZXJEZXRhaWxzLFxuICAgICAgICAgICAgc2F2ZUFzQnV0dG9uOiB0aGlzLnZpc2libGVFbGVtZW50c1NhdmVBc0J1dHRvbixcbiAgICAgICAgICAgIHNhdmVCdXR0b246IHRoaXMudmlzaWJsZUVsZW1lbnRzU2F2ZUJ1dHRvbixcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHRoaXMudmlldykge1xuICAgICAgICAgICAgcGFyYW1zLnZpZXcgPSB0aGlzLnZpZXc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuYXBpS2V5KSB7XG4gICAgICAgICAgICBwYXJhbXMuYXBpS2V5ID0gdGhpcy5hcGlLZXk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaWNvbikge1xuICAgICAgICAgICAgcGFyYW1zLmljb24gPSB0aGlzLmljb247XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucm91dGVMYXllckl0ZW1JZCkge1xuICAgICAgICAgICAgcGFyYW1zLmxheWVyID0gYXdhaXQgbmV3TGF5ZXJzUm91dGVMYXllcih7XG4gICAgICAgICAgICAgICAgcG9ydGFsSXRlbToge1xuICAgICAgICAgICAgICAgICAgICBpZDogdGhpcy5yb3V0ZUxheWVySXRlbUlkLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMubGF5ZXIgPSBwYXJhbXMubGF5ZXI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5sYXllcikge1xuICAgICAgICAgICAgcGFyYW1zLmxheWVyID0gdGhpcy5sYXllcjtcbiAgICAgICAgICAgIHRoaXMubGF5ZXIgPSBwYXJhbXMubGF5ZXI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy51c2VEZWZhdWx0Um91dGVMYXllcikge1xuICAgICAgICAgICAgcGFyYW1zLmxheWVyID0gYXdhaXQgbmV3TGF5ZXJzUm91dGVMYXllcih7fSk7XG4gICAgICAgICAgICB0aGlzLmxheWVyID0gcGFyYW1zLmxheWVyO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm1heFN0b3BzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHBhcmFtcy5tYXhTdG9wcyA9IHRoaXMubWF4U3RvcHM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2VhcmNoUHJvcGVydGllcykge1xuICAgICAgICAgICAgcGFyYW1zLnNlYXJjaFByb3BlcnRpZXMgPSB0aGlzLnNlYXJjaFByb3BlcnRpZXM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMudW5pdCkge1xuICAgICAgICAgICAgcGFyYW1zLnVuaXQgPSB0aGlzLnVuaXQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBhcmFtcztcbiAgICB9XG4gICAgZ2V0IGVsKCkgeyByZXR1cm4gZ2V0RWxlbWVudCh0aGlzKTsgfVxuICAgIHN0YXRpYyBnZXQgd2F0Y2hlcnMoKSB7IHJldHVybiB7XG4gICAgICAgIFwicmVmZXJlbmNlRWxlbWVudFwiOiBbXCJyZWZlcmVuY2VFbGVtZW50V2F0Y2hlclwiXSxcbiAgICAgICAgXCJhcGlLZXlcIjogW1wiYXBpS2V5V2F0Y2hlclwiXSxcbiAgICAgICAgXCJpY29uXCI6IFtcImljb25XYXRjaGVyXCJdLFxuICAgICAgICBcInJvdXRlTGF5ZXJJdGVtSWRcIjogW1wicm91dGVMYXllckl0ZW1JZFdhdGNoZXJcIl0sXG4gICAgICAgIFwibGF5ZXJcIjogW1wibGF5ZXJXYXRjaGVyXCJdLFxuICAgICAgICBcIm1heFN0b3BzXCI6IFtcIm1heFN0b3BzV2F0Y2hlclwiXSxcbiAgICAgICAgXCJzZWFyY2hQcm9wZXJ0aWVzXCI6IFtcInNlYXJjaFByb3BlcnRpZXNXYXRjaGVyXCJdLFxuICAgICAgICBcInVuaXRcIjogW1widW5pdFdhdGNoZXJcIl0sXG4gICAgICAgIFwidmlzaWJsZUVsZW1lbnRzTGF5ZXJEZXRhaWxzXCI6IFtcInZpc2libGVFbGVtZW50c0xheWVyRGV0YWlsc1dhdGNoZXJcIl0sXG4gICAgICAgIFwidmlzaWJsZUVsZW1lbnRzU2F2ZUFzQnV0dG9uXCI6IFtcInZpc2libGVFbGVtZW50c1NhdmVBc0J1dHRvbldhdGNoZXJcIl0sXG4gICAgICAgIFwidmlzaWJsZUVsZW1lbnRzU2F2ZUJ1dHRvblwiOiBbXCJ2aXNpYmxlRWxlbWVudHNTYXZlQnV0dG9uV2F0Y2hlclwiXSxcbiAgICAgICAgXCJwb3NpdGlvblwiOiBbXCJwb3NpdGlvbldhdGNoZXJcIl0sXG4gICAgICAgIFwidmlld1wiOiBbXCJ2aWV3V2F0Y2hlclwiXVxuICAgIH07IH1cbn07XG5BcmNnaXNEaXJlY3Rpb25zLnN0eWxlID0gZGlyZWN0aW9uc0NzcztcblxuZXhwb3J0IHsgQXJjZ2lzRGlyZWN0aW9ucyBhcyBhcmNnaXNfZGlyZWN0aW9ucyB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVzcmksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogU2VlIGh0dHBzOi8vanMuYXJjZ2lzLmNvbS80LjMwL2VzcmkvY29weXJpZ2h0LnR4dCBmb3IgZGV0YWlscy5cbiAqIHY0LjMwLjAtbmV4dC4zN1xuICovXG5mdW5jdGlvbiBjaGVja0ZvckV4cGFuZChlbGVtZW50KSB7XG4gICAgY29uc3QgZXhwYW5kUmVmID0gZWxlbWVudC5lbC5jbG9zZXN0KFwiYXJjZ2lzLWV4cGFuZFwiKSA/PyBlbGVtZW50LmV4cGFuZEVsZW07XG4gICAgaWYgKGV4cGFuZFJlZj8ud2lkZ2V0KSB7XG4gICAgICAgIGVsZW1lbnQudmlldyA9IGV4cGFuZFJlZi52aWV3O1xuICAgICAgICBleHBhbmRSZWYud2lkZ2V0LmNvbnRlbnQgPSBlbGVtZW50LmNoaWxkRWxlbSA/PyBlbGVtZW50LmVsO1xuICAgICAgICAvLyBUT0RPOiBVcGRhdGUgdG8gYmUgZXhwYW5kSWNvbiA9IHdpZGdldC5pY29uLCBub3QgcmVhZHkgeWV0IGluIDQuMjduZXh0XG4gICAgICAgIGlmICghZXhwYW5kUmVmLmV4cGFuZEljb24pIHtcbiAgICAgICAgICAgIGV4cGFuZFJlZi53aWRnZXQuZXhwYW5kSWNvbiA9IGVsZW1lbnQud2lkZ2V0ID8gZWxlbWVudC53aWRnZXQuaWNvbiA6IGVsZW1lbnQ/Lmljb247XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChleHBhbmRSZWYpIHtcbiAgICAgICAgY29uc3Qgd2lkZ2V0SGFuZGxlciA9ICgpID0+IHtcbiAgICAgICAgICAgIGV4cGFuZFJlZi5yZW1vdmVFdmVudExpc3RlbmVyKFwiYXJjZ2lzRXhwYW5kUmVhZHlcIiwgd2lkZ2V0SGFuZGxlciwgZmFsc2UpO1xuICAgICAgICAgICAgZWxlbWVudC52aWV3ID0gZXhwYW5kUmVmLnZpZXc7XG4gICAgICAgICAgICBleHBhbmRSZWYud2lkZ2V0LmNvbnRlbnQgPSBlbGVtZW50LmNoaWxkRWxlbSA/PyBlbGVtZW50LmVsO1xuICAgICAgICAgICAgaWYgKCFleHBhbmRSZWYuZXhwYW5kSWNvbikge1xuICAgICAgICAgICAgICAgIGV4cGFuZFJlZi53aWRnZXQuZXhwYW5kSWNvbiA9IGVsZW1lbnQud2lkZ2V0ID8gZWxlbWVudC53aWRnZXQuaWNvbiA6IGVsZW1lbnQ/Lmljb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGV4cGFuZFJlZi5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzRXhwYW5kUmVhZHlcIiwgd2lkZ2V0SGFuZGxlciwgZmFsc2UpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vL1xuLy8gIFB1YmxpYyBNZXRob2RzXG4vL1xuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZnVuY3Rpb24gYWRkSGFuZGxlcyhlbGVtZW50LCBoYW5kbGUpIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShoYW5kbGUpKSB7XG4gICAgICAgIGVsZW1lbnQuX3dhdGNoSGFuZGxlcyA9IFsuLi5lbGVtZW50Ll93YXRjaEhhbmRsZXMsIC4uLmhhbmRsZV07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBlbGVtZW50Ll93YXRjaEhhbmRsZXMucHVzaChoYW5kbGUpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGNoZWNrRm9yVmlldyhlbGVtZW50KSB7XG4gICAgbGV0IGlzVXNpbmdSZWZlcmVuY2VFbGVtZW50ID0gZmFsc2U7XG4gICAgaWYgKCFjaGVja0ZvckV4cGFuZChlbGVtZW50KSkge1xuICAgICAgICBsZXQgdmlld1JlZiA9IGVsZW1lbnQuZWwuY2xvc2VzdChcImFyY2dpcy1tYXBcIikgPz8gZWxlbWVudC5lbC5jbG9zZXN0KFwiYXJjZ2lzLXNjZW5lXCIpO1xuICAgICAgICBpZiAoIXZpZXdSZWYgJiYgdHlwZW9mIGVsZW1lbnQucmVmZXJlbmNlRWxlbWVudCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgdmlld1JlZiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWxlbWVudC5yZWZlcmVuY2VFbGVtZW50KTtcbiAgICAgICAgICAgIGlzVXNpbmdSZWZlcmVuY2VFbGVtZW50ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodmlld1JlZj8udmlldykge1xuICAgICAgICAgICAgZWxlbWVudC52aWV3ID0gdmlld1JlZi52aWV3O1xuICAgICAgICAgICAgY29uc3QgZWwgPSBlbGVtZW50LmNoaWxkRWxlbSA/PyBlbGVtZW50LmVsO1xuICAgICAgICAgICAgaWYgKCFpc1VzaW5nUmVmZXJlbmNlRWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQudmlldy51aS5hZGQoZWwsIGVsZW1lbnQucG9zaXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHZpZXdSZWYpIHtcbiAgICAgICAgICAgIHdhaXRGb3JWaWV3SGFuZGxlcih2aWV3UmVmLCBlbGVtZW50LCBpc1VzaW5nUmVmZXJlbmNlRWxlbWVudCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IHZpZXdSZWYgPSBlbGVtZW50LmVsLmNsb3Nlc3QoXCJhcmNnaXMtbWFwXCIpID8/IGVsZW1lbnQuZWwuY2xvc2VzdChcImFyY2dpcy1zY2VuZVwiKTtcbiAgICAgICAgaWYgKHZpZXdSZWY/LnZpZXcpIHtcbiAgICAgICAgICAgIGVsZW1lbnQudmlldyA9IHZpZXdSZWYudmlldztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh2aWV3UmVmKSB7XG4gICAgICAgICAgICBjb25zdCBoYW5kbGVyID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIHZpZXdSZWYucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImFyY2dpc1ZpZXdSZWFkeUNoYW5nZVwiLCBoYW5kbGVyLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgZWxlbWVudC52aWV3ID0gdmlld1JlZi52aWV3O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZpZXdSZWYuYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc1ZpZXdSZWFkeUNoYW5nZVwiLCBoYW5kbGVyLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBpc051bGxPckVtcHR5U3RyaW5nKHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IFwiXCI7XG59XG5mdW5jdGlvbiBpc1ZhbGlkSW50ZWdlcih2YWx1ZSkge1xuICAgIHJldHVybiB2YWx1ZSAhPSBudWxsICYmIHZhbHVlICUgMSA9PT0gMDtcbn1cbmZ1bmN0aW9uIGlzTm90U2FtZUNhbWVyYShjYW1lcmEsIGNhbWVyYTIpIHtcbiAgICByZXR1cm4gKGNhbWVyYTIgPT09IHVuZGVmaW5lZCB8fFxuICAgICAgICBjYW1lcmEucG9zaXRpb24gIT09IGNhbWVyYTIucG9zaXRpb24gfHxcbiAgICAgICAgY2FtZXJhLmhlYWRpbmcgIT09IGNhbWVyYTIuaGVhZGluZyB8fFxuICAgICAgICBjYW1lcmEudGlsdCAhPT0gY2FtZXJhMi50aWx0KTtcbn1cbmZ1bmN0aW9uIGlzTm90U2FtZUVudmlyb25tZW50KGVudmlyb25tZW50LCBlbnZpcm9ubWVudDIpIHtcbiAgICByZXR1cm4gKGVudmlyb25tZW50MiA9PT0gdW5kZWZpbmVkIHx8XG4gICAgICAgIGVudmlyb25tZW50Mi5hdG1vc3BoZXJlRW5hYmxlZCAhPT0gZW52aXJvbm1lbnQuYXRtb3NwaGVyZUVuYWJsZWQgfHxcbiAgICAgICAgZW52aXJvbm1lbnQyLmxpZ2h0aW5nLmRhdGUgIT09IGVudmlyb25tZW50LmxpZ2h0aW5nLmRhdGUgfHxcbiAgICAgICAgZW52aXJvbm1lbnQyLmxpZ2h0aW5nLmRpcmVjdFNoYWRvd3NFbmFibGVkICE9PVxuICAgICAgICAgICAgZW52aXJvbm1lbnQubGlnaHRpbmcuZGlyZWN0U2hhZG93c0VuYWJsZWQgfHxcbiAgICAgICAgZW52aXJvbm1lbnQyLmxpZ2h0aW5nLmNhbWVyYVRyYWNraW5nRW5hYmxlZCAhPT1cbiAgICAgICAgICAgIGVudmlyb25tZW50LmxpZ2h0aW5nLmNhbWVyYVRyYWNraW5nRW5hYmxlZCB8fFxuICAgICAgICBlbnZpcm9ubWVudDIubGlnaHRpbmcuZGF0ZSAhPT0gZW52aXJvbm1lbnQubGlnaHRpbmcuZGF0ZSB8fFxuICAgICAgICBlbnZpcm9ubWVudDIubGlnaHRpbmcuZGlzcGxheVVUQ09mZnNldCAhPT1cbiAgICAgICAgICAgIGVudmlyb25tZW50LmxpZ2h0aW5nLmRpc3BsYXlVVENPZmZzZXQpO1xufVxuZnVuY3Rpb24gaXNOb3RTYW1lVmlld3BvaW50KHZpZXdwb2ludCwgdmlld3BvaW50Mikge1xuICAgIHJldHVybiAodmlld3BvaW50MiA9PT0gdW5kZWZpbmVkIHx8XG4gICAgICAgIHZpZXdwb2ludC50YXJnZXRHZW9tZXRyeSAhPT0gdmlld3BvaW50Mi50YXJnZXRHZW9tZXRyeSB8fFxuICAgICAgICB2aWV3cG9pbnQucm90YXRpb24gIT09IHZpZXdwb2ludDIucm90YXRpb24gfHxcbiAgICAgICAgdmlld3BvaW50LnNjYWxlICE9PSB2aWV3cG9pbnQyLnNjYWxlKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUZvclZpZXcodmlld1N0cikge1xuICAgIGNvbnN0IHZpZXdSZWYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHZpZXdTdHIpO1xuICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgICBpZiAodmlld1JlZj8udmlldyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXNvbHZlKHZpZXdSZWYudmlldyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodmlld1JlZikge1xuICAgICAgICAgICAgY29uc3QgaGFuZGxlciA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICB2aWV3UmVmLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJhcmNnaXNWaWV3UmVhZHlDaGFuZ2VcIiwgaGFuZGxlciwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIHJlc29sdmUodmlld1JlZi52aWV3KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2aWV3UmVmLmFkZEV2ZW50TGlzdGVuZXIoXCJhcmNnaXNWaWV3UmVhZHlDaGFuZ2VcIiwgaGFuZGxlciwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5hc3luYyBmdW5jdGlvbiByZWZlcmVuY2VFbGVtZW50SGVscGVyKGVsZW1lbnQsIHJlZkVsZW1lbnQpIHtcbiAgICBpZiAocmVmRWxlbWVudCA9PT0gdW5kZWZpbmVkKVxuICAgICAgICByZXR1cm47XG4gICAgZWxzZSBpZiAodHlwZW9mIHJlZkVsZW1lbnQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgZWxlbWVudC52aWV3ID0gYXdhaXQgdXBkYXRlRm9yVmlldyhyZWZFbGVtZW50KTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZWxlbWVudC53aWRnZXQpIHtcbiAgICAgICAgZWxlbWVudC52aWV3ID0gcmVmRWxlbWVudC52aWV3O1xuICAgIH1cbn1cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vXG4vLyAgUHJpdmF0ZSBNZXRob2RzXG4vL1xuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZnVuY3Rpb24gd2FpdEZvclZpZXdIYW5kbGVyKHZpZXdSZWYsIGVsZW1lbnQsIGlzVXNpbmdSZWZlcm5jZUVsZW1lbnQpIHtcbiAgICBjb25zdCBoYW5kbGVyID0gKCkgPT4ge1xuICAgICAgICB2aWV3UmVmLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJhcmNnaXNWaWV3UmVhZHlDaGFuZ2VcIiwgaGFuZGxlciwgZmFsc2UpO1xuICAgICAgICBlbGVtZW50LnZpZXcgPSB2aWV3UmVmLnZpZXc7XG4gICAgICAgIGlmICghaXNVc2luZ1JlZmVybmNlRWxlbWVudCkge1xuICAgICAgICAgICAgZWxlbWVudC52aWV3LnVpLmFkZChlbGVtZW50LmNoaWxkRWxlbSA/PyBlbGVtZW50LmVsLCBlbGVtZW50LnBvc2l0aW9uKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgdmlld1JlZi5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzVmlld1JlYWR5Q2hhbmdlXCIsIGhhbmRsZXIsIGZhbHNlKTtcbn1cblxuZXhwb3J0IHsgYWRkSGFuZGxlcyBhcyBhLCBpc05vdFNhbWVWaWV3cG9pbnQgYXMgYiwgY2hlY2tGb3JWaWV3IGFzIGMsIGNoZWNrRm9yRXhwYW5kIGFzIGQsIGlzTm90U2FtZUNhbWVyYSBhcyBlLCBpc05vdFNhbWVFbnZpcm9ubWVudCBhcyBmLCBpc1ZhbGlkSW50ZWdlciBhcyBnLCBpc051bGxPckVtcHR5U3RyaW5nIGFzIGksIHJlZmVyZW5jZUVsZW1lbnRIZWxwZXIgYXMgciB9O1xuIiwiLyohXG4gKiBBbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVzcmksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuICogU2VlIGh0dHBzOi8vanMuYXJjZ2lzLmNvbS80LjMwL2VzcmkvY29weXJpZ2h0LnR4dCBmb3IgZGV0YWlscy5cbiAqIHY0LjMwLjAtbmV4dC4zN1xuICovXG5mdW5jdGlvbiBvbkRpc2Nvbm5lY3RlZEhlbHBlcihlbGVtZW50KSB7XG4gICAgaWYgKGVsZW1lbnQuY2hpbGRFbGVtKSB7XG4gICAgICAgIGlmICghZWxlbWVudC5lbC5pc0Nvbm5lY3RlZCkge1xuICAgICAgICAgICAgaWYgKGVsZW1lbnQudmlldykge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQudmlldy51aS5yZW1vdmUoZWxlbWVudC5jaGlsZEVsZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZWxlbWVudC53aWRnZXQ/LnZpZXcpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LndpZGdldC52aWV3LnVpLnJlbW92ZShlbGVtZW50LmNoaWxkRWxlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZWxlbWVudC5fd2F0Y2hIYW5kbGVzKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5fd2F0Y2hIYW5kbGVzLmZvckVhY2goKGhhbmRsZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbGVtZW50Ll93YXRjaEhhbmRsZXMgPSBbXTtcbiAgICAgICAgICAgIGVsZW1lbnQud2lkZ2V0Py5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKCFlbGVtZW50LmVsLmlzQ29ubmVjdGVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQudmlldykge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnZpZXcudWkucmVtb3ZlKGVsZW1lbnQuZWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChlbGVtZW50LndpZGdldD8udmlldykge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LndpZGdldC52aWV3LnVpLnJlbW92ZShlbGVtZW50LmVsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnQuX3dhdGNoSGFuZGxlcykge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50Ll93YXRjaEhhbmRsZXMuZm9yRWFjaCgoaGFuZGxlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbGVtZW50Ll93YXRjaEhhbmRsZXMgPSBbXTtcbiAgICAgICAgICAgICAgICBlbGVtZW50LndpZGdldD8uZGVzdHJveSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAxMDAwKTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IG9uRGlzY29ubmVjdGVkSGVscGVyIGFzIG8gfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==